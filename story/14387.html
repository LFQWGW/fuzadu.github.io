<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何在Linux上使用dmesg命令</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何在Linux上使用dmesg命令</h2></div><div class="content"><p>dmesg命令允许您窥探Linux启动进程的隐藏世界。使用“故障查找程序的朋友”查看和监视来自内核自己的环形缓冲区的硬件设备和驱动程序消息。</p><p>Linux的环形缓冲区是如何工作的</p><p>在Linux和类似Unix的计算机中，启动和启动是计算机通电时发生的事件序列中的两个截然不同的阶段。</p><p>引导进程(BIOS或UEFI、MBR和GRUB)将系统初始化到将内核加载到内存并连接到初始ramdisk(initrd或initramfs)，然后启动systemd。</p><p>然后，启动进程拿起接力棒，完成操作系统的初始化。在初始化的早期阶段，日志记录守护进程(如syslogd或rsyslogd)尚未启动并运行。为了避免在此初始化阶段丢失显著的错误消息和警告，内核包含一个用作消息库的环形缓冲区。</p><p>环形缓冲区是为消息保留的存储空间。它设计简单，尺寸固定。当它已满时，较新的邮件会覆盖最旧的邮件。从概念上讲，它可以被认为是一个“循环缓冲区”。</p><p>内核环缓冲区存储诸如设备驱动程序的初始化消息、来自硬件的消息和来自内核模块的消息等信息。因为它包含这些低级启动消息，所以环形缓冲区是开始调查硬件错误或其他启动问题的好地方。</p><p>但不要空手而归。带着他一起去吧。</p><p>dmesg命令</p><p>dmesg命令允许您查看存储在环形缓冲区中的消息。默认情况下，您需要使用sudo才能使用dmesg。</p><code>sudo dmesg</code><img class="content_img" src="/image/b7/b72d3332bfc5cc2a46d7dbe5b491bf52.png" /><p>环形缓冲区中的所有消息都显示在终端窗口中。</p><img class="content_img" src="/image/3a/3a9491435d4f5073d4e18e6f67f2a17c.png" /><p>那是一场洪水。很明显，我们需要做的是通过更少的管道：</p><code>sudo dmesg | less</code><img class="content_img" src="/image/d4/d4abe0f7596e35a3558001234759c54c.png" /><p>现在我们可以滚动消息，查找感兴趣的项目。</p><img class="content_img" src="/image/47/4761582c85dceb5631c04edbb748babd.png" /><p>您可以在LESS中使用搜索功能来查找和突出显示您感兴趣的项目和术语。按LESS中的正斜杠“/”启动搜索功能。</p><p>相关：如何在Linux上使用LESS命令</p><p>消除了对sudo的需求</p><p>如果希望避免每次使用dmesg时都必须使用sudo，可以使用此命令。但是，请注意：它允许拥有您的计算机用户帐户的任何人使用dmesg，而不必使用sudo。</p><code>sudo sysctl -w kernel.dmesg_restrict=0</code><img class="content_img" src="/image/7d/7df36b12d15beb89547eb138e5694b5f.png" /><p>强制颜色输出</p><p>默认情况下，dmesg可能会配置为生成彩色输出。如果不是，您可以告诉dmesg使用-L(COLOR)选项对其输出进行着色。</p><code>sudo dmesg -L</code><img class="content_img" src="/image/d8/d836bfc4cef4205cd20206058429d95b.png" /><p>要强制dmesg始终默认为彩色显示，请使用以下命令：</p><code>sudo dmesg --color=always</code><img class="content_img" src="/image/7d/7d9085bcb2c3d68faa92b7471f46ab8d.png" /><p>人类时间戳</p><p>默认情况下，dmesg使用自内核启动以来的秒和纳秒的时间戳表示法。要以更加人性化的格式呈现，请使用-H(人性化)选项。</p><code>sudo dmesg -H</code><img class="content_img" src="/image/1b/1bd0edd43fcf1129709bd8f16903d7c8.png" /><p>这会导致两件事发生。</p><img class="content_img" src="/image/f4/f47034508ba99fff018bfa1414f2bc9d.png" /><p>
输出将自动显示在LESS中。
时间戳显示带有日期和时间的时间戳，分辨率为分钟。每分钟发生的所有消息都标有从该分钟开始算起的秒数和纳秒数。</p><p>人类可读的时间戳</p><p>如果您不需要纳秒精度，但是您确实想要比默认时间戳更容易读取的时间戳，请使用-T(人类可读)选项。(这有点令人困惑。-H是“人类”选项，-T是“人类可读”选项。)</p><code>sudo dmesg -T</code><img class="content_img" src="/image/87/8759e86934d2cd3db4f29970e9dd02b9.png" /><p>时间戳呈现为标准日期和时间，但分辨率降低到一分钟。</p><img class="content_img" src="/image/55/55fc737884aaed2907074cf5a02af667.png" /><p>一分钟内发生的所有事情都有相同的时间戳。如果你所关心的只是事件的顺序，这就足够了。另外，请注意，在命令提示符下会将你转回原处。此选项不会自动调用较少。</p><p>观看现场活动</p><p>要在消息到达内核环缓冲区时查看消息，请使用--Follow(等待消息)选项。这句话看起来可能有点奇怪。如果环形缓冲区用于存储来自启动序列中发生的事件的消息，那么一旦计算机启动并运行，实时消息如何到达环形缓冲区？</p><p>任何导致连接到您的计算机的硬件发生更改的事情都会导致消息被发送到内核环形缓冲区。更新或添加内核模块，您将看到有关这些更改的环形缓冲区消息。如果您插入USB驱动器或连接或断开蓝牙设备，您将在dmesg输出中看到消息。即使虚拟硬件也会导致新消息出现在环形缓冲区中。启动虚拟机，您将看到新信息到达环形缓冲区。</p><code>sudo dmesg --follow</code><img class="content_img" src="/image/9d/9d0e87b17a93166e16dba401eda3f441.png" /><p>请注意，您不会返回到命令提示符。当出现新消息时，它们由终端窗口底部的dmesg命令显示。</p><img class="content_img" src="/image/c7/c71f1d7ce66cea57d5d25a083fd59df4.png" /><p>甚至挂载CD-ROM光盘也被视为一种改变，因为您已经将CD-ROM光盘的内容嫁接到了目录树上。</p><img class="content_img" src="/image/47/47f15a2532ef37a0d4c4185b86268dad.png" /><p>要退出实时摘要，请按Ctrl+C。</p><p>检索最后十条消息</p><p>使用Tail命令检索最后十条内核环形缓冲区消息。当然，您可以检索任意数量的消息。10只是我们的例子。</p><code>sudo dmesg | last -10</code><img class="content_img" src="/image/9c/9cf3fee991c2c0a9d8507d3bff8b2ce6.png" /><p>在终端窗口中检索并列出最后十条消息。</p><img class="content_img" src="/image/14/14b8f689b3b2cd2a6e8911fcd79254dd.png" /><p>搜索特定术语</p><p>通过grep通过管道从dmesg输出以搜索特定字符串或模式。在这里，我们使用-i(忽略大小写)选项，以便忽略匹配字符串的大小写。我们的结果将包括“usb”和“usb”以及任何其他小写和大写的组合。</p><code>sudo dmesg | grep -i usb</code><img class="content_img" src="/image/f5/f5983d6f77c20f94fe5e98f97629e431.png" /><p>突出显示的搜索结果为大写和小写。</p><img class="content_img" src="/image/87/8738e581f640cf07d289f7cf6c20465e.png" /><p>我们可以隔离包含对系统SDA上第一个SCSI硬盘的引用的消息。(实际上，SDA现在也用于第一个SATA硬盘驱动器和USB驱动器。)</p><code>sudo dmesg | grep -i sda</code><img class="content_img" src="/image/6a/6ad4f15731c4f2845ee44484c8ae1af7.png" /><p>所有提到SDA的消息都会在终端窗口中检索并列出。</p><img class="content_img" src="/image/02/02a4dbf4b2a2ac184fa4779eb9d04875.png" /><p>要让grep一次搜索多个术语，请使用-E(扩展正则表达式)选项。您必须在带引号的字符串内提供搜索词，搜索词之间必须使用竖线“|”分隔符：</p><code>sudo dmesg | grep -E "memory|tty|dma"</code><img class="content_img" src="/image/c4/c416020cdd1df74fa0154bd9f032f906.png" /><p>提到任何搜索词的任何消息都会在终端窗口中列出。</p><img class="content_img" src="/image/97/97b0438b5f3955f085647bdba13deb7a.png" /><p>使用日志级别</p><p>记录到内核环缓冲区的每条消息都附加了一个级别。该级别表示消息中信息的重要性。这些级别包括：</p><p>
紧急情况：系统无法使用。
警告：必须立即采取行动。
危急：情况危急。
错误：错误条件。
警告：警告条件。
注意：正常但重要的情况。
信息：信息性。
调试：调试级消息。</p><p>通过使用-l(级别)选项并将级别名称作为命令行参数传递，我们可以使dmesg提取与特定级别匹配的消息。要仅查看“信息性”级别的消息，请使用以下命令：</p><code>sudo dmesg -l info</code><img class="content_img" src="/image/dc/dcff317f49ea185113767a3e46c2d8ee.png" /><p>列出的所有消息都是信息性消息。它们不包含错误或警告，只包含有用的通知。</p><img class="content_img" src="/image/00/001ec57f80ceb8f70f804998b5ca4ebf.png" /><p>在一个命令中组合两个或多个日志级别，以检索多个日志级别的消息：</p><code>sudo dmesg -l debug,notice</code><img class="content_img" src="/image/7f/7fbd244357afab62e8146d875ef7f647.png" /><p>dmesg的输出混合了每个日志级别的消息：</p><img class="content_img" src="/image/af/af1e249940909261c08d862ec6ec9f00.png" /><p>设施类别</p><p>dmesg消息被分组到称为“设施”的类别中。设施列表如下：</p><p>
kern：内核消息。
用户：用户级消息。
邮件：邮件系统。
守护进程：系统守护进程。
身份验证：安全/授权消息。
syslog：内部syslogd消息。
LPR：行式打印机子系统。
新闻：网络新闻子系统。</p><p>我们可以要求dmesg过滤其输出，以便只显示特定设施中的消息。为此，我们必须使用-f(工具)选项：</p><code>sudo dmesg -f daemon</code><img class="content_img" src="/image/95/95ddc9e201f8e63632a0f0f1bb4154ff.png" /><p>dmesg列出与终端窗口中的守护进程相关的所有消息。</p><img class="content_img" src="/image/9c/9c4a2502f0b1f6794f0909166380fa89.png" /><p>正如我们对级别所做的那样，我们可以要求dmesg一次列出来自多个设施的消息：</p><code>sudo dmesg -f syslog, daemon</code><img class="content_img" src="/image/b7/b7b5f9ae51f95f999da43502d29218c1.png" /><p>输出是系统日志和守护程序日志消息的混合。</p><img class="content_img" src="/image/c0/c0c70cd13922dde24231c0bbd5321e5c.png" /><p>组合设施和标高</p><p>x(解码)选项使dmesg将设施和级别显示为每行的人类可读前缀。</p><code>sudo dmesg -x</code><img class="content_img" src="/image/a8/a86c0e07fe14658082acf723f55cfa51.png" /><p>设施和标高可以在每行的开始处看到：</p><img class="content_img" src="/image/25/25c43c89304d45f511e4805eecc44c1c.png" /><p>第一个突出显示的部分是来自“内核”工具的消息，级别为“通知”。第二个突出显示的部分是来自“kernel”工具的消息，级别为“info”。</p><p>太好了，但是为什么呢？</p><p>简而言之，就是找毛病。</p><p>如果您遇到硬件无法识别或运行不正常的问题，dmesg可能会提供一些信息。</p><p>
使用dmesg查看从最高级别到每个较低级别的消息，查找提及硬件项目或可能与问题相关的任何错误或警告。
使用dmesg搜索任何提到的适当的测试工具，以查看它们是否包含任何有用的信息。
通过grep管道dmesg并查找相关的字符串或标识符，如产品制造商或型号。
通过grep管道dmesg并查找诸如“GPU”或“存储”之类的通用术语，或者诸如“失败”、“失败”或“无法”之类的术语。
使用--Follow选项并实时查看dmesg消息。</p><p>狩猎愉快。</p><div class="item_info"><span class="item_key"><a href="/tag/消息/">消息</a></span><span class="item_key"><a href="/tag/使用/">使用</a></span><span class="item_key"><a href="/tag/dmesg/">dmesg</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/13436.html">如何在Linux上使用WALL命令</a><li><a href="/story/12005.html">[更新：修复]PlayStation4s上出现恶意消息，下面介绍如何保护您的PlayStation4s</a><li><a href="/story/11717.html">如何删除Facebook消息</a><li><a href="/story/11675.html">如何通过Instagram给人们发信息</a><li><a href="/story/11587.html">别再为已读收据大惊小怪了</a><li><a href="/story/11355.html">WhatsApp中的小勾号是什么意思？</a><li><a href="/story/11076.html">如何在Android上以单条消息的形式获取群发消息回复</a><li><a href="/story/10958.html">如何在iOS 10中发送手写和数字触摸消息</a><li><a href="/story/10873.html">如何使用iMessage的新效果(如隐形墨水)</a><li><a href="/story/10862.html">如何修复iOS10中不显示消息效果的iMessage</a><li><a href="/story/10534.html">如何查看iPhone上何时发送短信</a><li><a href="/story/10395.html">如何将消息添加到OS X锁屏</a><li><a href="/story/9637.html">如何在iPhone上删除或转发单独的短信</a><li><a href="/story/9219.html">如何使iPhone、iPad和Mac上的消息静音</a><li><a href="/story/8240.html">为什么我的iPhone上有些iMessage是绿色的，有些是蓝色的？</a><li><a href="/story/6151.html">如何在Outlook 2013中通过电子邮件创建任务</a><li><a href="/story/1463.html">在Windows 7中禁用令人讨厌的“此设备可以更快执行”气球消息</a><li><a href="/story/475.html">通过键盘在Outlook 2007中打开附件</a><li><a href="/story/466.html">在Ubuntu上更改SSH欢迎横幅</a><li><a href="/story/416.html">在Windows Home Server中禁用管理员登录警告</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>