<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Linux防火墙iptables入门指南</title><link rel="stylesheet" href="/css.css"><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?f75329719d379998b2421a4cc2396366";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>Linux防火墙iptables入门指南</h2></div><div class="content"><img class="content_img" src="/image/ec/ec08c9f83383f79b807b8db8e5c14221.jpg" /><p>iptables是为Linux操作系统构建的极其灵活的防火墙实用程序。无论您是Linux新手还是系统管理员，iptables都可能在某些方面对您非常有用。请继续阅读，我们将向您展示如何配置功能最强大的Linux防火墙。</p><p>照片由ezioman拍摄。</p><p>关于iptables</p><p>iptables是一个命令行防火墙实用程序，它使用策略链来允许或阻止通信。当连接试图在系统上建立自身时，iptables会在其列表中查找要与其匹配的规则。如果找不到，则求助于默认操作。</p><p>iptables几乎总是预装在任何Linux发行版上。要更新/安装它，只需检索iptables软件包：</p><p>iptables还有一些GUI替代方案，比如Firestarter，但是一旦您关闭了几个命令，iptables就不会那么难了。在配置iptables规则时要格外小心，特别是当您通过SSH连接到服务器时，因为一个错误的命令可能会永久锁定您，直到在物理机器上手动修复它。</p><p>链条的类型</p><p>iptables使用三个不同的链：输入、转发和输出。</p><p>输入-此链用于控制传入连接的行为。例如，如果用户尝试通过SSH连接到您的PC/服务器，iptables将尝试将IP地址和端口与输入链中的规则相匹配。</p><p>转发-此链用于实际上不在本地传递的传入连接。以路由器为例-数据总是被发送到它，但很少真正发往路由器本身；数据只是转发到它的目标。除非您在系统上执行某种路由、NAT或其他需要转发的操作，否则您甚至不会使用这个链。</p><p>有一个可靠的方法可以检查您的系统是否使用/需要转发链。</p><img class="content_img" src="/image/3f/3f3a961d8b25a88179a510ea93a1e10f.jpg" /><p>上面的屏幕截图显示的是一台已经运行了几周的服务器，它对传入或传出连接没有任何限制。如您所见，输入链已经处理了11 GB的数据包，而输出链已经处理了17 GB。另一方面，前向链不需要处理单个数据包。这是因为服务器没有执行任何类型的转发或被用作直通设备。</p><p>输出-此链用于传出连接。例如，如果您尝试ping howtogek.com，iptables将在决定允许或拒绝连接尝试之前检查其输出链，以查看有关ping和howtogek.com的规则是什么。</p><p>告诫：</p><p>尽管ping外部主机似乎只需要遍历输出链，但请记住，要返回数据，也将使用输入链。使用iptables锁定系统时，请记住，许多协议都需要双向通信，因此输入链和输出链都需要正确配置。SSH是人们忘记在两条链上都允许的公共协议。</p><p>策略链默认行为</p><p>在进入并配置特定规则之前，您需要确定您希望这三个链的默认行为是什么。换句话说，如果连接不匹配任何现有规则，您希望iptables做什么？</p><p>要查看您的策略链当前配置为如何处理不匹配的流量，请运行iptables-L命令。</p><img class="content_img" src="/image/e1/e16f7cf9142db0f4220c6793d40db644.jpg" /><p>如您所见，我们还使用grep命令来提供更干净的输出。在该屏幕截图中，我们的链条目前被设计为接受流量。</p><p>很多时候，您会希望您的系统在默认情况下接受连接。除非您以前更改过策略链规则，否则应该已经配置了此设置。无论哪种方式，以下是默认情况下接受连接的命令：</p><p>通过默认接受规则，您可以使用iptables拒绝特定的IP地址或端口号，同时继续接受所有其他连接。我们将立即执行这些命令。</p><p>如果您宁愿拒绝所有连接并手动指定要允许连接的连接，则应将链的默认策略更改为DROP。这样做可能只对包含敏感信息且只连接相同IP地址的服务器有用。</p><p>特定于连接的响应</p><p>配置了默认链策略后，您可以开始向iptables添加规则，以便它知道在遇到来自或指向特定IP地址或端口的连接时该如何操作。在本指南中，我们将回顾三个最基本、最常用的“回答”。</p><p>接受-允许连接。</p><p>丢掉连接，就当什么都没发生过。如果您不希望源代码意识到您的系统存在，这是最好的。</p><p>拒绝-不允许连接，但发回错误。如果您不想让某个特定的源连接到您的系统，但又想让他们知道您的防火墙阻止了他们，那么这是最好的。</p><p>要显示这三个规则之间的差异，最好的方法是显示当PC尝试ping Linux机器(为每个设置配置了iptables)时是什么样子。</p><p>允许连接：</p><img class="content_img" src="/image/93/932612a21345674007e47a65bec31b81.jpg" /><p>正在断开连接：</p><img class="content_img" src="/image/69/69d18af0ed1a2defbfe6d86a22a3016d.jpg" /><p>拒绝连接：</p><img class="content_img" src="/image/2e/2ece8dd3e9118135ff208d434c0ed1b8.jpg" /><p>允许或阻止特定连接</p><p>配置策略链后，您现在可以配置iptables以允许或阻止特定地址、地址范围和端口。在这些示例中，我们将连接设置为Drop，但您可以根据您的需要和如何配置策略链，将它们切换为接受或拒绝。</p><p>注意：在这些示例中，我们将使用iptables-A将规则附加到现有链中。iptables从其列表的顶部开始，遍历每个规则，直到找到匹配的规则。如果需要将一条规则插入到另一条规则之上，可以使用iptables-i[CHAIN][NUMBER]指定该规则在列表中的编号。</p><p>来自单个IP地址的连接</p><p>此示例显示如何阻止来自IP地址10.10.10.10的所有连接。</p><p>来自一系列IP地址的连接</p><p>本例显示如何拦截10.10.10.0/24网络范围内的所有IP地址。您可以使用网络掩码或标准斜杠表示法来指定IP地址范围。</p><p>或者 / 还是 / 即 / 否则</p><p>连接到特定端口</p><p>此示例显示如何阻止来自10.10.10.10的SSH连接。</p><p>您可以用任何协议或端口号替换“ssh”。代码的-p tcp部分告诉iptables协议使用哪种连接。如果您阻塞的是使用UDP而不是TCP的协议，则需要使用-p UDP。</p><p>此示例说明如何阻止来自任何IP地址的SSH连接。</p><p>连接状态</p><p>正如我们前面提到的，很多协议将需要双向通信。例如，如果您希望允许SSH连接到您的系统，则输入链和输出链将需要添加一个规则。但是，如果您只希望允许SSH进入您的系统，该怎么办呢？向输出链添加规则不也允许传出SSH尝试吗？</p><p>这就是连接状态的用武之地，它为您提供了允许双向通信但只允许建立单向连接所需的功能。看看这个示例，其中允许从10.10.10.10到10.10.10.10的SSH连接，但不允许到10.10.10.10的SSH连接。但是，只要会话已经建立，系统就可以通过SSH发回信息，这使得这两台主机之间可以进行SSH通信。</p><p>正在保存更改</p><p>除非您执行命令保存更改，否则下次重新启动iptables服务时，您对iptables规则所做的更改将被废弃。注意，此命令可能会因您的版本而异：</p><p>Ubuntu：</p><p>Red Hat/CentOS：</p><p>或者 / 还是 / 即 / 否则</p><p>其他命令</p><p>列出当前配置的iptables规则：</p><p>添加-v选项将给出数据包和字节信息，添加-n将以数字列出所有内容。换句话说，主机名、协议和网络都以数字列出。</p><p>要清除当前配置的所有规则，可以发出flush命令。</p><div class="item_info"><span class="item_key"><a href="/tag/连接/">连接</a></span><span class="item_key"><a href="/tag/iptables/">iptables</a></span><span class="item_key"><a href="/tag/规则/">规则</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14810.html">现在是2020年。使用公共Wi-Fi仍然危险吗？</a><li><a href="/story/14595.html">如何在Linux上使用netstat</a><li><a href="/story/14195.html">保护SSH服务器的最佳方法</a><li><a href="/story/14181.html">如何在安装Windows 10时创建本地帐户</a><li><a href="/story/14177.html">如何在Linux上使用端口敲门(以及为什么不应该使用)</a><li><a href="/story/13848.html">为什么Windows Defender防火墙阻止某些应用程序功能？</a><li><a href="/story/13763.html">如何在Ubuntu上设置远程桌面</a><li><a href="/story/13728.html">什么是反向SSH隧道？(以及如何使用它)</a><li><a href="/story/13646.html">网速测试是如何工作的？(它们有多准确？)</a><li><a href="/story/13531.html">如何从Linux Shell创建和安装SSH密钥</a><li><a href="/story/12378.html">如何在iPhone、iPad或Mac上使用即时热点</a><li><a href="/story/12060.html">你真的需要一个“游戏”路由器吗？</a><li><a href="/story/11826.html">如何将蓝牙耳机同时连接到多个设备</a><li><a href="/story/11800.html">如何将以太网与Chromecast配合使用以实现快速可靠的流媒体</a><li><a href="/story/11706.html">如何在Wi-Fi摄像头检测到运动时自动打开灯光</a><li><a href="/story/11336.html">什么是“热点2.0”网络？</a><li><a href="/story/11207.html">如何让任何人将他们的手机连接到您的Google Home</a><li><a href="/story/11189.html">如何让您的流媒体视频不再缓冲太多</a><li><a href="/story/11128.html">如何将Android设备用作PC或Mac的第二个显示器</a><li><a href="/story/11003.html">如何使用Android的Wi-Fi助手安全连接公共Wi-Fi网络(并保存数据)</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>