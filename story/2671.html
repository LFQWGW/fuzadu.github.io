<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何在Ubuntu中管理和使用LVM(Logical Volume Management)</title><link rel="stylesheet" href="/css.css"><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?f75329719d379998b2421a4cc2396366";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何在Ubuntu中管理和使用LVM(Logical Volume Management)</h2></div><div class="content"><img class="content_img" src="/image/16/16dff25d2e1d4d1e436c85353fecfcff.png" /><p>在我们的前一篇文章中，我们告诉了您什么是LVM以及您可能想要使用它做什么，今天我们将带您了解LVM的一些关键管理工具，这样您在设置或扩展安装时就可以放心了。</p><p>如前所述，LVM是操作系统和物理硬盘驱动器之间的抽象层。这意味着您的物理硬盘和分区不再绑定到它们所在的硬盘和分区。相反，您的操作系统看到的硬盘和分区可以是汇聚在一起或在软件RAID中的任意数量的独立硬盘。</p><p>要管理LVM，可以使用GUI工具，但是要真正了解您的LVM配置发生了什么，最好知道命令行工具是什么。如果您在不提供GUI工具的服务器或发行版上管理LVM，这将特别有用。</p><p>LVM中的大多数命令彼此非常相似。每个有效命令前面都有以下内容之一：</p><p>
物理卷=PV。
卷组=VG。
逻辑卷=LV</p><p>物理卷命令用于添加或删除卷组中的硬盘驱动器。卷组命令用于更改呈现给您在逻辑卷中操作的抽象物理分区集。逻辑卷命令将卷组显示为分区，以便您的操作系统可以使用指定的空间。</p><p>可下载的LVM小抄</p><p>为了帮助您理解每个前缀可以使用哪些命令，我们制作了一份LVM小抄。我们将在本文中介绍一些命令，但是您仍然可以做很多这里不会介绍的事情。</p><p>此列表上的所有命令都需要以root用户身份运行，因为您正在更改系统范围的设置，这将影响整台计算机。</p><img class="content_img" src="/image/dd/dd147c96eeb801a56d0cbf1d6a229c4b.png" /><p>(单击缩略图查看全尺寸图像)</p><p>如何查看当前LVM信息</p><p>您可能需要做的第一件事是检查您的LVM是如何设置的。s和display命令适用于物理卷(PV)、卷组(VG)和逻辑卷(LV)，因此在尝试确定当前设置时，这是一个很好的起点。</p><p>DISPLAY命令将格式化信息，因此它比s命令更容易理解。对于每个命令，您将看到PV/VG的名称和路径，它还应该提供有关可用空间和已用空间的信息。</p><img class="content_img" src="/image/45/45cd89aa6b40ea349808064d6e645edc.png" /><p>最重要的信息将是PV名称和VG名称。有了这两条信息，我们可以继续进行LVM设置。</p><p>创建逻辑卷</p><p>逻辑卷是操作系统在LVM中使用的分区。要创建逻辑卷，我们首先需要具有物理卷和卷组。以下是创建新逻辑卷所需的所有步骤。</p><p>创建物理卷</p><p>我们将从没有分区或信息的全新硬盘开始。首先查找您要使用的磁盘。(/dev/sda、sdb等)</p><p>注意：请记住，所有命令都需要以root用户身份运行，或者通过在命令开头添加“sudo”来运行。</p><p>如果您的硬盘驱动器以前从未进行过格式化或分区，您可能会在fdisk输出中看到类似以下内容。这完全没有问题，因为我们将在接下来的步骤中创建所需的分区。</p><img class="content_img" src="/image/fc/fca68e1e388b9c9a2225ee3aa7fa9788.png" /><p>我们的新磁盘位于/dev/sdb，因此让我们使用fdisk在驱动器上创建一个新分区。</p><p>有很多工具可以使用GUI创建新分区，包括Gparted，但是因为我们已经打开了终端，所以我们将使用fdisk来创建所需的分区。</p><p>在终端上键入以下命令：</p><p>这将使您进入一个特殊的fdisk提示符。</p><img class="content_img" src="/image/4a/4a2dfd4dd412260fcc96b07cd28108ac.png" /><p>按照给定的顺序输入命令，以创建一个新的主分区，该分区使用100%的新硬盘驱动器，并且已为LVM做好了准备。如果您需要更改分区大小或想要多个分区，我建议您使用GParted或自己阅读有关fdisk的内容。</p><p>警告：以下步骤将格式化您的硬盘。在执行这些步骤之前，请确保您没有关于此硬盘的任何信息。</p><p>
n=创建新分区。
P=创建主分区。
1=使分区成为磁盘上的第一个分区</p><p>按两次Enter键接受默认的第一个圆柱体和最后一个圆柱体。</p><img class="content_img" src="/image/29/292eb93d2e58f0539dc3be595cea781c.png" /><p>要准备LVM使用的分区，请使用以下两个命令。</p><p>
t=更改分区类型。
8E=更改LVM分区类型</p><img class="content_img" src="/image/4a/4ae53b316b189d75809c04c439fd3767.png" /><p>验证信息并将其写入硬盘。</p><p>
p=查看分区设置，以便我们可以在将更改写入磁盘之前进行检查。
W=将更改写入磁盘</p><img class="content_img" src="/image/58/58bdf246125cb498ffba77b79e2d6d2b.png" /><p>在这些命令之后，fdisk提示符应该会退出，您将返回到终端的bash提示符。</p><p>输入pvcreate/dev/sdb1在我们刚刚创建的分区上创建一个LVM物理卷。</p><p>您可能会问，为什么我们不使用文件系统格式化分区，但不要担心，这一步会在稍后进行。</p><img class="content_img" src="/image/49/4970733c33479b9aa7437325a13a7b77.png" /><p>既然我们已经指定了分区并创建了物理卷，我们就需要创建卷组。幸运的是，这只需要一个命令。</p><img class="content_img" src="/image/aa/aa4972f13b0858f2ecaae1d97108ba58.png" /><p>Vgpool是我们创建的新卷组的名称。您可以随心所欲地命名它，但是建议将VG放在标签的前面，这样如果您稍后引用它，您就会知道它是一个卷组。</p><p>创建逻辑卷</p><p>要创建LVM将使用的逻辑卷，请执行以下操作：</p><img class="content_img" src="/image/de/ded32e65f112c510cd4d9d5be4c69bb8.png" /><p>-L命令指定逻辑卷的大小，在本例中为3 GB，-n命令指定卷的名称。引用Vgpool，以便lvcreate命令知道从哪个卷获取空间。</p><p>格式化并装载逻辑卷</p><p>最后一步是使用文件系统格式化新逻辑卷。如果您需要有关选择Linux文件系统的帮助，请阅读我们的“如何帮助您选择最适合您需要的文件系统”。</p><img class="content_img" src="/image/d0/d00b3b8db6bc2a8df737bfafc7da062f.png" /><p>创建一个挂载点，然后将卷挂载到您可以使用的地方。</p><img class="content_img" src="/image/ac/ac63fab27cc61df4a404d99db65368c1.png" /><p>调整逻辑卷的大小</p><p>逻辑卷的好处之一是，您可以在物理上使您的共享更大或更小，而不必将所有内容都移动到更大的硬盘上。相反，您可以添加新硬盘并动态扩展卷组。或者，如果您有一个不使用的硬盘，您可以将其从卷组中移除，以缩小您的逻辑卷。</p><p>有三种基本工具可以使物理卷、卷组和逻辑卷变大或变小。</p><p>注意：根据您正在使用的内容，每个命令前面都需要加上pv、vg或lv。</p><p>
调整大小-可以收缩或扩展物理卷和逻辑卷，但不能收缩或扩展卷组。
扩展-可以使卷组和逻辑卷更大，但不能更小。
Reduce-可以使卷组和逻辑卷更小，但不能更大</p><p>让我们通过一个示例来演示如何将新的硬盘驱动器添加到我们刚刚创建的逻辑卷“lvStuff”中。</p><p>安装和格式化新硬盘</p><p>要安装新硬盘，请按照上面的步骤创建一个新分区，并将其分区类型更改为LVM(8E)。然后使用pvcreate创建LVM可以识别的物理卷。</p><p>将新硬盘添加到卷组</p><p>要将新硬盘添加到卷组，您只需知道新分区是什么，在本例中为/dev/sdc1，以及要将其添加到的卷组的名称。</p><p>这会将新物理卷添加到现有卷组。</p><img class="content_img" src="/image/64/6426e3d79ec535bd916a5ccf92fafc03.png" /><p>扩展逻辑卷</p><p>要调整逻辑卷的大小，我们需要说明我们希望按大小而不是按设备扩展多少。在我们的示例中，我们刚刚向我们的3 GB vgpool添加了一个8 GB硬盘驱动器。要使该空间可用，我们可以使用lvadd或lvresize。</p><img class="content_img" src="/image/32/32a9750c3d51915cddeef9ebe32b2221.png" /><p>虽然此命令将起作用，但您将看到它实际上会将我们的逻辑卷大小调整为8 GB，而不是像我们希望的那样向现有卷添加8 GB。要添加最后3个可用的GB，您需要使用以下命令。</p><img class="content_img" src="/image/ef/efbcf967b6f173f224e63c21da5571fe.png" /><p>现在，我们的逻辑卷大小为11 GB。</p><p>扩展文件系统</p><p>逻辑卷是11 GB，但该卷上的文件系统仍然只有3 GB。要使文件系统使用全部11 GB的可用空间，您必须使用命令realze2fs。只需将realze2fs指向11 GB的逻辑卷，它就会为您变魔术。</p><img class="content_img" src="/image/89/895b049085bb8c6fadc5680be51c4eb7.png" /><p>注意：如果您使用的是除ext3/4之外的其他文件系统，请参阅您的文件系统调整工具。</p><p>收缩逻辑卷</p><p>如果您想要从卷组中删除硬盘驱动器，则需要按相反顺序执行上述步骤，并改用lvduce和vgreduce。</p><p>
调整文件系统大小(请确保在调整大小之前将文件移动到硬盘的安全区域)。
减少逻辑卷(您也可以使用-来减少大小，而不是+来扩展)。
使用vgreduce从卷组中删除硬盘</p><p>备份逻辑卷</p><p>快照是一些较新的高级文件系统附带的功能，但是ext3/4缺乏动态创建快照的能力。关于LVM快照，最酷的事情之一是您的文件系统永远不会脱机，您可以在不占用额外硬盘空间的情况下拥有任意数量的文件系统。</p><img class="content_img" src="/image/7f/7fb2917073613e9da8e90a4be310cb99.png" /><p>当LVM拍摄快照时，将拍摄逻辑卷的确切外观的照片，该照片可用于在不同的硬盘驱动器上制作副本。在制作副本时，需要添加到逻辑卷的任何新信息都会像正常情况一样写入磁盘，但会跟踪更改，从而使原始图片永远不会被破坏。</p><p>要创建快照，我们需要创建一个具有足够可用空间的新逻辑卷，以容纳在我们进行备份时将写入该逻辑卷的任何新信息。如果驱动器未被主动写入，您可以使用非常少量的存储。备份完成后，我们只需删除临时逻辑卷，原始逻辑卷将照常继续。</p><p>创建新快照</p><p>要创建lvstuff的快照，请像以前一样使用lvcreate命令，但要使用-s标志。</p><img class="content_img" src="/image/8f/8f7e0a953081377b6504ee3e1a1e058b.png" /><p>在这里，我们创建了一个只有512MB的逻辑卷，因为该驱动器没有被活跃使用。在我们进行备份时，512MB将存储所有新写入。</p><p>装载新快照</p><p>就像前面一样，我们需要创建一个装载点并装载新快照，这样我们就可以从它复制文件。</p><img class="content_img" src="/image/42/42d03e51798e1ee28c7f20c3aab44193.png" /><p>复制快照和删除逻辑卷</p><p>您所要做的就是将/mnt/lvstuffbackup/中的所有文件复制到外部硬盘驱动器，或者将其压缩到一个文件中。</p><p>注意：tar-c将创建一个归档文件，-f将显示该归档文件的位置和文件名。要获得tar命令的帮助，请在终端中使用man tar。</p><img class="content_img" src="/image/3b/3bf98ef34a298d0f4a9a0f3b5a1076d1.png" /><p>请记住，在进行备份时，将在我们先前创建的临时逻辑卷中跟踪要写入lvstuff的所有文件。确保在进行备份时有足够的可用空间。</p><p>备份完成后，卸载卷并删除临时快照。</p><img class="content_img" src="/image/14/14d09ddeee5552896c155edbbb8aee02.png" /><p>删除逻辑卷</p><p>要删除逻辑卷，您需要首先确保该卷已卸载，然后可以使用lvremove将其删除。您还可以在删除逻辑卷后删除卷组，并在删除卷组后删除物理卷。</p><p>以下是使用我们创建的卷和组的所有命令。</p><img class="content_img" src="/image/ee/ee429c24bfa2a009595d61baad4925bd.png" /><p>这应该涵盖了使用LVM所需了解的大部分内容。如果你在这个主题上有一些经验，一定要在评论中分享你的智慧。</p><div class="item_info"><span class="item_key"><a href="/tag/使用/">使用</a></span><span class="item_key"><a href="/tag/lvm/">lvm</a></span><span class="item_key"><a href="/tag/分区/">分区</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14706.html">如何在Linux上使用uniq命令</a><li><a href="/story/14624.html">解释的Linux文件时间戳：atime、mtime和ctime</a><li><a href="/story/14585.html">如何在Microsoft Excel中兑换货币</a><li><a href="/story/14577.html">如何检查Linux上安装了哪个GPU</a><li><a href="/story/14572.html">如何使用Jouralctl读取Linux系统日志</a><li><a href="/story/14570.html">如何在Linux上使用grep命令</a><li><a href="/story/14555.html">2020年CES最佳：我们今年看到的所有最好的东西</a><li><a href="/story/14550.html">如何在Linux上使用Tail命令</a><li><a href="/story/14542.html">如何从MacOS Catalina向iPhone添加自定义铃声</a><li><a href="/story/14508.html">如何使用键盘快捷键简化流媒体Netflix</a><li><a href="/story/14507.html">如何在Linux上使用HISTORY命令</a><li><a href="/story/14499.html">如何在Linux上使用免费命令</a><li><a href="/story/14467.html">如何在Windows 10上切换到本地用户帐户</a><li><a href="/story/14466.html">如何在Linux上使用at和Batch来调度命令</a><li><a href="/story/14461.html">如何设置您的新Mac</a><li><a href="/story/14450.html">如何在Excel中将一长列变为多列</a><li><a href="/story/14438.html">如何在iPhone上创建和使用Memoji和Animoji</a><li><a href="/story/14434.html">Chrome 79的新特性，现已推出</a><li><a href="/story/14426.html">如何使用Google Sheets中的查询功能</a><li><a href="/story/14424.html">如何向Outlook会议请求添加默认签名</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>