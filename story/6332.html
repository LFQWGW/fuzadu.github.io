<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Ubuntu默认不裁剪SSD：为什么不呢？如何自己启用</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>Ubuntu默认不裁剪SSD：为什么不呢？如何自己启用</h2></div><div class="content"><img class="content_img" src="/image/11/119e51b568790efa6641812632449f9a.jpg" /><p>Ubuntu希望在Ubuntu 14.04中默认启用SSD的Trim。换句话说，Ubuntu还没有使用Trim，所以随着时间的推移，你的SSD速度会变慢。但是为什么Ubuntu还没有使用Trim呢？</p><p>这个消息可能会让许多人大吃一惊，他们以为Ubuntu和其他Linux发行版已经在使用TRIM了。Trim可防止SSD随时间减速，是SSD维护的必要组成部分。</p><p>为什么修剪很重要</p><p>我们以前已经讨论过为什么修剪很重要。当您删除旧的磁性硬盘上的文件时，计算机只会将该文件标记为已删除。文件的数据保留在硬盘上-这就是删除的文件可以恢复的原因。当计算机用新数据覆盖其扇区时，最终将覆盖已删除的文件。</p><p>固态驱动器(SSD)的工作方式有所不同。无论何时将文件写入SSD，计算机都必须首先擦除正在写入数据的扇区中的所有数据。它不能只在一次操作中“覆盖”扇区-它必须首先清除它们，然后写入空扇区。</p><p>这意味着SSD将随着时间的推移而变慢。第一次写入SSD的扇区会很快。在删除一些文件并尝试再次写入之后，将需要更长的时间。这是谷歌最初的Nexus7随着时间的推移变得如此缓慢的很大一部分原因。谷歌通过在android4.3中实现Trim修复了这个问题。(Android也使用Linux内核。)</p><p>启用修剪后，操作系统每次删除文件时都会通知SSD。然后，驱动器可以擦除包含文件内容的扇区，因此将来写入这些扇区将会很快。</p><p>换句话说，如果你不使用Trim，你的固态硬盘将会随着时间的推移而变慢。这就是包括Windows7+、MacOSX 10.6.8+和Android 4.3+在内的现代操作系统使用TRIM的原因。Trim早在2008年12月就在Linux中实现了，但是Ubuntu在默认情况下并没有使用它。</p><p>相关：什么是固态硬盘(SSD)，我是否需要固态硬盘？</p><p>为什么Ubuntu没有默认修剪？</p><p>Ubuntu在默认情况下不裁剪SSD的真正原因是，Linux内核的TRIM实现很慢，在正常使用时会导致较差的性能。</p><p>在Windows7和Windows8上，Windows每次删除文件时都会发送TRIM命令，告诉驱动器立即删除文件的位。当使用“Discard”选项挂载文件系统时，Linux支持此功能。然而，出于性能原因，Ubuntu和其他发行版在默认情况下不会这样做。</p><p>openSUSE的wiki包含一些详细信息，这些信息来自一位比我们更熟悉Linux内核的开发人员。这有点过时了，但当涉及到性能时，它可能仍然是正确的：</p><p>换句话说，Linux内核以一种缓慢的、未优化的方式处理这样的实时TRIM命令。启用Trim与Windows类似-即使用“Discard”选项-会导致系统实际上比根本不使用Trim时变慢。Ubuntu和其他Linux发行版在默认情况下不会为您的文件系统启用“丢弃”，您也不应该这样做。</p><img class="content_img" src="/image/44/4470b6050711ce39442edfa3b1fe0d47.png" /><p>还有另一种方法</p><p>因为Linux内核的实时“丢弃”Trim操作执行得不好，所以大多数Linux发行版--包括Ubuntu--不会自动使用Trim。在android4.3之前，android也没有使用trim。</p><p>但是还有另一种使用Trim的方法。可以使用FITRIM功能，而不是简单地在每次删除文件时发出TRIM命令。这是通过fstrim命令实现的。实质上，fstrim命令分析文件系统并通知驱动器哪些块不再需要，因此驱动器可以丢弃它们。这将修剪从实时操作转变为计划任务。换句话说，fstrim可以作为cron作业执行trim。没有理由不这么做。它不会减慢任何事情；它只是系统必须按计划执行的另一项房屋清理任务。</p><p>相关：为什么我的Nexus7速度这么慢？再次提高速度的8种方法</p><p>事实上，这就是谷歌在android4.3中采取的方法。Android只是偶尔运行一个fstrim任务来修剪文件系统，修复了拖慢所有Nexus7速度的问题。</p><p>Ubuntu还在考虑通过让系统定期运行fstrim来自动启用trim。这有望成为Ubuntu 14.04的一部分，这样Ubuntu用户就不会被迫面对SSD性能下降的问题，也不会自己运行fstrim。</p><p>如何启用修剪</p><p>我们不建议使用“丢弃”操作挂载您的文件系统，因为这可能会导致正常使用时的性能降低。但是，您可以通过偶尔运行fstrim命令或创建自己的cronjob(按计划运行fstrim)来自己使用trim。</p><p>要在Ubuntu上裁剪SSD，只需打开一个终端并运行以下命令：</p><img class="content_img" src="/image/57/57d38ce4b51bd2f6a3150074cad75535.png" /><p>您可以偶尔运行上述命令，以防止SSD上的性能下降。您需要运行它的频率取决于从SSD中删除文件的频率。如果尝试使用不支持TRIM的驱动器运行该命令，您将看到错误。</p><p>如果您想定期运行trim，只需创建一个cronjob来为您运行fstrim命令。下面是如何创建一个自动执行此操作的基本cron作业。</p><p>首先，运行以下命令，以root权限打开Nano文本编辑器：</p><p>在文件中键入以下代码：</p><img class="content_img" src="/image/41/4115ef9cf7589abdc92dd1450116c84f.png" /><p>按Ctrl+O保存文件，然后按Enter确认。保存文件后，按Ctrl+X关闭Nano。</p><p>最后，运行以下命令使脚本成为可执行的：</p><img class="content_img" src="/image/03/0304195c44a680a3ccf132662ad7cb70.png" /><p>Ubuntu现在将按计划运行fstrim，就像它执行其他系统维护任务一样。</p><p>请注意，Trim仅在现代文件系统上受支持，因此您将需要类似ext4的内容，而不是ext3或ext2。如果您不知道您使用的是什么文件系统，请不要担心-默认情况下选择ext4。</p><p>这个建议中的大部分也适用于其他Linux发行版。虽然Linux在很久以前就在内核中实现了TRIM支持，但是在Linux发行版中，它的TRIM支持似乎从未在缺省情况下为典型用户启用过。</p><p>图片来源：Flickr上的梅斯·奥贾拉(Mace Ojala)(裁剪)</p><div class="item_info"><span class="item_key"><a href="/tag/ssd/">ssd</a></span><span class="item_key"><a href="/tag/trim/">trim</a></span><span class="item_key"><a href="/tag/文件/">文件</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/10230.html">不要浪费时间优化您的固态硬盘，Windows知道它在做什么</a><li><a href="/story/8649.html">如何在Mac OS X上启用第三方SSD的修剪</a><li><a href="/story/7234.html">是时候了：为什么您现在需要升级到固态硬盘</a><li><a href="/story/6022.html">我是否需要使用第三方软件“优化”我的固态硬盘？</a><li><a href="/story/2780.html">什么是固态硬盘(SSD)，我是否需要固态硬盘？</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>