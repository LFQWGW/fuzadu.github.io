<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Shell脚本初学者指南2：for循环</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>Shell脚本初学者指南2：for循环</h2></div><div class="content"><img class="content_img" src="/image/d1/d1817249c4298b3b3c1be9df2161294b.png" /><p>如果您想要建立您的极客信誉，请加入我们的shell脚本系列的第二部分。我们有几处更正，对上周的脚本做了一些改进，并为初学者提供了一份关于循环的指南。</p><p>重新审视datecp脚本</p><p>在我们的shell脚本编写指南的第一部分中，我们编写了一个脚本，该脚本在将日期附加到文件名末尾之后，将文件复制到备份目录。</p><p>Samuel Dionne-Riel在评论中指出，有一种更好的方法来处理我们的变量引用。</p><p>如您所见，将我们的脚本行从：</p><p>致：</p><p>在对名称中包含空格的文件使用脚本时，会解决此问题。塞缪尔还指出，当从这个网站(或整个互联网)复制和粘贴代码时，一定要用适当的破折号和引号替换经常替换的“排版更好”的破折号和引号。我们还将做更多的工作来确保我们的代码对复制/粘贴更加友好。-)</p><p>另一位评论者Myles Braithwaite决定扩展我们的脚本，使日期显示在文件扩展名之前。因此，与其这样做，不如说</p><p>我们会得到这样的结果：</p><p>这最终为大多数用户提供了更多的便利。他的代码可以在他的GitHub页面上找到。让我们来看看他用什么来拆分文件名。</p><p>我稍微更改了格式，但是您可以看到Myles在第1行声明了他的Date函数，但是在第2行，他使用带有脚本第一个参数的“echo”命令来输出文件名。他使用PIPE命令获取该输出，并将其用作下一部分的输入。在管道之后，Myles调用“awk”命令，这是一个功能强大的模式扫描程序。使用-F标志，他告诉命令下一个字符(空格之后)将定义“字段分隔符”。在这种情况下，这是一个句号。</p><p>现在，awk看到名为“tastyfile.mp3”的文件由两个字段组成：“tastyfile”和“mp3”。最后，他使用</p><p>要显示最后一个字段，请执行以下操作。如果您的文件有多个句点-因此使awk可以看到多个字段-它将只显示最后一个字段，即文件扩展名。</p><p>在第3行，他为文件名创建了一个新变量，并使用“basename”命令引用$1中除文件扩展名以外的所有内容。这是通过使用basename并赋予它$1作为参数，然后添加空格和文件扩展名来实现的。由于引用第2行的变量会自动添加文件扩展名。</p><p>把它变成</p><p>然后，在最后一行中，Myles组合了将按顺序输出所有内容的命令。请注意，没有引用脚本的第二个参数$2。此特定脚本将把所述文件复制到您的当前目录中。做得好，塞缪尔和迈尔斯！</p><p>运行脚本和$PATH</p><p>我们还在我们的基础文章中提到，默认情况下不允许将脚本作为命令引用。也就是说，您必须指向脚本的路径才能运行它：</p><p>但是，通过将脚本放在~/bin/中，您只需在任何地方键入它们的名称就可以让它们运行。</p><p>评论者花了一些时间讨论这是否合适，因为没有任何现代Linux发行版默认创建该目录。此外，默认情况下也没有人将其添加到$PATH变量，这是脚本像命令一样运行所必需的。我有点困惑，因为在检查了我的$PATH变量之后，评论者是正确的，但是调用脚本对我来说仍然有效。我发现了原因：许多现代Linux发行版在用户的主目录.profile中创建了一个特殊的文件。</p><img class="content_img" src="/image/59/59ebb51ede43f10868c2b2aee7b80a49.png" /><p>该文件由bash读取(除非用户的主目录中存在.bash_profile)，并且在底部有一节将~/bin/文件夹添加到$PATH变量(如果存在)。那么，这个谜团就解开了。在本系列的其余部分中，我将继续将脚本放在~/bin/目录中，因为它们是用户脚本，应该能够由用户运行。而且，我们似乎并不真的需要手动处理$PATH变量来使其正常工作。</p><p>使用循环重复命令</p><p>让我们来看看极客武器库中处理重复性任务的最有用的工具之一：循环。今天，我们将讨论“for”循环。</p><p>for循环的基本轮廓如下：</p><p>变量可以是任何变量，尽管按照惯例，通常使用小写的“i”。List是项目列表；您可以指定多个项目(用空格分隔)，指向外部文本文件，或使用星号(*)表示当前目录中的任何文件。按照惯例，列出的命令是缩进的，因此更容易看到嵌套-将循环放入循环中(这样您可以在循环时进行循环)。</p><p>因为列表使用空格作为分隔符(即，空格表示移动到列表中的下一项)，所以名称中包含空格的文件不太友好。现在，让我们坚持使用不带空格的文件。让我们从一个显示当前目录中的文件名的简单脚本开始。在~/bin/文件夹中创建名为“loopscript”的新脚本。如果您不记得如何做到这一点(包括将其标记为可执行文件和添加hash bang hack)，请参阅我们的bash脚本基础文章。</p><p>在其中，输入以下代码：</p><img class="content_img" src="/image/d4/d40fabe5d6e88c2e6779d6f09bcf10e5.png" /><p>当您运行脚本时，您应该只获得这些列表项作为输出。</p><img class="content_img" src="/image/4d/4d1ee178b07232e9f471387c15309cd7.png" /><p>很简单，对吧？让我们看看如果我们稍微改变一下会发生什么。更改您的脚本，使其显示为：</p><img class="content_img" src="/image/12/12be5f2398bf669ed5cb3b6a7ea80e33.png" /><p>当您在文件夹中运行此脚本时，您应该会获得它包含的作为输出的文件列表。</p><img class="content_img" src="/image/e1/e11c28347a98f7be4dba4434548f4b99.png" /><p>现在，让我们将echo命令更改为更有用的命令-比方说，zip命令。也就是说，我们将把文件添加到存档中。而且，让我们在组合中加入一些论点！</p><img class="content_img" src="/image/81/81e31ff0fcc30951f36a3274a463a426.png" /><p>有新东西了！“$@”是“$1$2$3…”的快捷方式。$n“。换句话说，它是您指定的所有参数的完整列表。现在，观察当我使用几个输入文件运行脚本时会发生什么。</p><img class="content_img" src="/image/17/17586443ccf25dcb239032d051bdba0c.png" /><p>您可以看到哪些文件在我的文件夹中。我使用6个参数运行该命令，每个文件都被添加到名为“archive ve.zip”的压缩存档中。很简单，对吧？</p><p>因为循环是非常棒的。现在您可以对文件列表执行批处理函数。例如，您可以将脚本的所有参数复制到压缩存档中，将原始文件移动到不同的文件夹，并自动安全地将该压缩文件复制到远程计算机。如果您使用SSH设置密钥文件，您甚至不需要输入密码，甚至可以在上传zip文件后告诉脚本删除它！</p><p></p><p>使用for循环可以轻松地对目录中的所有文件执行一系列操作。您可以将各种各样的命令堆叠在一起，并非常容易地使用参数来创建和动态列表，而这只是冰山一角。</p><p></p><p>猛烈抨击的编剧们，你们有什么建议吗？您是否制作了一个使用循环的有用脚本？想分享你对这个系列的看法吗？留下一些评论，帮助其他脚本新手！</p><div class="item_info"><span class="item_key"><a href="/tag/脚本/">脚本</a></span><span class="item_key"><a href="/tag/文件/">文件</a></span><span class="item_key"><a href="/tag/命令/">命令</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14323.html">如何在Windows上将Caps Lock用作修改键</a><li><a href="/story/13819.html">如何将GUI添加到Linux Shell脚本</a><li><a href="/story/13415.html">如何在Linux上使用yes命令</a><li><a href="/story/13180.html">如何使用脚本编辑器为Google应用程序增压</a><li><a href="/story/13147.html">如何在进程退出时自动关闭MacOS终端</a><li><a href="/story/11555.html">如何在Windows中自动键入带双空格的句点</a><li><a href="/story/10454.html">如何在Windows 10上创建和运行Bash Shell脚本</a><li><a href="/story/7708.html">如何配置Windows以更轻松地使用PowerShell脚本</a><li><a href="/story/7704.html">如何使用批处理文件使PowerShell脚本更易于运行</a><li><a href="/story/7410.html">愚蠢的极客小把戏：如何让你的电脑与你对话</a><li><a href="/story/7370.html">在Windows上使窗口始终在最上面的3种最佳方法</a><li><a href="/story/6987.html">如何用PowerShell生成随机姓名和电话号码</a><li><a href="/story/4528.html">如何在Ubuntu上交换两个和三个手指触摸板轻击动作</a><li><a href="/story/3339.html">使用此简单脚本通过右键单击将文件上载到FTP站点</a><li><a href="/story/3146.html">Shell脚本初学者指南：基础知识</a><li><a href="/story/3024.html">如何在Ubuntu中使用热键关闭显示器</a><li><a href="/story/2913.html">使用自动热键脚本的初学者指南</a><li><a href="/story/2843.html">构建您自己的自动文件更新系统</a><li><a href="/story/2841.html">轻松保留所有网络计算机上本地文件的镜像备份</a><li><a href="/story/2839.html">使用简单的脚本诊断Linux服务器负载问题</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>