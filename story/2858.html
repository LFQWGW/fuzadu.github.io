<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何在Ubuntu上设置简单文件服务器的软件RAID</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何在Ubuntu上设置简单文件服务器的软件RAID</h2></div><div class="content"><img class="content_img" src="/image/ba/ba0079e91b4f1f6927763f45089b2651.jpg" /><p>您是否需要一台便宜、易于安装、“坚如磐石”、具有电子邮件提醒功能的文件服务器？我将向您展示如何使用Ubuntu、软件RAID和Samba来实现这一点。</p><p>概述 / 综述</p><p>尽管最近热议要将所有东西都移动到“万能”的云上，但有时你可能不想把你的信息放在别人的服务器上，或者每次都从互联网上下载你需要的海量数据(例如映像部署)可能是不可行的。因此，在您为存储解决方案腾出预算空间之前，请考虑Linux免费许可的配置。</p><p>尽管如此，便宜/免费并不意味着“把谨慎抛到脑后”，为此，我们将注意一些需要注意的事项，除了使用软件RAID之外，还应该设置哪些配置，以实现最高的性价比。</p><p>图片由Filomena Scalise提供</p><p>关于软件RAID</p><p>顾名思义，这是一个完全在软件中完成的RAID(廉价磁盘冗余阵列)设置，而不是使用专用硬件卡。这种东西的主要优点是成本，因为这种专用卡是系统基本配置的额外溢价。主要缺点是基本的性能和一些可靠性，因为这样的卡通常带有自己的RAM+CPU来执行冗余数学所需的计算，数据缓存以提高性能，以及可选的备用电池，它可以在断电的情况下将未写入的操作保留在缓存中，直到恢复供电。</p><p>使用软件RAID设置时，您会牺牲一些系统CPU性能以降低总系统成本，但是，对于今天的CPU，开销相对来说微不足道(特别是如果您打算将此服务器主要用作“文件服务器”)。就磁盘性能而言，…是有损失的。但是，我从来没有遇到过来自服务器的磁盘子系统的瓶颈，这是多么深刻的问题。Tom的硬件指南“Tom‘s Goes RAID5”是一篇关于这个主题的老掉牙但很好的详尽的文章，我个人用它作为参考，但是对基准测试持保留态度，因为它谈论的是Windows和软件RAID的实现(与其他一切一样，我相信Linux要好得多：p)。</p><p>先决条件</p><p>
耐心点，年轻人，这是一本很长的书。
假设您知道RAID是什么以及它的用途。
本指南是使用Ubuntu server9.10x64编写的，因此假设您也有一个基于Debian的系统可以使用。
你会看到我使用VIM作为编辑程序，这只是因为我习惯了…。您可以使用您喜欢的任何其他编辑器。
我用来编写本指南的Ubuntu系统安装在一个盘上。这样做可以让我将sda1用作RAID阵列的一部分，因此可以根据您的设置进行相应的调整。
根据您要创建的RAID类型，您的系统上至少需要两个磁盘，在本指南中，我们使用6个驱动器。</p><p>选择组成阵列的磁盘</p><p>避免陷阱的第一步是知道它的存在(来自沙丘的Thufir Hawat)。</p><p>选择磁盘是不能掉以轻心的重要一步，明智的做法是充分利用您真正的经验，并注意以下警告：</p><p>不要使用“消费级”驱动器来创建阵列，请使用“服务器级”驱动器！</p><p>现在我知道你在想什么了，我们不是说过要便宜一点吗？是的，我们做到了，但是，这并不是这样做是鲁莽的，应该避免的地方之一。尽管价格诱人，但消费级硬盘并不是为全天候使用而设计的。相信我，你的朋友真的为你试过了。在我像这样设置的3台服务器中，至少有4台消费级驱动器(由于预算限制)从服务器最初发布之日起大约1.5~1.8年后出现故障。虽然没有数据丢失，因为这次突袭做得很好，并在…中幸存下来。这样的时刻缩短了系统管理员的预期寿命，更不用说公司服务器维护的停机时间(这可能最终会比更高级别的驱动器成本更高)。</p><p>有人可能会说，这两种类型的不合格率没有差别。这可能是真的，然而，尽管有这些说法，服务器级驱动器仍然有更高级别的S.M.A.R.T限制和背后的QAing(可以从以下事实观察到)，即它们没有在消费驱动器一上市就发布，所以我仍然强烈建议您支付额外的$$用于升级。</p><p>选择RAID级别。</p><p>虽然我不打算讨论所有可用的选项(这在RAID Wikipedia条目中有很好的记录)，但我确实觉得值得注意的是，您应该始终选择至少RAID6或更高版本(我们将使用Linux RAID10)。这是因为当一个磁盘发生故障时，相邻磁盘发生故障的可能性更高，然后您就会遇到“两个磁盘”故障。此外，如果您要使用大型驱动器，因为较大的磁盘在盘片表面具有较高的数据密度，因此发生故障的可能性也较高。2T及以上版本的IMHO磁盘将始终属于此类别，因此请注意。</p><p>让我们开始行动吧</p><p>对磁盘进行分区</p><p>在Linux/GNU中，我们可以使用整个块设备来满足存储需求，但我们将使用分区，因为这样可以更容易地在系统出现故障时使用磁盘救援工具。我们在这里使用的是“fdisk”程序，但是如果您要使用大于2T的磁盘，则需要使用支持GPT分区的分区程序，如parted。</p><p>注意：我观察到可以在不更改分区类型的情况下创建阵列，但是因为这是整个网络中描述的方式，所以我将效仿(同样，当使用整个块设备时，这是不必要的)。</p><p>进入fdisk后，击键为：</p><p>N*；用于新分区。
vt.进入，进入。
对于主分区，P*；
vt.进入，进入。
1个分区，1个分区，1个分区，1个分区，1个分区，1个分区，分区数。
输入“0”；接受默认值。
输入“0”；接受默认值。
t=更改类型。
fd*；将类型设置为“Linux RAID自动检测”(83h)。
W创建文件系统；将更改写入磁盘并退出</p><p>对将成为阵列一部分的所有磁盘进行清洗并重复上述操作。</p><p>创建Linux RAID10阵列</p><p>使用“Linux raid10”的优势在于，它知道如何利用非偶数个磁盘来进一步提高性能和弹性，甚至比普通的RAID10还要高，此外，在使用它时，可以在一个步骤中创建“10”阵列。</p><p>通过执行以下命令，从我们在上一步中准备的磁盘创建阵列：</p><p>注意：尽管表示法将其一分为二，但这只是一行。</p><p>我们来细分一下参数：</p><p>
“-chunk=256”-表示RAID条带被打断到的字节大小，建议将此大小用于新磁盘/大磁盘(用于制作本指南的2T驱动器毫无疑问属于该类别)。
“-level=10”-使用Linux raid10(如果需要传统的RAID，无论出于什么原因，您都必须创建两个阵列并将它们连接在一起)。
“-p f2”-使用“远”循环计划，有关详细信息，请参阅下面的注释，“2”表示阵列将保留两份数据副本。</p><p>注意：我们使用“远”计划，因为这会导致磁盘上的物理数据布局不同。这有助于克服其中一个驱动器的硬件由于制造故障而出现故障的情况(并且不要认为“这种情况不会发生在我身上”，就像您真正做到的那样)。由于这两个磁盘的制造商和型号相同，所以一直以相同的方式使用，并且传统上一直将数据保存在相同的物理位置…上。存在这样的风险，即保存数据副本的驱动器也已发生故障或接近故障，在更换磁盘到达之前无法提供所需的恢复能力。“远”计划使数据分布到复制驱动器上的完全不同的物理位置，此外还使用计算机机箱内彼此不靠近的磁盘。更多信息可以在这里和下面的链接中找到。</p><p>创建阵列后，它将开始同步过程。虽然您可能希望出于传统原因等待(因为这可能需要一段时间)，但是您可以立即开始使用该数组。</p><p>可以使用以下工具观察进度：</p><p>创建mdadm.conf配置文件</p><div class="item_info"><span class="item_key"><a href="/tag/使用/">使用</a></span><span class="item_key"><a href="/tag/磁盘/">磁盘</a></span><span class="item_key"><a href="/tag/raid/">raid</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14584.html">如何检查Linux上安装了哪个GPU</a><li><a href="/story/14577.html">如何检查Linux上安装了哪个GPU</a><li><a href="/story/14572.html">如何使用Jouralctl读取Linux系统日志</a><li><a href="/story/14555.html">2020年CES最佳：我们今年看到的所有最好的东西</a><li><a href="/story/14467.html">如何在Windows 10上切换到本地用户帐户</a><li><a href="/story/14450.html">如何在Excel中将一长列变为多列</a><li><a href="/story/14438.html">如何在iPhone上创建和使用Memoji和Animoji</a><li><a href="/story/14426.html">如何使用Google Sheets中的查询功能</a><li><a href="/story/14419.html">如何在Linux中获取文件或目录的大小</a><li><a href="/story/14377.html">如何在Google Sheets中使用AND和OR函数</a><li><a href="/story/14353.html">如何使用触摸板、鼠标或键盘右键单击任何Mac</a><li><a href="/story/14296.html">如果您的Windows 10键盘或鼠标无法工作，该怎么办</a><li><a href="/story/14262.html">iPhone11上的Deep Fusion摄像头是什么？</a><li><a href="/story/14257.html">如何在Linux上编写fstab文件</a><li><a href="/story/14202.html">什么是利特语，你是如何使用它的？</a><li><a href="/story/14168.html">刚刚更新到iOS 13吗？立即更改这八个设置</a><li><a href="/story/14142.html">为什么您应该登录Google、Facebook或Apple</a><li><a href="/story/14130.html">如何在Windows 10中的每个显示器上设置不同的墙纸</a><li><a href="/story/14121.html">如何在Linux上使用chroot命令</a><li><a href="/story/14036.html">如何在Chrome中从图像中抓取文本</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>