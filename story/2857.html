<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>用于无头Linux服务器的硬盘监控脚本</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>用于无头Linux服务器的硬盘监控脚本</h2></div><div class="content"><img class="content_img" src="/image/f8/f8cda77b5018a14dc96e79f65e9c7dfa.png" /><p>现代硬盘驱动器有一种称为S.M.A.R.T.的内部机制，通过它可以知道硬盘何时即将发生故障。服务器能在这样的故障之前给你发邮件不是很好吗？</p><p>概述 / 综述</p><p>诸如“mdadm”(用于软件RAID管理)和“Palimpsest Disk Utility”(在Ubuntu LiveCD上使用)等程序使用S.M.A.R.T信息通知您磁盘即将发生故障或已经发生故障。然而，在无头服务器(无GUI)上，没有任何服务可以在为时已晚之前通知您即将到来的厄运。此外，如果不手动登录服务器，您如何知道这一点？</p><p>使用cron每天运行一次此脚本时，如果系统的任何硬盘坏扇区计数达到故意低于“磁盘损坏”阈值的限制，它将发出警报，并通过电子邮件将警告发送给机器管理员。</p><p>前提条件和假设</p><p>
您已经使用“如何在Linux上设置电子邮件警报”指南为服务器设置了电子邮件支持。
您使用的是基于Debian的系统。
您没有使用*硬件RAID控制器。
你会看到我使用VIM作为编辑程序，这只是因为我习惯了…。您可以使用您喜欢的任何其他编辑器。</p><p>*因为硬件RAID控制器很可能会阻止系统访问此信息。</p><p>布设</p><p>安装“SmartMontools”软件包，该软件包从硬盘控制器读取S.M.A.R.T信息并将其呈现给我们。</p><p>创建监控脚本：</p><p>就这样吧，这就是内容：</p><p>需要注意的要点是：</p><p>
电子邮件功能-设置适当的信息，如机器名称和管理员电子邮件。
允许的阈值-将此参数设置为您认为合适的值，我之所以使用5，是因为我使用的“服务器级”硬盘的限制设置为10。(我发现“消费级”硬盘的阈值高达140)。
通过调整“for”循环中的磁盘名称枚举来设置要监视的设备。目前包括两个磁盘(SDA和SDB)，因此请根据您的设置进行调整。如果出于某种原因需要*排除某个磁盘，您可以包括所有磁盘，也可以只包括部分磁盘。</p><p>*在我最初的设置中，第一个磁盘是闪存驱动器，所以如果可能的话，读取它的信息没有多大用处。</p><p>使脚本可执行：</p><p>设置完成。</p><p>将脚本安排为自动运行</p><p>我们想让脚本自动运行，因此我们将为它创建一个新的Cron作业。
正如“如何在Linux上设置电子邮件警报”指南中所述，这样做的结果是，如果脚本本身遇到错误，cron会自动通过电子邮件通知我们。</p><p>打开cron作业调度程序：</p><p>将此内容添加到其内容中：</p><p>这会将脚本设置为每天早上7点运行</p><div class="item_info"><span class="item_key"><a href="/tag/设置/">设置</a></span><span class="item_key"><a href="/tag/使用/">使用</a></span><span class="item_key"><a href="/tag/脚本/">脚本</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14714.html">如何在Microsoft Edge中启用黑暗模式</a><li><a href="/story/14641.html">如何在Microsoft Edge中使用多个用户配置文件</a><li><a href="/story/14559.html">如何在Windows 10上禁用首次登录动画</a><li><a href="/story/14416.html">如何在Windows 10中设置密码过期日期</a><li><a href="/story/14359.html">如何在Windows 10中扫描文档</a><li><a href="/story/14287.html">如何在Google Pixel4和Pixel4XL上设置面部解锁</a><li><a href="/story/14261.html">如何防止面部解锁绕过Google Pixel4的锁屏</a><li><a href="/story/14256.html">如果我的计算机处于睡眠模式，Windows 10是否会更新？</a><li><a href="/story/14126.html">如何在iPhone或iPad上更改应用程序的语言</a><li><a href="/story/14094.html">如何禁用或启用点击以单击PC的触摸板</a><li><a href="/story/13955.html">如何为NVIDIA显卡启用超低延迟模式</a><li><a href="/story/13911.html">如何在Windows 10上打开控制面板</a><li><a href="/story/13903.html">如何让联系人绕过IOS的免打扰模式</a><li><a href="/story/13787.html">如何出厂重置路由器</a><li><a href="/story/13668.html">如何在Windows 10上更改鼠标指针的颜色和大小</a><li><a href="/story/13647.html">如何将Chrome设置重置为默认值</a><li><a href="/story/13587.html">如何在Microsoft Word中创建帐簿</a><li><a href="/story/13510.html">如何在Windows 10上启用Windows安全篡改保护</a><li><a href="/story/13466.html">Windows 10的最新版本是什么？</a><li><a href="/story/13018.html">如何隐藏特定Word文档中的拼写和语法错误</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>