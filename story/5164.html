<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何使用rsync在Linux上备份数据</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何使用rsync在Linux上备份数据</h2></div><div class="content"><img class="content_img" src="/image/c5/c596cf7b75ec093e964157d33e18675b.jpg" /><p>Rsync是一种为类Unix系统构建的协议，它为备份和同步数据提供了令人难以置信的多功能性。它可以用于在本地将文件备份到不同的目录，也可以配置为通过Internet同步到其他主机。</p><p>它可以在Windows系统上使用，但只能通过各种端口(如Cygwin)使用，因此在本操作指南中，我们将讨论如何在Linux上设置它。首先，我们需要安装/更新rsync客户端。在Red Hat发行版上，命令是“yum install rsync”，在Debian上是“sudo apt-get install rsync”。</p><img class="content_img" src="/image/d5/d5bf9ea96b17bcffaef7eaea5d7e59cc.jpg" /><img class="content_img" src="/image/8b/8bca6ce6089f05cbddee1f639477296a.jpg" /><p>使用rsync进行本地备份</p><p>在本教程的第一部分中，我们将把文件从Directory1备份到Directory2。这两个目录位于同一硬盘驱动器上，但如果这两个目录位于两个不同的驱动器上，则其工作方式完全相同。根据您要配置的备份类型，我们有几种不同的方法来解决此问题。对于大多数目的，下面一行代码就足够了：</p><p>上面的代码会将Directory1的内容同步到Directory2，并且两者之间没有不同之处。如果rsync发现Directory2具有Directory1没有的文件，它将删除该文件。如果rsync在Directory1中发现已更改、创建或删除的文件，它会将这些更改反映到Directory2。</p><p>有许多不同的开关可供rsync使用，以根据您的特定需求对其进行个性化设置。以下是上述代码告诉rsync对备份执行的操作：</p><p>1.-a=递归(递归到目录中)、链接(将符号链接复制为符号链接)、权限(保留权限)、时间(保留修改时间)、组(保留组)、所有者(保留所有者)、保留设备文件和保留特殊文件。
2.-v=详细。我认为详细的原因很重要，这样您就可以确切地看到rsync正在备份什么。想想看：如果您的硬盘坏了，并且在您不知情的情况下开始删除文件，那么运行rsync脚本会将这些更改推送到备份中，从而删除您不想删除的文件的所有实例呢？
3.-delete=这将告诉rsync删除Directory2中不在Directory1中的所有文件。如果您选择使用此选项，出于上述原因，我还建议您使用详细选项。</p><p>使用上面的脚本，下面是使用rsync将Directory1备份到Directory2所生成的输出。请注意，如果没有详细开关，您不会收到如此详细的信息。</p><img class="content_img" src="/image/99/992e7baa453890788f2934c04bd0b97d.jpg" /><p>上面的屏幕截图告诉我们，检测到File1.txt和File2.jpg是新的或以其他方式更改了Directory2中存在的副本，因此对它们进行了备份。noob提示：请注意我的rsync命令中目录末尾的斜杠-这些是必需的，请务必记住它们。</p><p>在本教程接近尾声时，我们将再介绍几个方便的开关，但请记住，要查看完整的清单，您可以键入“man rsync”并查看要使用的开关的完整列表。</p><p>就本地备份而言，这大约涵盖了它。正如您可以看出的，rsync非常易于使用。使用它通过Internet与外部主机同步数据时会稍微复杂一些，但我们将向您展示一种简单、快速和安全的方法。</p><p>使用rsync进行外部备份</p><p>对于外部备份，可以通过几种不同的方式配置rsync，但我们将介绍通过SSH隧道传输rsync的最实用(也是最简单、最安全)的方法。大多数服务器甚至很多客户端都已经有了SSH，并且它可以用于您的rsync备份。我们将向您展示如何将一台Linux计算机备份到本地网络上的另一台计算机。如果一台主机在Internet上的某个地方，该过程将完全相同，只需注意端口22(或您在其上配置了SSH的任何端口)将需要在服务器端的任何网络设备上转发。</p><p>在服务器(将接收备份的计算机)上，确保安装了SSH和rsync。</p><p>除了在服务器上安装SSH和rsync之外，真正需要做的就是在希望备份文件的服务器上设置存储库，并确保锁定SSH。确保您计划使用的用户具有复杂的密码，并且切换SSH侦听的端口(缺省值为22)也可能是个好主意。</p><p>我们将运行与在本地计算机上使用rsync相同的命令，但包括通过SSH将rsync通过隧道传输到我的本地网络上的服务器所需的附加内容。对于用户“geek”连接到“192.168.235.137”并使用与上面相同的开关(-av-delete)，我们将运行以下命令：</p><p>如果您的ssh侦听的端口不是22，则需要指定端口号，例如在本例中，我使用端口12345：</p><img class="content_img" src="/image/3f/3f8169772ae6d4a6d683b4596b76c69e.jpg" /><p>正如您从上面的屏幕截图中看到的，跨网络备份时给出的输出与本地备份时的输出基本相同，唯一不同的是您使用的命令。另请注意，它提示输入密码。这是使用SSH进行身份验证。您可以设置RSA密钥以跳过此过程，这也将简化自动rsync。</p><p>自动执行rsync备份</p><p>可以在Linux上使用Cron自动执行命令，比如rsync。使用Cron，我们可以让Linux系统每晚运行备份，或者您希望它们运行的频率。</p><p>要编辑您登录的用户的cron表文件，请运行以下命令：</p><p>您需要熟悉vi才能编辑此文件。键入“i”作为INSERT，然后开始编辑cron表文件。</p><p>Cron使用以下语法：一小时中的分钟、一天中的小时、月中的一天、一年中的月、星期几、命令。</p><p>一开始可能会有点困惑，所以让我给您举个例子。以下命令将在每晚10点运行rsync命令：</p><p>第一个“0”指定每小时的分钟数，“22”指定晚上10点。由于我们希望每天运行此命令，因此我们将保留其余字段的星号，然后粘贴rsync命令。</p><p>配置完Cron后，按Esc键，然后键入“：wq”(不带引号)并按Enter键。这将在vi中保存您的更改。</p><p>Cron可以得到比这更深入的内容，但是关于它的深入内容超出了本教程的范围。大多数人只想要一个简单的每周或每日备份，我们已经向您展示了您可以很容易地实现这一点。有关Cron的更多信息，请参阅手册页。</p><p>其他有用的功能</p><p>您可以做的另一件有用的事情是将您的备份放到一个zip文件中。您需要指定想要放置zip文件的位置，然后将该目录rsync到您的备份目录。例如：</p><img class="content_img" src="/image/57/57a6955cd17e364f893e490ea88c605b.jpg" /><p>上面的命令从Directory1获取文件，将它们放在/ZippedFiles/archive ve.zip中，然后将该目录rsync到Directory2。最初，您可能会认为这种方法对于大型备份来说效率很低，因为每次对文件进行最轻微的更改都会更改zip文件。但是，rsync只传输更改的数据，所以如果zip文件是10 GB，然后将一个文本文件添加到Directory1，则rsync将知道这是您添加的全部内容(即使它在zip中)，并且只传输几千字节的更改数据。</p><p>有几种不同的方法可以加密rsync备份。最简单的方法是在硬盘本身(您的文件要备份到的硬盘)上安装加密。另一种方法是在将文件发送到远程服务器(或其他硬盘驱动器，无论您要备份到什么位置)之前对文件进行加密。我们将在后面的文章中介绍这些方法。</p><p>无论您选择什么选项和功能，rsync都被证明是迄今为止最高效、功能最多的备份工具之一，即使是一个简单的rsync脚本也可以让您避免丢失数据。</p><div class="item_info"><span class="item_key"><a href="/tag/rsync/">rsync</a></span><span class="item_key"><a href="/tag/备份/">备份</a></span><span class="item_key"><a href="/tag/使用/">使用</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/13678.html">如何备份您的Linux系统</a><li><a href="/story/6251.html">使用rsync同步数据的非初学者指南</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>