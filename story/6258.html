<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Linux环境下的Z文件系统(ZFS)简介</title><link rel="stylesheet" href="/css.css"><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?f75329719d379998b2421a4cc2396366";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>Linux环境下的Z文件系统(ZFS)简介</h2></div><div class="content"><img class="content_img" src="/image/55/55181be74ed6cc80a82a71f3b2f6bce0.jpg" /><p>ZFS通常被数据囤积者、NAS爱好者和其他极客使用，他们更喜欢信任自己的冗余存储系统，而不是云。它是一个很棒的文件系统，可以用来管理多个数据磁盘，可以与一些最好的RAID设置相媲美。</p><p>肯尼·路易摄。</p><p>什么是ZFS，我为什么要使用它？</p><p>Z文件系统是Sun Microsystems为在其Solaris操作系统中使用而构建的免费开源逻辑卷管理器。它的一些最吸引人的功能包括：</p><p>无穷无尽的可扩展性</p><p>嗯，从技术上讲，它不是无穷无尽的，但它是一个128位的文件系统，能够管理ZB字节(10亿TB)的数据。“无论你有多少硬盘空间，ZFS都适合管理它。</p><p>最大程度的完整性</p><p>您在ZFS中所做的每件事都使用校验和来确保文件的完整性。您可以放心，您的文件及其冗余副本不会遇到静默的数据损坏。此外，当ZFS忙于悄悄地检查您的数据的完整性时，它会随时自动修复。</p><p>驱动器池</p><p>ZFS的创建者希望你认为它类似于你的电脑使用RAM的方式。当你的电脑需要更多内存时，你放入另一个棍子，就完成了。与ZFS类似，当你需要更多硬盘空间时，你放入另一个硬盘，你就完成了。不需要花费时间对你的磁盘进行分区、格式化、初始化或对磁盘做任何其他事情-当你需要更大的存储“池”时，只需添加磁盘即可。</p><p>冗余独立磁盘阵列</p><p>ZFS可以支持许多不同的RAID级别，同时提供与硬件RAID控制器相当的性能。“这使您可以省钱，使设置更容易，并可以访问ZFS改进过的高级RAID级别。”</p><p>安装ZFS</p><p>由于我们只介绍本指南中的基础知识，因此我们不打算将ZFS安装为根文件系统。*本节假设您使用的是ext4或其他文件系统，并且希望将ZFS用于一些辅助硬盘驱动器。*以下是在一些最流行的Linux发行版上安装ZFS的命令。</p><p>Solaris和FreeBSD应该已经安装了ZFS，可以使用了。</p><p>Ubuntu：</p><p>Debian：</p><p>RHEL/CentOS：</p><p>如果您有其他发行版，请查看zfsonlinux.org并单击“Packages”列表下的发行版，以获取有关如何安装ZFS的说明。</p><p>当我们继续阅读本指南时，我们将使用Ubuntu，因为它似乎是Linux极客的首选。“不管怎样，你应该仍然可以跟随，因为ZFS命令在不同的发行版中不会改变。</p><p>安装需要相当长的时间，但是一旦安装完成，请运行$sudo ZFS list以确保安装正确。*您应该会得到如下所示的输出：</p><img class="content_img" src="/image/7c/7c00ae5dc684a842e51b37b3cc087062.jpg" /><p>我们现在使用的是全新安装的Ubuntu服务器，只有一个硬盘。</p><img class="content_img" src="/image/7b/7baca27545344ed3580d6099e7df1919.jpg" /><p>配置ZFS</p><p>现在，假设我们在计算机中多放了6个硬盘。</p><p>$sudo fdisk-l|grep error将显示我们刚刚安装的六个硬盘。它们当前不可用，因为它们不包含任何类型的分区表。</p><img class="content_img" src="/image/d6/d6a2e7d360e60fc6c293f1674b351fff.jpg" /><p>正如我们前面提到的，ZFS的好处之一是我们不需要为分区而烦恼(尽管如果您愿意，您可以这样做)。让我们首先通过运行以下命令来获取三个硬盘，并将它们放入存储池：</p><p>zpool create是用于创建新存储池的命令，-f覆盖发生的任何错误(例如，如果磁盘已经有关于它们的信息)，geek1是存储池的名称，/dev/sdb/dev/sdc/dev/sdd是我们放入池中的硬盘驱动器。</p><p>创建池之后，您应该能够使用df命令或sudo ZFS列表查看它：</p><img class="content_img" src="/image/d3/d3cd736d6825a98dcc8e1dc127d817e1.jpg" /><p>如您所见，/geek1已经挂载，可以使用了。</p><p>如果要查看为池选择了哪三个磁盘，可以运行sudo zpool status：</p><img class="content_img" src="/image/5c/5cd60fa09785eb3f70347baa1e0cd9e8.jpg" /><p>到目前为止，我们所做的是创建一个9 TB的动态条带池(实际上是RAID 0)。如果您不熟悉这意味着什么，假设我们在/geek1上创建了一个3 KB的文件。1 KB会自动转到SDB，1 KB会自动转到SDC，1 KB会转到SDD。然后，当我们读取3 KB文件时，每个硬盘都会向我们提供1 KB，速度相当于这三个驱动器的速度。这使得写入和读取数据变得很快，但也意味着我们有一个单点故障。</p><p>假设保护数据比快速访问数据更重要，让我们来看看其他流行的设置。首先，我们将删除已创建的zpool，以便可以在更冗余的设置中使用这些磁盘：</p><p>BAM，我们的zpool消失了。这一次，让我们使用我们的三个磁盘来创建一个RAID-Z池。RAID-Z基本上是RAID 5的改进版本，因为它通过使用写入时复制来避免“写入漏洞”。RAID-Z至少需要三个硬盘驱动器，在某种程度上是RAID 0和RAID 1之间的折衷。在RAID-Z池中，您仍然可以获得块级条带化的速度，但也将拥有分布式奇偶校验。如果池中的单个磁盘失效，只需更换磁盘，ZFS将根据来自其他磁盘奇偶校验信息自动重建数据。如果要丢失存储池中的所有信息，则必须有两个磁盘失效。*要使事情变得更加冗余，您可以使用RAID 6(在ZFS的情况下是RAID-Z2)并具有双重奇偶校验。</p><p>为此，我们可以使用与前面相同的zpool create命令，但在池名称后指定raidz：</p><img class="content_img" src="/image/ff/ff9a5acf0e664e39ec2cb1c72ba82b0a.jpg" /><p>如您所见，df-h显示我们的9 TB池现在已减少到6 TB，因为3 TB用于保存奇偶校验信息。使用zpool status命令，我们看到我们的池与以前基本相同，但现在使用的是RAID-Z。</p><p>为了展示向我们的存储池添加更多磁盘是多么容易，让我们将另外三个磁盘(另外9 TB)作为另一个RAID-Z配置添加到我们的geek1存储池：</p><p>我们最终得到：</p><img class="content_img" src="/image/2d/2dd9da1fda946067cfe032e7bd95101d.jpg" /><p>传奇继续…</p><p>我们对ZFS及其功能几乎没有了解，但是使用您在本文中学到的知识，您现在应该能够创建数据的冗余存储池。请与我们一起查看未来关于ZFS的文章，查看手册页，并搜索无穷无尽的利基指南和涉及ZFS功能的YouTube视频。</p><div class="item_info"><span class="item_key"><a href="/tag/zfs/">zfs</a></span><span class="item_key"><a href="/tag/使用/">使用</a></span><span class="item_key"><a href="/tag/磁盘/">磁盘</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/10882.html">如何在Ubuntu上安装和使用ZFS(以及为什么要这样做)</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>