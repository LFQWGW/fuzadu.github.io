<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何将树莓PI用作Mac的网络时光机驱动器</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何将树莓PI用作Mac的网络时光机驱动器</h2></div><div class="content"><img class="content_img" src="/image/4e/4eda5128d465ec8ee49ee59b162b5264.png" /><p>既然你可以用树莓PI和外置硬盘自己做一个时间胶囊，为什么还要花300美元买一个机场时间胶囊呢？这需要进行一些调整，但一旦全部设置完毕，您的Mac将自动备份，而您无需付出任何努力。不再需要将驱动器插入您的计算机。</p><p>更棒的是：当需要恢复文件时，您可以从PI上拔下硬盘，直接将其插入您的Mac，这样您就可以使用系统恢复功能从整个系统故障中恢复。类似的黑客攻击不会以这种方式进行。</p><p>您需要的是什么</p><p>我们已经向您展示了如何使用Time Machine备份Mac，甚至如何通过网络执行Time Machine备份。但在这些教程中，通过网络进行备份需要另一台Mac充当服务器。因此，如果你住在一个只有一台Mac的家庭里，你可能会认为你唯一的选择就是插上USB硬盘或买一个300美元的苹果时间胶囊(Apple Time Capsage)。</p><p>那是胡说。Raspberry Pi连接到外部硬盘驱动器，是时间胶囊或另一台Mac的一个很好的即兴替代品，而且价格便宜得多。(是的，时间胶囊确实包括路由器功能，所以对于它提供的功能来说，这实际上是一个不错的价格-但这种方法让你可以使用任何你想要的路由器，并在你的驱动器空间不足时提供更多的升级空间。)</p><p>本教程假设您已经知道如何设置Raspberry PI的基础知识。它还需要一些设备：</p><p>
一种覆盆子派。任何型号都可以，但目前的型号是覆盆子派3型B。
一张SD卡，用于Raspberry Pi的操作系统。较旧的Raspberry PI将使用标准SD卡，而较新的将需要microSD卡，因此请确保选择正确的型号。这里有一个很好的列表，通过测试可以在PI中很好地工作。
PI的电源。Pis电源端口只是microUSB，但我们建议使用专为PI设计的电源，以实现可靠的性能-CanaKit的这个电源工作得很好。
PI的有线网络连接(您可以使用Wi-Fi，但需要更多设置，而且对于大型网络备份，有线会更好)。
一个外置硬盘，你可以通过USB连接到PI。我们建议您购买带专用电源的台式机外置硬盘，除非您的USB供电驱动器已经过测试，可以与PI配合使用。</p><p>你可以用这样一个很好的树莓Pi入门工具包一口气买到大部分这些东西(甚至更多)，或者你也可以单独购买。你说了算。</p><p>我从Caleb Woods的一篇博客文章中了解到了这个方法，并通过阅读Badbox.de上的这篇文章填写了一些对我不起作用的内容。我向你们两位致以诚挚的谢意。</p><p>最后要注意的是：根据我的经验，这个黑客工作得很好，但归根结底，它仍然只是一次黑客攻击。出于这个原因，我建议在此之外进行一些备份，最好是异地备份。(无论如何，您都应该有一个异地备份，以防发生火灾或其他自然灾害。)</p><p>相关：如何使用Time Machine备份Mac和恢复文件</p><p>第一步：为时光机准备外置硬盘</p><p>您需要做的第一件事是准备外部驱动器，以便与Time Machine一起工作。将驱动器插入Mac，然后启动Disk Utility。选择您的外置驱动器，然后单击“擦除”按钮。您可能希望将驱动器格式化为“Mac OS Extended”，也称为“MacOS Extended”。</p><img class="content_img" src="/image/ac/acb9c587e28d7e77883650cf4e2dfee4.png" /><p>接下来，我们要确保您的Raspberry PI和每个设备都具有控制驱动器的权限。找到Finder，然后右键单击侧栏中的驱动器。单击“获取信息”。</p><img class="content_img" src="/image/4a/4afe567310d76c6f28d2c34f760e639b.png" /><p>在打开的窗口底部，您可以找到权限设置。</p><img class="content_img" src="/image/ae/ae1f3266d2ab67d15ce550dec8e15433.png" /><p>单击右下角的锁，然后输入您的密码。接下来，选中“忽略此卷的所有权”。这样，您就可以将外部驱动器连接到PI了。</p><p>第二步：在您的PI上安装Raspbian并通过SSH连接到它</p><p>接下来，您将不需要使用Raspbian设置您的Raspberry PI，如本文所述。我们不会在这里详细介绍这个过程，因为它本身就是一个项目，所以请查看该指南，以便在您的PI上设置Raspbian。我使用Raspbian Core进行设置，因为我没有将PI连接到显示器，但是没有理由Raspbian的完整GUI版本不能正常工作。</p><p>说到这一点：当涉及到本教程的其余部分时，您有两个选择。你可以把你的树莓PI连接到键盘和显示器上，然后进行设置，或者你也可以通过SSH连接到你的PI，然后在你的Mac上舒适地运行每一步。我们认为SSH方法比查找随机监控器容易得多，所以下面是如何做到这一点的。</p><img class="content_img" src="/image/18/1897947fa5a1b02f327dcca320e97dd1.png" /><p>在Mac上启动终端，然后输入以下命令：</p><p>邮箱：ssh pi@192.168.1.11</p><p>将192.168.1.11替换为您的PI的IP地址。通过转到路由器的Web界面，您可以找到连接到您的网络的任何设备的IP地址，包括您的Raspberry PI。</p><p>然后会要求您输入默认用户pi的密码。默认情况下，pi的密码是raspberry。</p><p>如果您是第一次连接到新系统，我建议您在继续之前配置一些东西。首先，运行sudo raspi-config并更改默认密码。如果您有一个很大的SD卡，您还可以在这里扩展您的默认文件系统(尽管这对于本教程来说不是必需的)。您的覆盆子PI将重新启动，此时您就可以开始工作了。</p><p>第三步：挂载您的外置驱动器</p><p>在您可以设置您的时光机之前，您需要挂载驱动器，以便您的树莓PI可以对其进行读写。要做到这一点，需要安装一些软件。首先，确保PI上的所有软件都是最新的。依次运行以下两个命令：</p><p>数独APT-GET更新</p><p>SUDO APT-获取升级</p><p>接下来，安装两个包：hfsprogs和hfplus。这些将让您的Raspberry PI读取您的Mac格式的驱动器。</p><p>sudo apt-get install hfsprogs hfplus</p><img class="content_img" src="/image/70/7022460cdd30c50bd29f259494cbdc25.png" /><p>你现在已经有了能够挂载你的硬盘的软件，但它需要知道要挂载哪个驱动器，所以你需要做一些研究。从启动Parted开始。</p><p>SUDO/sbin/Parted</p><p>接下来，键入print以查看当前连接的驱动器列表。您应该在这里看到您的外置驱动器。</p><img class="content_img" src="/image/86/860270e538767a131cea5cfc8b3458ee.png" /><p>从这个屏幕截图中，我们可以看到我的硬盘是一个164 GB的Maxtor硬盘(我保证，稍后我会买一个更大的)。这里的重要信息是/dev/sda。您的驱动器将具有类似的名称，您应该将其记下来。</p><p>接下来，请看该文本块下方的表格。在我的例子中，很明显第二个更大的分区就是我要找的。因此，我注意到我要挂载的分区是sda2。如果您的驱动器上有多个驱动器或多个分区，则可能需要稍有不同的数字。</p><p>现在您已经有了所需的信息，请键入Quit，然后按Enter键。接下来，我们将创建一个文件夹，该文件夹将用作我们的挂载点…</p><p>sudo mkdir-p/media/tm</p><p>…。然后将一些信息添加到FSTAB文件中。使用此命令打开文本编辑器：</p><p>SUDO Nano/etc/fstab</p><p>将以下行粘贴到文档中，如果/dev/sda2与/dev/sda2不同，请将/dev/sda2替换为您的驱动器分区。</p><p>/dev/sda2/media/tm hfplus force，rw，user，auto 0 0</p><img class="content_img" src="/image/c0/c0b64e4880c4bc81a32762187889d0c3.png" /><p>粘贴文本后，按Ctrl+X离开编辑器，并确保在执行此操作时保存。</p><p>然后，使用以下命令装载驱动器：</p><p>SUDO MOUNT-A</p><p>如果您没有看到错误消息，祝贺您！您已成功装入驱动器。</p><p>第三步：编译和安装Netatalk</p><p>Netatalk是一款模拟AFP的软件，AFP是苹果目前用于Time Machine备份的网络协议。您可以使用sudo apt-get install netatalk安装旧版本的Netatalk，但我强烈建议您不要这样做。由于(主要是政治)复杂的原因，Debian-Raspbian的基础上-在其存储库中提供了一个非常过时的Netatalk版本。你可以用这个过时的Netatalk版本让Time Machine工作，但根据我的经验，这很令人沮丧。</p><p>因此，我建议您编译最新版本。安装起来比较麻烦，但值得。</p><p>首先，您需要安装依赖项。以下是您需要安装的所有内容，只需一个命令：</p><p>sudo智能安装build-Essential libeevent-dev libssl-dev libgcrypt11-dev libkrb5-dev libpam0g-dev libwrap0-dev libdb-dev libtdb-dev libmysqlclient-dev avahi-daemon libavahi-client-dev libacl1-dev libldap2-dev libcrack2-dev system</p><p>这可能需要一段时间才能安装。接下来，下载最新版本的Netatalk。在撰写本文时，版本是3.1.10，不过您可能希望查看netatalk的主页以获取最新的版本号。然后，运行以下命令下载它：</p><p>WGET http://prdownloads.sourceforge.net/netatalk/netatalk-3.1.10.tar.gz</p><p>如果您在其网站上找到较新的版本，请更换版本号。</p><p>现在，使用以下命令解压下载的文件：</p><p>tar-xf netatalk-3.1.10.tar.gz</p><p>然后切换到您刚刚创建的新文件夹。</p><p>CD netatalk-3.1.10</p><p>接下来，您可以使用以下命令在编译程序之前配置netatalk的所有设置：</p><code>./configure \
        --with-init-style=debian-systemd \
        --without-libevent \
        --without-tdb \
        --with-cracklib \
        --enable-krbV-uam \
        --with-pam-confdir=/etc/pam.d \
        --with-dbus-daemon=/usr/bin/dbus-daemon \
        --with-dbus-sysconf-dir=/etc/dbus-1/system.d \
        --with-tracker-pkgconfig-version=1.0
</code><img class="content_img" src="/image/3d/3d733c59dd42b9026d82e2b10d0d04e1.png" /><p>假设您没有看到任何错误消息，您可以进入下一阶段并运行：</p><p>做 / 使得 / 布置 / 制造</p><p>这需要一段时间。你不妨给自己煮一杯咖啡、一些烤饼和一顿三道菜的饭。覆盆子派在编译软件方面速度不快。</p><p>当一切都完成后，您终于可以安装Netatalk了：</p><p>SUDO进行安装</p><p>那不是很有趣吗？快速检查Netatalk是否实际正在运行：</p><p>Netatalk-V</p><p>您将看到有关Netatalk设置的大量信息。如果一切看起来都很好，我们来配置一下吧！</p><p>第四步：配置Netatalk</p><p>现在已经安装了Netatalk，您需要告诉它共享您的驱动器。首先，您需要重新编辑nsswitch.conf。</p><p>sudo Nano/etc/nsswitch.conf</p><p>在这里，您需要将mdns4和mdn添加到以“hosts：”开头的行，使其如下所示：</p><p>主机：文件mdns4_minimal[NotFound=return]DNS mdns4 mdns</p><p></p><p></p><img class="content_img" src="/image/7d/7d3fbb937281c6b6af52d061d4225742.png" /><p>这一调整意味着你的时光机驱动器将显示在Finder的侧边栏中，只要你将你的Raspberry Pi连接到网络上。</p><p>接下来，您需要重新编辑afpd.service：</p><p>sudo Nano/etc/avahi/services/afpd.service</p><p>复制此文本块并将其粘贴到该文件中：</p><code><?xml version="1.0" standalone='no'?><!--*-nxml-*-->
<!DOCTYPE service-group SYSTEM "avahi-service.dtd">
<service-group>
    <name replace-wildcards="yes">%h</name>
    <service>
        <type>_afpovertcp._tcp</type>
        <port>548</port>
    </service>
    <service>
        <type>_device-info._tcp</type>
        <port>0</port>
        <txt-record>model=TimeCapsule</txt-record>
    </service>
</service-group>
</code><p>其中，这些信息使你的树莓PI模仿了一个实际的苹果时间胶囊，并带有适当的图标。</p><p>最后，是将您的外部驱动器设置为网络共享的时候了。</p><p>sudo Nano/usr/local/etc/afp.conf</p><p>在本文件底部，请粘贴以下文本：</p><code>[Global]
  mimic model = TimeCapsule6,106

[Time Machine]
  path = /media/tm
  time machine = yes
</code><p>如果你愿意，你可以在第二个括号里加上一个不同于“时光机”的名字。这将更改您备份到的驱动器的名称，如Finder和Time Machine本身所示。</p><p>最后，继续启动网络服务。依次运行以下两个命令：</p><p>SUDO服务Avahi-后台进程启动。
SUDO服务Netatalk启动</p><p>您的驱动器现在已在网络上提供。要确保每次启动Raspberry PI时都会发生这种情况，请再次逐个输入以下命令：</p><p>sudo systemctl启用avahi-daemon。
SUDO系统ctl启用netatalk</p><p>我们现在真的很接近了！</p><p>第五步：连接到你的时光机</p><p>前往你的Mac上的Finder，你应该会在这里看到你的树莓PI。</p><img class="content_img" src="/image/d2/d291fa32a7a0cfea942561a02f6238c9.png" /><p>您实际上可以从这里连接，方法是单击“连接身份”并输入用于通过SSH连接的用户名和密码。</p><p>然而，根据我的经验，如果你通过硬盘的IP地址连接到硬盘，Time Machine的工作效果会更好，特别是如果你已经用路由器设置了静态IP地址(你可能应该这样做)。要连接，请打开Finder，然后按键盘上的Command+K。</p><img class="content_img" src="/image/f1/f15c25cbe5b3db492ebdd3e616dde639.png" /><p>一旦你挂载了硬盘，进入系统偏好设置&gt;时光机，然后选择该硬盘作为你的时光机备份。</p><img class="content_img" src="/image/66/66452ce993d7ab2b1f638d835dee40ef.png" /><p>初始备份将运行，之后每小时进行一次备份。您现在拥有了一个联网的时光机驱动器。好好享受吧！</p><div class="item_info"><span class="item_key"><a href="/tag/pi/">pi</a></span><span class="item_key"><a href="/tag/dev/">dev</a></span><span class="item_key"><a href="/tag/驱动器/">驱动器</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/10764.html">如何超频您的覆盆子PI(不会使您的保修无效)</a><li><a href="/story/8601.html">把树莓派变成月光下的蒸汽机</a><li><a href="/story/5854.html">如何(以及为什么)将.local域分配给您的树莓PI</a><li><a href="/story/5397.html">如何为远程外壳、桌面和文件传输配置Raspberry PI</a><li><a href="/story/5263.html">关于开始使用树莓派你需要知道的一切</a><li><a href="/story/5242.html">如何将MPEG-2和VC-1视频编解码器支持添加到Raspberry Pi</a><li><a href="/story/4722.html">来自Tips Box：Kindle as Raspberry Pi屏幕、iPod控制盒和轻松六度的凯文·培根(Kevin Bacon)</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>