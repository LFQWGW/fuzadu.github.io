<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>极客学校：编写您的第一个完整的PowerShell脚本</title><link rel="stylesheet" href="/css.css"><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?f75329719d379998b2421a4cc2396366";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>极客学校：编写您的第一个完整的PowerShell脚本</h2></div><div class="content"><img class="content_img" src="/image/20/207ea41ab315096bfcdb3ed62317373a.png" /><p>几周前，“极客”向您展示了如何使用命令提示符查找您的计算机上次启动的时间。在PowerShell极客学校的最后一次安装中，我们将编写一个可重用的PowerShell命令来做同样的事情。</p><p>请务必阅读本系列的前几篇文章：</p><p>
了解如何使用PowerShell自动化Windows。
学习在PowerShell中使用Cmdlet。
了解如何在PowerShell中使用对象。
在PowerShell中学习格式化、筛选和比较。
学习在PowerShell中使用远程处理。
使用PowerShell获取计算机信息。
在PowerShell中使用集合。
了解如何在PowerShell中使用作业。
了解如何扩展PowerShell。
学习PowerShell变量、输入和输出</p><p>写你的第一个剧本</p><p>我们需要做的第一件事是找到一种方法来访问我们正在寻找的信息。因为我们正在处理管理信息，所以我们可能需要了解一下如何使用WMI，它确实有一个名为Win32_OperatingSystem的类，它允许您查看有关操作系统的详细信息，包括它上次启动的时间。</p><img class="content_img" src="/image/ec/ec5c0d365654cdd7cda76647f714cb24.png" /><p>现在我们知道在哪里可以找到要查找的信息，打开ISE并键入以下内容。</p><p>注意：我必须将我的代码分成两行，这样所有代码都可以放入屏幕截图中，但是您可以在一行中随意键入。如果您确实选择将其拆分成两行，请确保竖线字符是第1行的最后一个字符。</p><img class="content_img" src="/image/d9/d92162c0e56a9bbe1c09ac88a61e07ca.png" /><p>现在单击绿色的“run script”按钮或按键盘上的F5键来测试代码。</p><img class="content_img" src="/image/5e/5e207b440945b80f097fa4789b02a73d.png" /><p>WMI时间可能有点神秘。我们的意思是，如果您查看LastBootUpTime属性，它显示为2013-03-19，时间为18：26：21，但是由于某种原因，WMI人员决定将所有这些内容连接到一个字符串中。幸运的是，我们不必担心手动解析字符串，因为有一种更简单的方法，尽管更高级。您需要将代码的Select-Object部分更改为如下所示：</p><p>我们在这里所做的是创建一个名为“Last Boted”的自定义属性，并指定它的值必须是对当前管道对象的LastBootUpTime属性调用ToDateTime静态方法的结果。您的代码现在应该如下所示。</p><img class="content_img" src="/image/e4/e468198f867a7e4fa056faf43257432a.png" /><p>现在运行代码将产生更具可读性的上次引导时间。</p><img class="content_img" src="/image/9d/9db663ba9e76c154e5b39462b9553b0a.png" /><p>既然我们对脚本的基本功能很满意，我们需要保存它。为简单起见，我们将其保存为以下内容：</p><img class="content_img" src="/image/98/9809a5683309871f33e0cced5e415039.png" /><p>现在切换到ISE的下半部分并运行以下命令：</p><img class="content_img" src="/image/4a/4a847e42355dca45600c970a3d0632c4.png" /><p>太棒了！我们的脚本工作正常，但是我们的脚本仍然有一个问题。我们硬编码了要获取上次启动时间的计算机的名称。我们应该提供一个参数，而不是对值进行硬编码，这样无论谁使用脚本，都可以选择在哪台计算机上运行脚本。为此，请转到脚本顶部并执行以下操作。</p><p>然后用$ComputerName变量替换硬编码的localhost值。您的脚本现在应该如下所示：</p><img class="content_img" src="/image/eb/eb9aebf275db6e8e4f8e2202a5274c0c.png" /><p>保存脚本，然后返回ISE的下半部分并查看脚本的帮助。</p><img class="content_img" src="/image/88/8884548466efb0021337a12afa3114fa.png" /><p>棒极了，现在我们可以使用新的ComputerName参数指定要获取上次引导时间的计算机的名称。不幸的是，仍然有一些事情是错误的。首先，ComputerName参数是可选的，其次，这是我见过的最难看的帮助，所以让我们快速解决这些问题。要使ComputerName参数成为强制参数，请将param块的内容更改为以下内容。</p><p>至于制作更好的帮助文件，最常用的方法是使用基于注释的帮助。这意味着我们只需在Out脚本的顶部添加一个超长的注释。</p><p>一旦所有这些都完成了，您最终应该会得到一个如下所示的脚本。</p><img class="content_img" src="/image/7e/7e5ab1cd4ec94cd8856b9c69aa42c60d.png" /><p>现在让我们去检查一下我们的新帮助文件。</p><img class="content_img" src="/image/22/2244b42ba6d3ea9d41a5088c9f6803d4.png" /><p>啊，看起来棒极了！现在我们的脚本已经完成，我们还有最后一件事要做：测试。为此，我将退出ISE并返回PowerShell控制台，以便我们可以确保没有异常。</p><img class="content_img" src="/image/bc/bc5d342eba0bdf096faf58ebd2f65b91.png" /><p>如果你从一个简单的眼线开始，然后像我们在本指南中所做的那样，在它的基础上不断发展，你很快就会掌握它的诀窍的。各位，这就是本期节目的全部内容，在下一期的“极客学校”中再见。</p><div class="item_info"><span class="item_key"><a href="/tag/使用/">使用</a></span><span class="item_key"><a href="/tag/powershell/">powershell</a></span><span class="item_key"><a href="/tag/脚本/">脚本</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14706.html">如何在Linux上使用uniq命令</a><li><a href="/story/14624.html">解释的Linux文件时间戳：atime、mtime和ctime</a><li><a href="/story/14585.html">如何在Microsoft Excel中兑换货币</a><li><a href="/story/14577.html">如何检查Linux上安装了哪个GPU</a><li><a href="/story/14572.html">如何使用Jouralctl读取Linux系统日志</a><li><a href="/story/14570.html">如何在Linux上使用grep命令</a><li><a href="/story/14555.html">2020年CES最佳：我们今年看到的所有最好的东西</a><li><a href="/story/14550.html">如何在Linux上使用Tail命令</a><li><a href="/story/14542.html">如何从MacOS Catalina向iPhone添加自定义铃声</a><li><a href="/story/14508.html">如何使用键盘快捷键简化流媒体Netflix</a><li><a href="/story/14507.html">如何在Linux上使用HISTORY命令</a><li><a href="/story/14499.html">如何在Linux上使用免费命令</a><li><a href="/story/14467.html">如何在Windows 10上切换到本地用户帐户</a><li><a href="/story/14466.html">如何在Linux上使用at和Batch来调度命令</a><li><a href="/story/14461.html">如何设置您的新Mac</a><li><a href="/story/14450.html">如何在Excel中将一长列变为多列</a><li><a href="/story/14438.html">如何在iPhone上创建和使用Memoji和Animoji</a><li><a href="/story/14434.html">Chrome 79的新特性，现已推出</a><li><a href="/story/14426.html">如何使用Google Sheets中的查询功能</a><li><a href="/story/14424.html">如何向Outlook会议请求添加默认签名</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>