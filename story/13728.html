<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>什么是反向SSH隧道？(以及如何使用它)</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>什么是反向SSH隧道？(以及如何使用它)</h2></div><div class="content"><p>需要通过SSH连接到无法访问的Linux计算机吗？让它呼叫您，然后深入搜索该连接以获得您自己的远程SSH会话。我们教你怎么做。</p><p>何时需要使用反向SSH隧道</p><p>有时，远程计算机可能很难访问。他们所在的站点可能有严格的防火墙规则，或者本地管理员可能设置了复杂的网络地址转换规则。如果您需要连接到这样一台计算机，您如何访问它？</p><p>让我们建立一些标签。您的计算机是本地计算机，因为它离您很近。您要连接的计算机是远程计算机，因为它与您位于不同的位置。</p><p>为了区分本文中使用的本地和远程计算机，远程计算机名为“Howtogeek”，运行的是Ubuntu Linux(带有紫色终端窗口)。本地计算机名为“Sulaco”，运行的是Manjaro Linux(带有黄色终端窗口)。</p><p>通常，您需要从本地计算机启动SSH连接并连接到远程计算机。在我们描述的网络场景中，这不是一个选项。具体的网络问题是什么并不重要-每当您无法通过SSH直接连接到远程计算机时，这一点都很有用。</p><p>但是，如果您一端的网络配置很简单，远程计算机就可以连接到您。然而，仅有这一点还不足以满足您的需要，因为它不能在远程计算机上为您提供有效的命令行会话。但这只是一个开始。您已经在两台计算机之间建立了连接。</p><p>答案在于反向SSH隧道。</p><p>什么是反向SSH隧道？</p><p>反向SSH隧道允许您使用已建立的连接来设置从本地计算机返回到远程计算机的新连接。</p><p>因为原始连接是从远程计算机到您的，所以使用它去往另一个方向就是在“反向”使用它。而且因为SSH是安全的，所以您可以将安全连接放在现有的安全连接中。这意味着您与远程计算机的连接在原始连接中充当专用隧道。</p><p>因此，我们得出了“反向SSH隧道”的名称。</p><p>它怎麽工作?</p><p>反向SSH隧道依赖远程计算机使用已建立的连接侦听来自本地计算机的新连接请求。</p><p>远程计算机侦听本地计算机上的网络端口。如果它检测到对该端口的SSH请求，它会将该连接请求中继回其自身，沿着已建立的连接向下转发。这将提供从本地计算机到远程计算机的新连接。</p><p>设置起来容易，描述起来难。</p><p>使用SSH反向隧道</p><p>您的Linux计算机上已经安装了SSH，但如果本地计算机以前从未接受过SSH连接，则可能需要启动SSH守护进程(SSHD)。</p><code>sudo systemctl start sshd</code><img class="content_img" src="/image/bd/bd46d66993d7065e75d0c59224f9f23b.png" /><p>要在您每次重新启动计算机时启动SSH守护程序，请使用以下命令：</p><code>sudo systemctl enable sshd</code><img class="content_img" src="/image/ca/ca45a77631fc24a67f1eac69be6ba04d.png" /><p>在远程计算机上，我们使用以下命令。</p><p>
-R(反向)选项告诉ssh必须在远程计算机上创建新的SSH会话。
“43022：LOCALHOST：22”告诉SSH，本地计算机上端口43022的连接请求应该转发到远程计算机上的端口22。之所以选择端口43022，是因为它被列为未分配。这不是一个特殊的号码。
dave@sulaco.local是远程计算机将在本地计算机上连接到的用户帐户。</p><code>ssh -R 43022:localhost:22 dave@sulaco.local</code><img class="content_img" src="/image/39/39865820859aafc069bce5904037b8c7.png" /><p>您可能会收到一条警告，提示您以前从未连接过本地计算机。或者，当连接详细信息添加到已识别的SSH主机列表中时，您可能会看到一条警告。您看到的内容(如果有的话)取决于是否已从远程计算机连接到本地计算机。</p><p>系统将提示您输入用于连接到本地计算机的帐户密码。</p><img class="content_img" src="/image/94/94f2b5ad46b9352f628db688083e85f3.png" /><p>请注意，连接完成后，命令提示符从dave@Howtogeek更改为dave@sulaco。</p><p>我们现在已从远程计算机连接到本地计算机。这意味着我们可以向它发出命令。让我们使用who命令查看本地计算机上的登录。</p><code>who</code><img class="content_img" src="/image/a3/a3f40533d6405c2f6c8752e01019938f.png" /><p>我们可以看到，拥有名为Dave的用户帐户的用户已经登录到本地计算机，并且远程计算机已经从IP地址192.168.4.25连接(使用相同的用户凭据)。</p><p>相关：如何在Linux中确定当前用户帐户</p><p>正在连接到远程计算机</p><p>因为来自远程计算机的连接成功，并且它正在侦听连接，所以我们可以尝试从本地计算机连接到远程计算机。</p><p>远程计算机正在侦听本地计算机上的端口43022。因此，有些与直觉相反的是，为了建立到远程计算机的连接，我们要求SSH在端口43022上连接本地计算机。该连接请求将被转发到远程计算机。</p><code>ssh localhost -p 43022</code><img class="content_img" src="/image/ae/ae2b5a40c65bf054423ed27a99c700b8.png" /><p>系统提示我们输入用户帐户密码，然后从本地计算机连接到远程计算机。我们的Manjaro电脑高兴地说，“欢迎使用Ubuntu 18.04.2 LTS”。</p><img class="content_img" src="/image/3d/3d0e988573ccba328b9b2c68e411575c.png" /><p>请注意，命令提示符已从dave@sulaco更改为dave@Howtogeek。我们已经实现了与难以访问的远程计算机建立SSH连接的目标。</p><p>将SSH与密钥一起使用</p><p>为了更方便地从远程计算机连接到本地计算机，我们可以设置SSH密钥。</p><p>在远程计算机上，键入以下命令：</p><code>ssh-keygen</code><img class="content_img" src="/image/30/30c451874ccfcfe929bf68f9470f584b.png" /><p>系统将提示您输入密码。您可以按Enter键忽略密码问题，但不建议这样做。这意味着远程计算机上的任何人都可以与您的本地计算机建立SSH连接，而无需询问密码。</p><p>由符号分隔的三四个单词将构成一个健壮的密码短语。</p><img class="content_img" src="/image/73/73eaf8a72ff34453e5f12254180ef59f.png" /><p>将生成您的SSH密钥。</p><p>我们需要将公钥传输到本地计算机。使用此命令：</p><code>ssh-copy-id dave@sulaco.local</code><img class="content_img" src="/image/93/934116eda100874274846c8ec3b4a8fd.png" /><p>系统将提示您输入要登录的用户帐户的密码，在本例中为dave@sulaco.local。</p><img class="content_img" src="/image/45/45487ce941c42aff30fa4c064de6bfcd.png" /><p>当您第一次请求从远程计算机连接到本地计算机时，您必须提供密码。在以后的连接请求中，只要终端窗口保持打开状态，您就不必再次输入密码。</p><img class="content_img" src="/image/01/0175761153cd0121f9db1a248eae042e.png" /><p>相关：如何从Linux Shell创建和安装SSH密钥</p><p>并不是所有的隧道都很可怕</p><p>有些隧道可能是黑暗和扭曲的，但是如果您能够保持头脑中远程计算机和本地计算机之间的关系，反向SSH隧道就不会太难导航。那就把它倒过来。</p><div class="item_info"><span class="item_key"><a href="/tag/连接/">连接</a></span><span class="item_key"><a href="/tag/ssh/">ssh</a></span><span class="item_key"><a href="/tag/计算机/">计算机</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14603.html">如何在Linux上使用netstat</a><li><a href="/story/14602.html">如何在Linux上使用netstat</a><li><a href="/story/14601.html">如何在Linux上使用netstat</a><li><a href="/story/14600.html">如何在Linux上使用netstat</a><li><a href="/story/14599.html">如何在Linux上使用netstat</a><li><a href="/story/14598.html">如何在Linux上使用netstat</a><li><a href="/story/14597.html">如何在Linux上使用netstat</a><li><a href="/story/14596.html">如何在Linux上使用netstat</a><li><a href="/story/14595.html">如何在Linux上使用netstat</a><li><a href="/story/13763.html">如何在Ubuntu上设置远程桌面</a><li><a href="/story/12722.html">如何在iPhone、iPad或Mac上使用即时热点</a><li><a href="/story/12378.html">如何在iPhone、iPad或Mac上使用即时热点</a><li><a href="/story/12060.html">你真的需要一个“游戏”路由器吗？</a><li><a href="/story/11207.html">如何让任何人将他们的手机连接到您的Google Home</a><li><a href="/story/11189.html">如何让您的流媒体视频不再缓冲太多</a><li><a href="/story/11128.html">如何将Android设备用作PC或Mac的第二个显示器</a><li><a href="/story/10742.html">如何在没有任何额外软件的情况下对朋友的Windows PC进行远程故障排除</a><li><a href="/story/8865.html">在Windows 10上将连接设置为计量的方式、时间和原因</a><li><a href="/story/8395.html">Wi-Fi与以太网：有线连接好多少？</a><li><a href="/story/8378.html">如何更改您的Mac首先连接到哪个Wi-Fi网络</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>