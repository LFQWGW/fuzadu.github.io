<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何从Bash脚本获取系统的地理位置</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何从Bash脚本获取系统的地理位置</h2></div><div class="content"><p>您可以使用开放式API和简单的bash脚本找到远程Linux系统的地理位置。对服务器进行地理定位可以帮助您在物理世界中跟踪它，确保服务器位于区域热点地区。</p><p>互联网上的每个服务器都有一个面向公众的IP地址。这可以直接分配给服务器，也可以分配给向该服务器发送流量的路由器。IP地址给我们提供了关于服务器在世界上的位置的线索。我们可以通过ipinfo.co和IP Vililante提供的两个开放API获取此地理位置数据，并使用它查看与服务器或其他远程系统相关联的城市、州和国家。这不会给您提供精确的GPS位置；它只会让您看到IP地址的大致区域。</p><p>连接到远程系统</p><p>您将在想要地理定位的Linux服务器或其他远程系统上运行以下命令，因此您必须首先连接到服务器并访问其上的shell。例如，您可以通过SSH连接。您可以在本地系统上运行命令来查找它的位置，但是您可能已经知道自己在哪里了！</p><p>安装cURL和jq</p><p>我们需要两个工具来访问geolocation API：cURL用于发出HTTP请求，而JQ用于处理我们返回的JSON数据。打开终端，使用apt-get在基于Ubuntu或Debian的系统上安装这些工具。在其他Linux发行版上，请改用您的Linux发行版的软件包安装工具。</p><code>sudo apt-get install curl jq</code><p>查找服务器的公用IP地址</p><p>在获得地理位置数据之前，我们还需要服务器的公共IP地址。使用cURL在您的终端窗口中对ipinfo.io进行API调用。</p><code>curl https://ipinfo.io/ip</code><p>从API获取位置数据</p><p>现在我们有了服务器的公网IP，我们可以调用ipiligilante.com的API来获取地理位置数据。将&lt;your IP address&gt;替换为上一个命令中返回的地址。</p><code>curl https://ipvigilante.com/<your ip address></code><img class="content_img" src="/image/c2/c25312f032b049b09c986d4471ba72ce.png" /><p>让我们仔细看看我们从这次呼叫中得到了哪些数据：</p><img class="content_img" src="/image/30/3060f6521bc0d33b9b793c11ee2c9ea6.png" /><p>API返回我们的服务器所在的城市、国家和大陆。它还返回大致的纬度和经度坐标，以防我们想要在交互式地图上绘制此服务器。我们将在脚本中使用“纬度”、“经度”、“城市名称”和“国家名称”。*jq命令了解如何处理API数据并提取出这四个字段。</p><p>创建脚本以自动执行API调用</p><p>我们可以创建一个脚本来获取地理位置数据，并将其写入CSV格式的文件。数据将写入/tmp/目录中名为server_location.txt的文件。打开您最喜欢的编辑器并创建名为geolocate.sh的脚本。插入如下所示的脚本内容，并确保将IP地址替换为您自己的IP地址：</p><code>#!/bin/sh

OUTPUT_FILE=/tmp/server_location.txt

# Grab this server's public IP address
PUBLIC_IP=`curl -s https://ipinfo.io/ip`

# Call the geolocation API and capture the output
curl -s https://ipvigilante.com/${PUBLIC_IP} | \
        jq '.data.latitude, .data.longitude, .data.city_name, .data.country_name' | \
        while read -r LATITUDE; do
                read -r LONGITUDE
                read -r CITY
                read -r COUNTRY
                echo "${LATITUDE},${LONGITUDE},${CITY},${COUNTRY}" | \
                        tr --delete \" > \
                        ${OUTPUT_FILE}
        done
</code><p>保存脚本并返回终端。通过授予对此文件的EXECUTE权限，使脚本可从终端执行。</p><code>chmod u+x geolocate.sh</code><p>现在您已经准备好测试它了。运行geolocate.sh脚本并检查输出文件的内容：</p><code>./geolocate.sh
cat /tmp/server_location.txt
</code><img class="content_img" src="/image/25/2561433d7227ae58117adfff04423060.png" /><p>使用Cron作业每天更新一次地理位置数据</p><p>让我们创建一个cron作业，使我们的服务器每天更新其地理位置并将其保存到文件中。每天的cron作业更新服务器的/tmp/文件夹中名为server_location.txt的文件。创建24小时cron作业非常简单，只需将我们的脚本放到/etc/cron.Daily目录中即可。我们必须使用sudo命令以root用户身份复制文件，以避免权限问题。运行以下命令将geolocate.sh复制到/etc/cron.Daily目录。</p><code>sudo cp geolocate.sh /etc/cron.daily</code><p>这些更改是即时的，我们的脚本将每24小时运行一次，以更新/tmp/server_location.txt文件的内容。我们可以使用这些数据来做一些有趣的事情，比如在地图上绘制我们的服务器，以及将地理位置与交通日志结合起来，以查看我们的服务器热点在世界的什么地方。</p><div class="item_info"><span class="item_key"><a href="/tag/服务器/">服务器</a></span><span class="item_key"><a href="/tag/脚本/">脚本</a></span><span class="item_key"><a href="/tag/api/">api</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14089.html">使用AWS保护您的家庭MIWARTH服务器免受DDOS攻击</a><li><a href="/story/12980.html">如何启动自己的游戏服务器</a><li><a href="/story/12871.html">Windows和Windows Server之间有什么不同？</a><li><a href="/story/12181.html">为什么你可能不应该在家里运营你的商业网站</a><li><a href="/story/11995.html">最常见的在线错误(以及如何修复它们)</a><li><a href="/story/11707.html">如何设置“我的世界”让你的孩子可以和朋友在线玩</a><li><a href="/story/9360.html">如何在Apple TV上播放计算机中的视频文件</a><li><a href="/story/9018.html">适用于任何Bukkit服务器的8个基本插件</a><li><a href="/story/8703.html">如何为定制多人游戏运行SPIGOT MIWARTH服务器</a><li><a href="/story/8606.html">如何更新您的Windows服务器密码套件以提高安全性</a><li><a href="/story/8039.html">如何从地球上的任何地方访问受区域限制的网站</a><li><a href="/story/7655.html">如何选择远程“我的世界”主机</a><li><a href="/story/7654.html">如何运行本地MIWART PE服务器，构建有趣而持久的世界</a><li><a href="/story/7653.html">如何运行简单的本地MIWARTH服务器(带模式和不带模式)</a><li><a href="/story/7558.html">如何将Gmail添加到Mac OS X的新Outlook(Office 365)</a><li><a href="/story/7242.html">如何连接到本地面向Internet的服务器，而不将流量发送到Internet并返回？</a><li><a href="/story/7014.html">探索“我的世界”多人服务器</a><li><a href="/story/6138.html">如何在覆盆子PI上廉价地运行低成本的MIWART积木</a><li><a href="/story/5856.html">使用第三方DNS服务的7个原因</a><li><a href="/story/5804.html">如何在不将文件存储在云中的情况下在计算机之间同步文件</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>