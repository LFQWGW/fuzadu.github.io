<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何在DD-WRT路由器上安装和配置OpenVPN</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何在DD-WRT路由器上安装和配置OpenVPN</h2></div><div class="content"><img class="content_img" src="/image/c4/c4d70d3a0f03bcbf3752893e162a2d4d.png" /><p>我们已经介绍了在您的路由器上安装Tomato，以及如何使用OpenVPN和Tomato连接到您的家庭网络。现在，我们将介绍如何在启用DD-WRT的路由器上安装OpenVPN，以便从世界任何地方轻松访问您的家庭网络！</p><p>什么是OpenVPN？</p><img class="content_img" src="/image/ca/ca8660ddc7c1007c77851fffeef13eee.png" /><p>虚拟专用网(VPN)是一个局域网(LAN)与另一个局域网(LAN)之间的可信、安全连接。将您的路由器视为连接到的网络之间的中间人。您的计算机和OpenVPN服务器(在本例中是您的路由器)都使用相互验证的证书“握手”。在验证之后，客户端和服务器都同意彼此信任，然后允许客户端访问服务器的网络。</p><p>通常，实施VPN软件和硬件需要花费大量资金。如果您还没有猜到，OpenVPN是一个免费(滚滚)的开源VPN解决方案。DD-WRT与OpenVPN一起，对于那些希望在两个网络之间实现安全连接而无需打开钱包的人来说，是一个完美的解决方案。当然，OpenVPN不会开箱即用。需要进行一些调整和配置才能使其恰到好处。不过不用担心，我们来这里是为了让你的过程更容易，所以给自己拿杯热咖啡，我们开始吧。</p><p>有关OpenVPN的更多信息，请访问官方的什么是OpenVPN？传呼。</p><p>先决条件</p><p>本指南假定您当前在PC上运行Windows 7，并且您使用的是管理帐户。如果你是Mac或Linux用户，这本指南会让你了解事情是如何运作的，然而，你可能需要自己多做一点研究才能让事情变得完美。</p><p>本指南还假设您拥有Linksys WRT54GL，并对VPN技术有大致了解。它应该作为DD-WRT安装的基础，但请务必查看我们的官方DD-WRT安装指南以获得额外的补充。</p><p>安装DD-WRT</p><p>负责DD-WRT的团队做了大量工作，使最终用户能够轻松发现路由器与其路由器数据库页面的兼容性。首先在文本字段中键入您的路由器型号(在本例中为WRT54GL)，然后立即显示搜索结果。找到您的路由器后，请单击它。</p><p>您将进入一个新页面，其中列出了有关您的型号的信息-包括硬件规格和不同版本的DD-WRT。下载DD-WRT的Mini-Generic Build和VPN Generic Build(dd-wrt.v24_mini_Generic.bin和dd-wrt.v24_vpn_Generic.bin)。将这些文件保存到您的计算机。</p><img class="content_img" src="/image/35/35c0fc7ffa6a07ef91adb079fb7c14d6.png" /><p>最好访问DD-WRT硬件特定信息页面，查找有关您的路由器和DD-WRT的详细信息。本页将准确解释您在安装DD-WRT之前和之后需要执行的操作。例如，从WRT54GL上的现有Linksys固件升级时，必须先安装DD-WRT迷你版，然后再安装DD-WRT VPN。</p><p>此外，在安装DD-WRT之前，请确保进行硬重置(也称为30/30/30)。按住路由器背面的重置按钮30秒。然后，在按住重置按钮的同时，拔下电源线并将其拔下30秒。最后，重新插入电源线，同时仍然按住重置按钮30秒。您应该连续按住电源按钮90秒。</p><img class="content_img" src="/image/d6/d66ebbc1fa55d5dc30e9c93fb6f6a06c.png" /><p>现在打开浏览器，输入路由器的IP地址(默认为192.168.1.1)。系统将提示您输入用户名和密码。Linksys WRT54GL的默认值为“admin”和“admin”。</p><img class="content_img" src="/image/bc/bcf6fcab277b08d5fa6a65d95353054c.png" /><p>单击顶部的管理选项卡。接下来，单击Firmware Upgrade(固件升级)，如下所示。</p><img class="content_img" src="/image/6b/6b6bba453747f33d64fad9f0fb6ca94b.png" /><p>单击Browse按钮并导航到我们之前下载的DD-WRT Mini Generic.bin文件。请勿上载DD-WRT VPN.bin文件。单击Web界面中的升级按钮。您的路由器将开始安装DD-WRT Mini Generic，应该不会超过一分钟即可完成。</p><img class="content_img" src="/image/90/9028676b221c0472e337f49797cbe7e3.png" /><p>唉！你第一次见到DD-WRT。再次按照我们上面的操作进行30/30/30重置。然后单击顶部的管理选项卡。系统将提示您输入用户名和密码。默认用户名和密码分别为“root”和“admin”。登录后，单击Firmware Upgrade(固件升级)子选项卡，然后单击Choose File(选择文件)。浏览我们之前下载的DD-WRT VPN文件，然后单击打开。DD-WRT的VPN版本现在将开始上传；请耐心等待，因为这可能需要2-3分钟。</p><img class="content_img" src="/image/75/75028cb13066f8c6773ac28517587038.png" /><p>安装OpenVPN</p><p>现在，让我们转到OpenVPN的下载页面并下载OpenVPN Windows安装程序。在本指南中，我们将使用名为2.1.4的OpenVPN的第二个最新版本。最新版本(2.2.0)中有一个错误，会使这个过程变得更加复杂。我们正在下载的文件将安装OpenVPN程序，该程序允许您连接到您的VPN网络，因此请确保将此程序安装在您要用作客户端的任何其他计算机上(因为我们将在稍后了解如何执行此操作)。将openvpn-2.1.4-install.exe文件保存到您的计算机。</p><img class="content_img" src="/image/2a/2a6cf31b643522f188a435207c8075c5.png" /><p>导航到我们刚刚下载的OpenVPN文件并双击它。这将开始在您的计算机上安装OpenVPN。在选中所有默认值的情况下运行安装程序。在安装过程中，将弹出一个对话框，要求安装名为TAP-Win32的新虚拟网络适配器。单击Install(安装)按钮。</p><img class="content_img" src="/image/07/073ed5ae4eacbdebd98468bb4b445320.png" /><p>创建证书和密钥</p><p>现在您已经在计算机上安装了OpenVPN，我们必须开始创建证书和密钥来验证设备。单击Windows开始按钮，然后在附件下导航。您将看到命令提示符程序。右键单击它，然后单击以管理员身份运行。</p><img class="content_img" src="/image/34/34509f8b3479d9e06ff47ccb6bd2d33e.png" /><img class="content_img" src="/image/01/010d7e96735ccc7d9331f32b2fbf0e92.png" /><p>现在键入init-config并按Enter键，将名为vars.bat和openssl.cnf的两个文件复制到Easy-rsa文件夹。请打开您的命令提示符，因为我们很快就会回来讨论它。</p><img class="content_img" src="/image/df/dfa2ee6932aef26bfb8696385d95ee5c.png" /><p>导航到C：\Program Files(X86)\OpenVPN\Easy-rsa(在32位Windows 7上为C：\Program Files\OpenVPN\Easy-rsa)，然后右键单击名为vars.bat的文件。单击编辑在记事本中将其打开。或者，我们建议使用Notepad++打开此文件，因为它可以更好地格式化文件中的文本。您可以从他们的主页下载Notepad++。</p><img class="content_img" src="/image/d3/d3f8fc475349d559b80c2afd6bfe74ed.png" /><p>文件的底部是我们所关心的。从第31行开始，将KEY_COUNTRY值、KEY_EXPERATION值等更改为您所在的国家、省份等。例如，我们将我省更改为“IL”，将城市更改为“Chicago”，将org更改为“Howtogek”，并将电子邮件更改为我们自己的电子邮件地址。此外，如果您运行的是64位Windows7，请将第6行中的HOME值更改为%ProgramFiles(X86)%\openvpn\Easy-rsa。如果您运行的是32位Windows7，请不要更改此值。您的文件应该与下面的文件类似(当然，使用您各自的值)。编辑完成后，通过覆盖文件来保存该文件。</p><img class="content_img" src="/image/df/df56298d723f6fa9ad70444acd00fba7.png" /><p>返回到命令提示符，键入vars并按Enter键。然后键入CLEAN-ALL并按Enter键。最后，键入build-ca并按Enter键。</p><img class="content_img" src="/image/c4/c477c02dc5a4740903f95d2f7c3fed88.png" /><p>执行build-ca命令后，系统将提示您输入国家名称、州、地区等。由于我们已经在vars.bat文件中设置了这些参数，因此可以通过按Enter键跳过这些选项，但是！在开始猛击Enter键之前，请注意Common Name参数。您可以在此参数中输入任何内容(即您的姓名)。只要确保你输入了一些东西就行了。此命令将输出Easy-rsa/Key文件夹中的两个文件(一个根CA证书和一个根CA密钥)。</p><img class="content_img" src="/image/eb/ebb0f89b40115ff7286df4172086038f.png" /><p>现在，我们将为客户端构建密钥。在同一命令提示符中，键入build-key client1。您可以将“client1”更改为您想要的任何内容(例如，宏碁笔记本电脑)。只要在系统提示时确保输入与通用名称相同的名称即可。像我们上一步一样运行所有默认设置(当然，除了Common name之外)。但是，最后将要求您签署证书并提交。为两者键入“y”，然后按Enter键。</p><p>此外，如果收到“无法写入‘随机状态’”错误，也不用担心。我们注意到您的证书仍然可以顺利制作。此命令将输出Easy-rsa/Key文件夹中的两个文件(Client1密钥和Client1证书)。如果要为另一个客户端创建另一个密钥，请重复上一步，但一定要更改公用名。</p><img class="content_img" src="/image/dd/dd2dbb0cc4e6e6ec8760fcdb2997f238.png" /><p>我们将生成的最后一个证书是服务器密钥。在同一命令提示符下，键入build-key-server server。您可以将命令末尾的“server”替换为您想要的任何内容(即Howtogeek-Server)。与往常一样，请确保在出现提示时输入与通用名称相同的名称。按Enter键并运行除通用名称之外的所有默认值。在末尾，键入“y”以签署证书并提交。此命令将输出Easy-rsa/KEYS文件夹中的两个文件(一个服务器密钥和一个服务器证书)。</p><img class="content_img" src="/image/a0/a02dda3ae19ca2b1811a8f745fe04728.png" /><p>现在我们必须生成Diffie Hellman参数。Diffie Hellman协议“允许两个用户在没有任何事先秘密的情况下通过不安全的介质交换秘密密钥”。你可以在RSA的网站上了解更多关于Diffie Hellman的信息。</p><p>在同一命令提示符中，键入build-dh。此命令将输出Easy-rsa/key文件夹中的一个文件(dh1024.pem)。</p><img class="content_img" src="/image/26/26272199d5ff1e3933ef7113b7551e50.png" /><p>为客户端创建配置文件</p><p>在编辑任何配置文件之前，我们应该设置动态DNS服务。如果您的ISP经常向您发出动态外部IP地址，请使用此服务。如果您有静态外部IP地址，请跳到下一步。</p><p>我们建议使用DynDNS.com，这是一项允许您将主机名(即howtoggek.dyndns.org)指向动态IP地址的服务。对于OpenVPN来说，始终知道您网络的公共IP地址是很重要的，通过使用DynDNS，OpenVPN将始终知道如何定位您的网络，无论您的公共IP地址是什么。注册一个免费的主机名，并将其指向您的公共IP地址。</p><p>现在回到配置OpenVPN。在Windows资源管理器中，如果您运行的是64位Windows 7，请导航到C：\Program Files(X86)\OpenVPN\Sample-config；如果您运行的是32位Windows 7，请导航到C：\Program Files\OpenVPN\Sample-config。在此文件夹中，您将找到三个示例配置文件；我们只关注client.ovpn文件。</p><img class="content_img" src="/image/c6/c6641c2689d317ddc4c20eaf506238da.png" /><p>右键单击client.ovpn并使用记事本或记事本++打开它。您会注意到您的文件如下图所示：</p><img class="content_img" src="/image/87/8710f5d36562db37f99a91c2778f0d8d.png" /><p>但是，我们希望client.ovpn文件看起来类似于下图。确保在第4行中将DynDNS主机名更改为您的主机名(如果您有静态IP地址，则将其更改为您的公共IP地址)。将端口号保留为1194，因为它是标准OpenVPN端口。此外，请确保更改第11行和第12行，以反映您的客户端的证书文件和密钥文件的名称。将其另存为OpenVPN/config文件夹中的新文件.ovpn文件。</p><img class="content_img" src="/image/86/8678de5ac77cf8bb99ae2fe5d9d18311.png" /><p>配置DD-WRT的OpenVPN守护进程</p><p>现在的基本思路是复制我们之前创建的服务器证书和密钥，并将它们粘贴到DD-WRT OpenVPN守护进程菜单中。再次打开您的浏览器并导航到您的路由器。现在，您的路由器上应该安装了DD-WRT VPN版本。您会注意到在Services选项卡下有一个名为VPN的新子选项卡。单击OpenVPN守护程序下的启用单选按钮。</p><img class="content_img" src="/image/7b/7b14b84b258a8f17eb8361b2bee756f3.png" /><p>首先，确保将启动类型更改为“wan up”，而不是默认的“system”。现在，我们需要前面创建的服务器密钥和证书。在Windows资源管理器中，导航到C：\Program Files(X86)\OpenVPN\Easy-rsa\Key(在64位Windows 7上)(或C：\Program Files\OpenVPN\Easy-rsa\Key(在32位Windows 7上))。使用记事本或记事本++打开下面每个相应的文件(ca.crt、Server.crt、Server.key和dh1024.pem)并复制内容。将内容粘贴到相应的框中，如下所示。</p><img class="content_img" src="/image/6f/6fd61f7823c7e668da8477b8d99e8523.png" /><p>对于OpenVPN Config字段，我们需要创建自定义文件。根据局域网的设置方式，这些设置会有所不同。打开单独的浏览器窗口并键入路由器的IP地址。单击Setup(设置)选项卡，记下您在Router IP&gt;Local IP Address(路由器IP&gt;本地IP地址)下配置的IP地址。默认值是192.168.1.1，这也是我们在本例中使用的。将此子网粘贴在第一行的“route”之后，以反映您的LAN设置。将其复制到OpenVPN Config(OpenVPN配置)框中，然后单击Save(保存)。</p><p>现在，我们必须配置防火墙以允许客户端通过1194端口连接到我们的OpenVPN服务器。转到“管理”选项卡，然后单击“命令”子选项卡。在“命令”文本框中粘贴以下内容：</p><p>如果第二行与默认值不同，请务必更改第二行中的LAN IP。然后单击下面的保存防火墙按钮。</p><p>最后，一定要检查Setup选项卡下的Time Settings，否则OpenVPN守护程序将拒绝所有客户端。我们建议您访问timeanddate.com，在当前时间搜索您所在的城市。本网站将提供您需要在时间设置项下填写的所有信息，就像我们下面所做的那样。此外，请查看NTP池项目的网站，以供公共NTP服务器使用。</p><img class="content_img" src="/image/5f/5f25ac82b73f16f8c32d74d7c64fb32c.png" /><p>设置OpenVPN客户端</p><p>在此示例中，我们将使用Windows 7笔记本电脑作为单独网络上的客户端。您要做的第一件事是在客户端上安装OpenVPN，就像我们在上面配置OpenVPN的第一步中所做的那样。然后导航到C：\Program Files\OpenVPN\config，这是我们将要粘贴文件的位置。</p><p>现在，我们必须回到原来的计算机上，收集总共四个文件以复制到我们的客户笔记本电脑上。再次导航到C：\Program Files(X86)\OpenVPN\Easy-rsa\key并复制ca.crt、client1.crt和client1.key。将这些文件粘贴到客户端的config文件夹中。</p><img class="content_img" src="/image/78/7804dac4641a6b5dc27374d7a3e35eed.png" /><p>最后，我们需要再复制一个文件。导航到C：\Program Files(X86)\OpenVPN\config并复制我们之前创建的新client.ovpn文件。也将此文件粘贴到客户端的config文件夹中。</p><p>测试OpenVPN客户端</p><p>在客户端笔记本电脑上，单击Windows开始按钮，然后导航到所有程序&gt;OpenVPN。右键单击OpenVPN GUI文件，然后单击以管理员身份运行。请注意，您必须始终以管理员身份运行OpenVPN，才能使其正常工作。若要将文件永久设置为始终以管理员身份运行，请右键单击该文件，然后单击“属性”。在兼容性选项卡下，选中以管理员身份运行此程序。</p><img class="content_img" src="/image/b2/b250dbbb7f8c66ae605c4e370c5a4540.png" /><p>任务栏中时钟旁边将显示OpenVPN GUI图标。右键单击图标，然后单击连接。因为我们的config文件夹中只有一个.ovpn文件，所以OpenVPN将默认连接到该网络。</p><img class="content_img" src="/image/b2/b2999d26e9b49eac64ca66663b393eb5.png" /><p>将弹出一个对话框，显示连接日志。</p><img class="content_img" src="/image/25/259adc51bf2053aa1ef5e15ff68effe3.png" /><p>连接到VPN后，任务栏中的OpenVPN图标将变为绿色，并显示您的虚拟IP地址。</p><img class="content_img" src="/image/4c/4c968bbe8517d8cccedb3fe4dc6bdea3.png" /><p>就这样！现在，您已经使用OpenVPN和DD-WRT在服务器和客户端网络之间建立了安全连接。要进一步测试连接，请尝试打开客户端笔记本电脑上的浏览器并导航到服务器网络上的DD-WRT路由器。</p><div class="item_info"><span class="item_key"><a href="/tag/openvpn/">openvpn</a></span><span class="item_key"><a href="/tag/文件/">文件</a></span><span class="item_key"><a href="/tag/路由器/">路由器</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/8073.html">哪种VPN协议是最好的？PPTP与OpenVPN对比L2TP/IPsec对比SSTP</a><li><a href="/story/3009.html">使用OpenVPN和番茄，随时随地连接到您的家庭网络</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>