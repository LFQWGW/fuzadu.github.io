<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何监控Linux命令的进度(使用pv和Progress)</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何监控Linux命令的进度(使用pv和Progress)</h2></div><div class="content"><p>不是盲目操作，而是使用Linux pv和Progress命令来跟踪命令的进度。对于通常没有进度条的命令，这些实用程序将为您提供进度条。您还将看到完成之前的估计时间。</p><p>如果你乘坐的是一架座椅上没有视频屏幕的长途飞机，要知道你的旅程有多远并不容易。你知道你什么时候起飞的。你知道飞行预计需要多长时间。但是你怎么知道你是在正轨上、准时还是远远落后于计划呢？如果你不想看飞行中的电影，你通常可以切换你的视频屏幕，以显示一张地图，上面有你的飞机的位置。您还可以获得一些统计数据，例如预期到达时间(ETA)，这很棒。</p><p>从终端窗口启动命令有时感觉就像没有视频屏幕的长途飞行。如果一切正常，或者流程是否已挂起，或者流程接近完成的程度，您都无法给出任何指示。闪烁的光标提供的信息不是很多。</p><p>pv和Progress命令为您提供一些统计数据和一些可视反馈。您可以看到这个过程离完成有多近了。这意味着您将获得正在运行的进程的ETA。与盯着光标相比，这轻而易举地赢得了胜利。</p><p>安装PV</p><p>您必须安装PV。</p><p>要在Ubuntu上安装PV，请使用以下命令：</p><code>sudo apt-get install pv</code><img class="content_img" src="/image/a4/a4ce9c4cbbdbc59ac525795c5b54affd.png" /><p>要在Fedora上安装PV，请使用以下命令：</p><code>sudo dnf install pv</code><img class="content_img" src="/image/6d/6d77384204d2a82792d21a1c26f87fca.png" /><p>要在Manjaro上安装PV，请使用以下命令：</p><code>sudo pacman -Syu pv</code><img class="content_img" src="/image/7f/7fc826bdbc6f07782a8eef16959b10a9.png" /><p>使用PV</p><p>PV代表管道查看器。管道必须在某个地方参与指挥。下面是一个示例，其中我们通过zip管道传输ISO图像，以生成ISO的压缩zip文件。</p><p>为了将命令减慢到可以截取屏幕截图的程度，本文使用的示例中的一些文件存储在名为SILVERXHD的旧的、速度较慢的外部USB上。</p><code>pv /media/dave/SILVERXHD/gparted-live-1.0.0-1-amd64.iso | zip > gparted.zip</code><img class="content_img" src="/image/9c/9cd24d168fcbf2265169add5aec6c246.png" /><p>我们可以在显示屏的底线看到PV给我们的信息。</p><img class="content_img" src="/image/d5/d55be2336bc0d18cf4aee601af637dda.png" /><p>从左到右，显示的信息为：</p><p>
到目前为止传输的数据。
时间已经过去很久了。
数据传输速率(吞吐量)。
进度条和完成百分比数字。
完成前的估计剩余时间(ETA)。</p><p>使用PV复制文件</p><p>要使用PV的输出复制文件，请使用以下命令：</p><code>pv /media/dave/SILVERXHD/gparted-live-1.0.0-1-amd64.iso > gparted.iso</code><img class="content_img" src="/image/b9/b999567c9405f4b9b07a0aad941b40e6.png" /><p>复制文件时，我们会收到进度报告。</p><img class="content_img" src="/image/ca/ca4fe40dcca0680e0675f831a1067a75.png" /><p>使用PV复制多个文件</p><p>要使用PV复制多个文件和文件夹，我们需要使用一个小技巧。我们使用焦油来为我们移动文件。</p><code>tar -c help-files/ | pv | tar -x -C Documents/</code><img class="content_img" src="/image/c9/c9d1013c82560a8a5073a6bf61acb374.png" /><p>命令的tar-c help-files/部分指示tar在help-files文件夹中创建(-c)文件的存档。然后，它被输送回tar文件，用于命令的最后一部分。在提取之前，存档被解压(-x)，目录被更改为Documents(-C)。</p><p>因此，帮助文件中的文件和文件夹被复制到Documents文件夹，并显示进度。</p><img class="content_img" src="/image/51/51d6bba50a582189685d544d55bf302c.png" /><p>这次的输出略有不同。</p><p>我们没有收到预计到达时间。进度条现在显示一个移动指示器。它显示进程处于活动状态，但不会像传统进度条那样从左向右增长。PV仅限于显示它可以从管道传输的进程中提取的信息。</p><p>使用PV和TAR创建归档文件</p><p>使用pv和tar复制文件不会给我们留下存档文件。TAR创建了一种“虚拟”存档，该存档直接反馈到TAR中以解压缩文件。如果我们的目标是复制文件，那就实现了。但是，如果我们想要创建存档文件，该怎么办呢？</p><p>我们仍然可以使用tar创建归档文件，并从PV获得进度报告。与tar一起使用的选项是-c(创建存档)、-z(使用gzip压缩)和-f(存档的文件名)。</p><p>注意，我们使用-作为文件名，这会导致tar使用标准输出，并将其输出写入终端窗口。我们看不到那个输出，因为它是通过光伏输送的。</p><p>存档的实际名称将是我们通过管道从pv输出到的文件名。在本例中，它是“help-files.tgz”。</p><code>tar -czf - ./help-files/ | pv > help-files.tgz</code><img class="content_img" src="/image/3e/3eac0567afcda685c6ee02826cbaf453.png" /><p>我们会得到与以前相同的进度指示器，并且会为我们创建存档文件。</p><img class="content_img" src="/image/ee/ee19a7137bbd7ce034f53043c56edb94.png" /><p>相关：如何在Linux上使用tar命令压缩和解压缩文件</p><p>PV显示选项</p><p>有许多选项可以与pv一起使用来更改其报告的详细信息。</p><p>如果使用这些选项中的任何一个，则所有其他选项都将关闭。因此，如果希望使用其中三个显示选项，则需要指定这三个选项。</p><p>使用不带任何选项的pv与使用-pterb选项相同。</p><p>
-p：显示完成百分比。这是进度条和完成百分比数字。
-t：显示运行时间。
-e：显示预计到达时间。
-r：显示数据传输速率。
-b：显示字节计数(到目前为止传输的数据)。
-n：将百分比显示为整数。这会将完成百分比打印为整数，并且每次新更新都会显示在新的一行上。</p><p>让我们重复最后一个命令，并将-p(完成百分比)选项传递给pv。</p><code>tar -czf - ./help-files/ | pv - p > help-files.tgz</code><img class="content_img" src="/image/d1/d11559106a74549e2250f682aaa29cfb.png" /><p>这将关闭所有其他显示选项。PV仅提供完成百分比元素。</p><p>因为pv不能从tar获得完成百分比，所以进度条被替换为移动指示器。没有百分比数字。</p><img class="content_img" src="/image/e4/e48f5cdf0e587801e891c8df9d0a305a.png" /><p>将PV与WC配合使用</p><p>我们可以使用pv将一个(或多个)文本文件通过管道传输到wc。然后，WC将计算回车符、字符和单词，并且PV将给我们一个进度报告。</p><p>在这里，我们通过管道将Help-files目录中的所有“.page”文件传输到wc。</p><p>当WC完成时，我们可以从Help-files文件夹中的所有“.page”文件中看到回车(行)、字符和单词的计数。</p><img class="content_img" src="/image/93/93da21b0c14a6923b6ae9cf7951d0a8e.png" /><p>安装进度命令</p><p>Progress命令提供与pv相同类型的有用信息，但它使用一组特定的Linux命令。</p><p>要在Ubuntu中安装进度，请使用以下命令：</p><code>sudo apt-get install progress</code><img class="content_img" src="/image/bb/bb4e90b80f8cbdef53efb2abe2c706e7.png" /><p>要在Fedora中安装进度，请使用以下命令：</p><code>sudo dnf install progress</code><img class="content_img" src="/image/e2/e219c2b437435417af94dd54d44930fa.png" /><p>要在Manjaro中安装进度，请使用以下命令：</p><code>sudo pacman -Syu progress</code><img class="content_img" src="/image/3f/3fb0016ad0f10fe810d98411a2c029f0.png" /><p>命令进度使用</p><p>在终端窗口中键入Progress并按Enter键将给您显示Progress使用的命令列表。</p><code>progress</code><img class="content_img" src="/image/53/53a6f4614929fb9b85b4ab8d44b74e48.png" /><p>对管道使用进度</p><p>我们可以使用两种技术来监视命令的进度。第一个是使用管道。</p><p>tar命令在Progress可以监视的受支持命令列表中，所以让我们使用tar。</p><p>我们将使用的选项是标准的-c(创建存档)、-z(使用gzip压缩)和-f(文件名)选项。我们将创建Help-files文件夹中所有内容的压缩存档，并将该存档命名为“help.tgz”。</p><p>我们通过管道将其传输到Progress中，并使用-m(Monitor)选项，因此Progress会一直报告该进程，直到它完成为止。</p><code>tar -czf help.tgz ./help-files/ | progress -m</code><img class="content_img" src="/image/95/9524c81cbee1737a423012f522167cf4.png" /><p>终端窗口将在tar命令创建存档时显示该命令的进度。</p><img class="content_img" src="/image/b2/b2fb34af642a478289160125925144f9.png" /><p>在处理每个文件时，会列出该文件，其中包含以下信息：</p><p>
进程ID。
进程名称。
已完成百分比。
处理的数据和文件的总大小。
数据速率(吞吐量)。
估计剩余时间(ETA)。</p><p>您可能会惊讶地看到出现第二个数据集。第一个数据集是针对TAR的。第二个是gzip。tar调用gzip来执行压缩。因为gzip在支持的命令列表中，所以会报告它的进度。</p><p>在连续监控模式下使用进度</p><p>您可以通过使用-M(监视器)选项在实时连续监视模式下使用进度。</p><p>在终端窗口中键入以下命令：</p><code>progress -M</code><img class="content_img" src="/image/28/28436634d3f1fcb2c519e092673f72d5.png" /><p>Progress将报告没有命令正在运行以供其监视。但是您不会返回到命令行。Progress会等待，直到它可以监视的命令启动。然后，它将自动开始对其进行报告。</p><img class="content_img" src="/image/67/6723ce1871846ebffaa154b12a0ce7ed.png" /><p>在另一个终端窗口中，键入进度可以监视的命令列表中的命令。</p><p>我们将使用CAT。过快结束的命令不会在进度中注册，因此我们将列出一个非常长的文本文件的内容。</p><code>cat words.page</code><img class="content_img" src="/image/d8/d853bf0bd2f4ca7098f7b7100cfe1601.png" /><p>在带有进度的终端窗口中，您将看到cat命令执行并接近完成时的统计信息。</p><img class="content_img" src="/image/8a/8a721f612c5bab9e9d6949704a667bd0.png" /><p>当cat完成列出文件时，进度返回到其等待状态。</p><p>每当它可以报告的某个命令执行相当大的任务时，Progress都会自动监视并报告该任务。</p><p>那是相当整洁的。</p><p>100%完成</p><p>不要只是猜测一个长期运行的命令是如何运行的，而是从思考光标与PV和进度之间的关系中抽出一点时间来休息一下。</p><p></p><div class="item_info"><span class="item_key"><a href="/tag/命令/">命令</a></span><span class="item_key"><a href="/tag/使用/">使用</a></span><span class="item_key"><a href="/tag/pv/">pv</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14507.html">如何在Linux上使用HISTORY命令</a><li><a href="/story/14466.html">如何在Linux上使用at和Batch来调度命令</a><li><a href="/story/14448.html">如何在Linux上使用Which命令</a><li><a href="/story/14302.html">如何在Linux上使用Echo命令</a><li><a href="/story/14121.html">如何在Linux上使用chroot命令</a><li><a href="/story/14091.html">如何在Linux上运行和控制后台进程</a><li><a href="/story/14037.html">如何在Linux上创建别名和Shell函数</a><li><a href="/story/14013.html">Bash你需要知道的15个特殊字符</a><li><a href="/story/14001.html">如何在Linux上使用管道</a><li><a href="/story/13823.html">如何在Linux上使用xargs命令</a><li><a href="/story/13779.html">如何在Linux上使用rev命令</a><li><a href="/story/13621.html">如何从Linux终端列出您的计算机设备</a><li><a href="/story/13610.html">如何使用Linux type命令</a><li><a href="/story/13585.html">如何使用Linux的所有搜索命令</a><li><a href="/story/13474.html">如何在Linux上使用重命名命令</a><li><a href="/story/13312.html">如何从Linux终端杀死进程</a><li><a href="/story/13258.html">37个您应该知道的重要Linux命令</a><li><a href="/story/13253.html">如何使用命令行重新启动或关闭Linux</a><li><a href="/story/13218.html">如何在Linux上使用“Install”命令复制文件</a><li><a href="/story/13196.html">如何更改默认的crontab编辑器</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>