<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用OpenVPN和番茄，随时随地连接到您的家庭网络</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>使用OpenVPN和番茄，随时随地连接到您的家庭网络</h2></div><div class="content"><img class="content_img" src="/image/61/617391feaa959570d701d07cc3920461.png" /><p>几周前，我们介绍了在Linksys WRT54GL上安装Tomato，这是一个开源路由器固件。今天我们将介绍如何在番茄旁边安装OpenVPN，并将其设置为从世界任何地方访问您的家庭网络！</p><p>什么是OpenVPN？</p><img class="content_img" src="/image/c8/c8ff4d5cb766e8bfc1e47bfc04f0370f.png" /><p>虚拟专用网(VPN)是一个局域网(LAN)与另一个局域网(LAN)之间的可信、安全连接。将您的路由器视为连接到的网络之间的中间人。您的计算机和OpenVPN服务器(在本例中是您的路由器)都使用相互验证的证书“握手”。在验证之后，客户端和服务器都同意彼此信任，然后允许客户端访问服务器的网络。</p><p>通常，实施VPN软件和硬件需要花费大量资金。如果您还没有猜到，OpenVPN是一个免费(滚滚)的开源VPN解决方案。对于那些想要在两个网络之间建立安全连接而无需打开钱包的人来说，番茄和OpenVPN是一个完美的解决方案。当然，OpenVPN不会开箱即用。需要进行一些调整和配置才能使其恰到好处。不过不用担心，我们来这里是为了让你的过程更容易，所以给自己拿杯热咖啡，我们开始吧。</p><p>有关OpenVPN的更多信息，请访问官方的什么是OpenVPN？传呼。</p><p>先决条件</p><p>本指南假定您当前在PC上运行Windows 7，并且您使用的是管理帐户。如果你是Mac或Linux用户，这本指南会让你了解事情是如何运作的，然而，你可能需要自己多做一点研究才能让事情变得完美。此外，我们还将在Linksys WRT54GL 1.1版路由器上安装名为TomatoUSB VPN的特殊版本的Tomato。要了解您的路由器是否与TomatoUSB兼容，请查看它们的构建类型页面。</p><p>本指南的开头假设您具有以下任一条件：</p><p>
路由器上安装的原始Linksys固件或。
我们在上一篇文章中描述的番茄固件</p><p>请注意某些步骤上的文本，指示它是用于Linksys固件还是用于Tomato固件。</p><p>安装TomatoUSB</p><p>在前一篇文章中，我们讨论了如何从PolarCloud网站安装原始的Tomato v1.28固件。不幸的是，该版本的Tomato没有提供OpenVPN支持，所以我们将安装一个较新的版本，称为TomatoUSB VPN。</p><p>您要做的第一件事是转到TomatoUSB主页并单击Download Tomato USB链接。</p><img class="content_img" src="/image/64/64c96d2fef0424d65dabf2712d77712d.png" /><p>在内核2.4(稳定)部分下载VPN。将.rar文件保存到您的计算机。</p><img class="content_img" src="/image/e2/e293b437ecb3e95898693461a4b3bfd2.png" /><p>您需要一个程序来解压缩.rar文件。我们建议使用WinRAR，因为它可以免费试用且易于使用。你可以在他们的网站上下载一份免费版本。安装WinRAR后，右键单击您下载的文件，然后单击提取此处。然后您应该会看到两个名为changeLog和番茄-NDUSB-1.28.8754-vpn3.6.trx的文件。</p><img class="content_img" src="/image/1f/1ffddf0b49f5d7ddf358113ecce527f4.png" /><p>如果您运行的是Linksys Firmware…</p><p>打开浏览器并输入路由器的IP地址(默认为192.168.1.1)。系统将提示您输入用户名和密码。Linksys WRT54GL的默认值为“admin”和“admin”。</p><img class="content_img" src="/image/cf/cffe8b4c796f7ebd051c08f01d54d527.png" /><p>单击顶部的管理选项卡。接下来，单击Firmware Upgrade(固件升级)，如下所示。</p><img class="content_img" src="/image/dc/dc987ca3d36a23940e387fd5c0636f5e.jpg" /><p>单击Browse按钮并导航到解压缩的TomatoUSB VPN文件。选择番茄-NDUSB-1.28.8754-vpn3.6.trx文件，然后单击Web界面中的Upgrade按钮。您的路由器将开始安装TomatoUSB VPN，应该不会超过一分钟即可完成。大约一分钟后，打开命令提示符，然后键入ipconfig-release以确定路由器的新IP地址。然后键入ipconfig-renew。默认网关…右侧的IP地址。是您的路由器的IP地址。</p><img class="content_img" src="/image/2c/2c2e369c2697a74cc7bbff0093ce5d04.png" /><p>注：安装番茄后，进入管理&gt;配置并选择“擦除所有NVRAM…”。</p><p>如果您运行的是番茄固件…</p><p>打开浏览器并输入路由器的IP地址。我们假设如果您安装了Tomato，您就知道路由器的IP地址。如果您不确定，则可能将其设置为默认值192.168.1.1。之后，输入您的用户名和密码。</p><img class="content_img" src="/image/f9/f933664f67f6e643b1ce65a5910b7c2f.jpg" /><p>虽然这不是必需的，但您可能希望在升级到TomatoUSB VPN之前备份当前的Tomato配置，以防万一。要保存您的配置，请导航到Administration&gt;Configuration，然后单击Backup按钮。这将提示您将.cfg文件保存到您的计算机。</p><img class="content_img" src="/image/a1/a1b61b5ce945801258b96f5485623f6e.png" /><p>现在是将Tomato升级到TomatoUSB VPN的时候了。单击左列中的升级，然后单击选择文件按钮。导航到我们之前解压缩的文件，并选择番茄-NDUSB-1.28.8754-vpn3.6.trx文件。然后单击升级按钮。</p><img class="content_img" src="/image/3f/3ff9aa161e14e12c4aa5e2e26bf90671.png" /><p>系统将要求您确认升级；只需单击“确定”即可。</p><img class="content_img" src="/image/4e/4ef1fc3ec3bfb2cb4c9c636c37ae1713.png" /><p>您的路由器将开始上传新固件，并在一分钟内重新启动。</p><img class="content_img" src="/image/b2/b2ed7788ea268725ca209e172e5516ca.png" /><p>它在重新启动后可能具有相同或不同的IP地址。在我们的示例中，路由器配置仍然相同，因此我们的IP地址仍然相同。要确定路由器的新IP地址，请打开命令提示符，然后键入ipconfig-release。然后键入ipconfig-renew。默认网关…右侧的IP地址。是您的路由器的地址。如果您的配置设置回默认值，请返回到配置页面(管理&gt;配置)，然后单击恢复配置下的选择文件按钮。浏览您先前保存到计算机的.cfg文件，然后单击还原按钮。</p><p>配置OpenVPN</p><p>无论您安装了Linksys固件还是Tomato固件，现在您的路由器上都应该安装了新的TomatoUSB VPN。您将注意到左栏中的几个新菜单，包括Web使用、USB和NAS以及VPN隧道。在本指南中，我们只关注VPN隧道菜单，因此请继续单击VPN隧道。使此浏览器窗口保持打开状态；我们将很快返回到该窗口。</p><img class="content_img" src="/image/a9/a90c38fe61696105f95a9eb5f3bed685.png" /><p>现在，让我们转到OpenVPN的下载页面并下载OpenVPN Windows安装程序。在本指南中，我们将使用名为2.1.4的OpenVPN的第二个最新版本。最新版本(2.2.0)中有一个错误，会使这个过程变得更加复杂。我们正在下载的文件将安装OpenVPN程序，该程序允许您连接到您的VPN网络，因此请确保将此程序安装在您要用作客户端的任何其他计算机上(因为我们将在稍后了解如何执行此操作)。将openvpn-2.1.4-install.exe文件保存到您的计算机。</p><img class="content_img" src="/image/12/12e97a662a83989f474041a92bebbc61.png" /><p>导航到我们刚刚下载的OpenVPN文件并双击它。这将开始在您的计算机上安装OpenVPN。在选中所有默认值的情况下运行安装程序。在安装过程中，将弹出一个对话框，要求安装名为TAP-Win32的新虚拟网络适配器。单击Install(安装)按钮。</p><img class="content_img" src="/image/70/708eaa7c7a12e0e51d3974ba5bdb085f.png" /><p>现在您已经在计算机上安装了OpenVPN，我们必须开始创建证书和密钥来验证设备。</p><p>创建证书和密钥</p><p>单击Windows开始按钮，然后在附件下导航。您将看到命令提示符程序。右键单击它，然后单击以管理员身份运行。</p><img class="content_img" src="/image/e3/e3df6cca931955669e769740140a7efc.png" /><img class="content_img" src="/image/91/91f7b8a34b8d2ec6e71f126209d05520.png" /><p>现在键入init-config并按Enter键，将名为vars.bat和openssl.cnf的两个文件复制到Easy-rsa文件夹。请打开您的命令提示符，因为我们很快就会回来讨论它。</p><img class="content_img" src="/image/d7/d7e5bbba162223c06ff5258a1e24cc93.png" /><p>导航到C：\Program Files(X86)\OpenVPN\Easy-rsa(在32位Windows 7上为C：\Program Files\OpenVPN\Easy-rsa)，然后右键单击名为vars.bat的文件。单击编辑在记事本中将其打开。或者，我们建议使用Notepad++打开此文件，因为它可以更好地格式化文件中的文本。您可以从他们的主页下载Notepad++。</p><img class="content_img" src="/image/d6/d6b813226a0401a7fd354bd12ac173bb.png" /><p>文件的底部是我们所关心的。从第31行开始，将KEY_COUNTRY值、KEY_EXPERATION值等更改为您所在的国家、省份等。例如，我们将我省更改为“IL”，将城市更改为“Chicago”，将org更改为“Howtogek”，并将电子邮件更改为我们自己的电子邮件地址。此外，如果您运行的是64位Windows7，请将第6行中的HOME值更改为%ProgramFiles(X86)%\openvpn\Easy-rsa。如果您运行的是32位Windows7，请不要更改此值。您的文件应该与下面的文件类似(当然，使用您各自的值)。编辑完成后，通过覆盖文件来保存该文件。</p><img class="content_img" src="/image/7c/7cf4713cb587ae758bf53398f9f1c8b3.png" /><p>返回到命令提示符，键入vars并按Enter键。然后键入CLEAN-ALL并按Enter键。最后，键入build-ca并按Enter键。</p><img class="content_img" src="/image/18/1897eda2229f91dbf4c2ee85466cf97c.png" /><p>执行build-ca命令后，系统将提示您输入国家名称、州、地区等。由于我们已经在vars.bat文件中设置了这些参数，因此可以通过按Enter键跳过这些选项，但是！在开始猛击Enter键之前，请注意Common Name参数。您可以在此参数中输入任何内容(即您的姓名)。只要确保你输入了一些东西就行了。此命令将输出Easy-rsa/Key文件夹中的两个文件(一个根CA证书和一个根CA密钥)。</p><img class="content_img" src="/image/cb/cb0552d945ecd3ac2a7daf76a80688f3.png" /><p>现在，我们将为客户端构建密钥。在同一命令提示符中，键入build-key client1。您可以将“client1”更改为您想要的任何内容(例如，宏碁笔记本电脑)。只要在系统提示时确保输入与通用名称相同的名称即可。例如，当您运行命令build-key Acer-Laptop时，您的常用名称应该是“Acer-Laptop”。像我们上一步一样运行所有默认设置(当然，除了Common name之外)。但是，最后将要求您签署证书并提交。为两者键入“y”，然后按Enter键。</p><p>此外，如果收到“无法写入‘随机状态’”错误，也不用担心。我注意到您的证书仍然可以毫无问题地制作出来。此命令将输出Easy-rsa/Key文件夹中的两个文件(Client1密钥和Client1证书)。如果要为另一个客户端创建另一个密钥，请重复上一步，但一定要更改公用名。</p><img class="content_img" src="/image/b3/b3ddcea544b297ae889105ae5bd17543.png" /><p>我们将生成的最后一个证书是服务器密钥。在同一命令提示符下，键入build-key-server server。您可以将命令末尾的“server”替换为您想要的任何内容(即Howtogeek-Server)。与往常一样，请确保在出现提示时输入与通用名称相同的名称。例如，当您运行命令build-key-server Howtogek-Server时，您的常用名称应该是“Howtogeek-Server”。按Enter键并运行除通用名称之外的所有默认值。在末尾，键入“y”以签署证书并提交。此命令将输出Easy-rsa/KEYS文件夹中的两个文件(一个服务器密钥和一个服务器证书)。</p><img class="content_img" src="/image/aa/aa6e877913db51dc37bf11df24b869dd.png" /><p>现在我们必须生成Diffie Hellman参数。Diffie Hellman协议“允许两个用户在没有任何事先秘密的情况下通过不安全的介质交换秘密密钥”。你可以在RSA的网站上了解更多关于Diffie Hellman的信息。</p><p>在同一命令提示符中，键入build-dh。此命令将输出Easy-rsa/key文件夹中的一个文件(dh1024.pem)。</p><img class="content_img" src="/image/c7/c7e9fa73eaabcca712a462bc69c02543.png" /><p>为客户端创建配置文件</p><p>在编辑任何配置文件之前，我们应该设置动态DNS服务。如果您的ISP经常向您发出动态外部IP地址，请使用此服务。如果您有静态外部IP地址，请跳到下一步。</p><p>我们建议使用DynDNS.com，这是一项允许您将主机名(即howtoggek.dyndns.org)指向动态IP地址的服务。对于OpenVPN来说，始终知道您网络的公共IP地址是很重要的，通过使用DynDNS，OpenVPN将始终知道如何定位您的网络，无论您的公共IP地址是什么。注册一个新的主机名，并将其指向您的公共IP地址。一旦你注册了这项服务，别忘了在“Basic”&gt;“DDNS”下的Tomato中设置自动更新服务。</p><p>现在回到配置OpenVPN。在Windows资源管理器中，如果您运行的是64位Windows 7，请导航到C：\Program Files(X86)\OpenVPN\Sample-config；如果您运行的是32位Windows 7，请导航到C：\Program Files\OpenVPN\Sample-config。在此文件夹中，您将找到三个示例配置文件；我们只关注client.ovpn文件。</p><img class="content_img" src="/image/87/8737153de9a16ec2dfaeb880c33fc08e.png" /><p>右键单击client.ovpn并使用记事本或记事本++打开它。您会注意到您的文件如下图所示：</p><img class="content_img" src="/image/0f/0f86bde9707891dcaccefbc3fe36be5d.png" /><p>但是，我们希望client.ovpn文件看起来类似于下图。确保在第4行中将DynDNS主机名更改为您的主机名(如果您有静态IP地址，则将其更改为您的公共IP地址)。将端口号保留为1194，因为它是标准OpenVPN端口。此外，请确保更改第11行和第12行，以反映您的客户端的证书文件和密钥文件的名称。将其另存为OpenVPN/config文件夹中的新文件.ovpn文件。</p><img class="content_img" src="/image/b4/b4f62285f1028efa7c862d90b7c78cc8.png" /><p>配置番茄的VPN隧道</p><p>现在的基本思路是复制我们之前创建的服务器证书和密钥，并将它们粘贴到Tomato VPN服务器菜单中。然后我们将在Tomato中检查一些设置，测试VPN连接，然后我们就可以洗手了，今天就到此为止了！</p><p>打开浏览器并导航到您的路由器。单击左侧栏中的VPN隧道菜单。确保还选择了Server1和Basic。完全按照下面显示的方式设置您的设置。单击“保存”。</p><p>更新：默认模式是Tun(隧道)，但您可能想要将其更改为TAP(桥接网络)。*隧道模式会将您的外部客户端置于与内部网络不同的网络上。因此，一定要将接口类型更改为分路。</p><img class="content_img" src="/image/79/7925ff8fad1f43a2b3ce98df66d66bfc.png" /><p>接下来，单击Basic(基本)旁边的Advanced(高级)选项卡。就像以前一样，请确保您的设置与下面显示的完全相同。单击“保存”。</p><img class="content_img" src="/image/13/131b456b61b7da23ee9d98b576a5f9d8.png" /><p>我们的最后一步是粘贴最初创建的密钥和证书。打开“高级”旁边的“密钥”选项卡。在Windows资源管理器中，导航到C：\Program Files(X86)\OpenVPN\Easy-rsa\Key(在64位Windows 7上)(或C：\Program Files\OpenVPN\Easy-rsa\Key(在32位Windows 7上))。使用记事本或记事本++打开下面每个相应的文件(ca.crt、Server.crt、Server.key和dh1024.pem)并复制内容。将内容粘贴到相应的框中，如下所示。我应该注意到，您只需要将下面的所有内容--BEGIN CERTIFICATE--粘贴到Server.crt中。如果粘贴整个文件，openvpn仍然可以正常工作，但是只粘贴实际的证书信息会更“干净”。单击保存，然后单击立即开始。</p><img class="content_img" src="/image/50/50a68bddda9946e7683ad63da129018d.png" /><p>在我们测试我们的VPN连接之前，还有一件事我们必须检查一下番茄的内部。单击左栏中的Basic(基本)，然后单击Time(时间)。请确保路由器时间正确，并且时区显示您的当前时区。将NTP时间服务器设置为您的国家/地区。</p><img class="content_img" src="/image/57/57f42df918b9185625ee0825f57bcd91.png" /><p>设置OpenVPN客户端</p><p>在此示例中，我们将使用Windows 7笔记本电脑作为客户端。您要做的第一件事是在客户端上安装OpenVPN，就像我们在上面配置OpenVPN的第一步中所做的那样。然后导航到C：\Program Files\OpenVPN\config，这是我们将要粘贴文件的位置。</p><p>现在，我们必须回到原来的计算机上，收集总共四个文件以复制到我们的客户笔记本电脑上。再次导航到C：\Program Files(X86)\OpenVPN\Easy-rsa\key并复制ca.crt、client1.crt和client1.key。将这些文件粘贴到客户端的config文件夹中。</p><img class="content_img" src="/image/04/04dc8d0437f2fffec79b3f8b08c11a51.png" /><p>最后，我们需要再复制一个文件。导航到C：\Program Files(X86)\OpenVPN\config并复制我们之前创建的新client.ovpn文件。也将此文件粘贴到客户端的config文件夹中。</p><p>测试OpenVPN客户端</p><p>在客户端笔记本电脑上，单击Windows开始按钮，然后导航到所有程序&gt;OpenVPN。右键单击OpenVPN GUI文件，然后单击以管理员身份运行。请注意，您必须始终以管理员身份运行OpenVPN，才能使其正常工作。若要将文件永久设置为始终以管理员身份运行，请右键单击该文件，然后单击“属性”。在兼容性选项卡下，选中以管理员身份运行此程序。</p><img class="content_img" src="/image/cd/cd941c188455d60feba31914cc2d9e71.png" /><p>任务栏中时钟旁边将显示OpenVPN GUI图标。右键单击图标，然后单击连接。因为我们的config文件夹中只有一个.ovpn文件，所以OpenVPN将默认连接到该网络。</p><img class="content_img" src="/image/b5/b57573a33342fb39cc29d93182d4fa2b.png" /><p>将弹出一个对话框，显示连接日志。</p><img class="content_img" src="/image/22/2241b57e46f6a2493ccda3a0334668fe.png" /><p>连接到VPN后，任务栏中的OpenVPN图标将变为绿色，并显示您的虚拟IP地址。</p><img class="content_img" src="/image/b0/b0fdc2da8e5e81e48d0c620526c7caaf.png" /><p>就这样！现在，您已经使用OpenVPN和TomatoUSB在服务器和客户端网络之间建立了安全连接。要进一步测试连接，请尝试打开客户端笔记本电脑上的浏览器，然后导航到服务器网络上的Tomato路由器。</p><p>由Ewan拍摄的图像</p><div class="item_info"><span class="item_key"><a href="/tag/openvpn/">openvpn</a></span><span class="item_key"><a href="/tag/文件/">文件</a></span><span class="item_key"><a href="/tag/路由器/">路由器</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/3083.html">如何在DD-WRT路由器上安装和配置OpenVPN</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>