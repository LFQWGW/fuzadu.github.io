<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在Linux上使用Magic SysRq键修复冻结的X服务器，干净地重新启动，并运行其他低级命令</title><link rel="stylesheet" href="/css.css"><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?f75329719d379998b2421a4cc2396366";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>在Linux上使用Magic SysRq键修复冻结的X服务器，干净地重新启动，并运行其他低级命令</h2></div><div class="content"><img class="content_img" src="/image/45/45092735ac74fb57a7eddf7d6fb7bf64.jpg" /><p>在Linux上，神奇的SysRq键可以直接向Linux内核发送命令。您可以使用它从冻结中恢复或干净地重新启动系统，即使似乎没有任何响应。</p><p>神奇的SysRq键是作为Linux键盘驱动程序的一部分实现的-只要Linux内核仍在运行，它就会工作。只有内核死机才能禁用此组合键。</p><p>图片来源：Flickr上的solylunafamilia</p><p>使用Magic SysRq密钥</p><p>SysRq键位于键盘上的Scroll Lock键附近-系统RQ键通常与Print Screen键相同。“神奇的”SysRq组合是Alt+SysRq。</p><p>要使用这个组合键，您的Linux内核必须已经使用CONFIG_MAGIC_SysRq编译选项进行了编译-大多数Linux发行版在缺省情况下都会启用该选项。假设它已编译到您的内核中，可以通过更改/proc/sys/kernel/sysRq的值在运行的系统上启用或禁用它。要检查它是否已启用，请运行以下命令：</p><p>如果您看到“1”，则表示魔术SysRq键的所有功能都已启用。数字越大，表示只启用了某些功能-有关更多信息，请参阅官方的Linux内核帮助。</p><img class="content_img" src="/image/5a/5a89a6b5d31a09d5dba07c6ae08ae2a9.png" /><p>如果您看到“0”，您可以通过运行以下命令自己启用所有魔术SysRq选项：</p><p>在Ubuntu上，魔术SysRq选项在引导时根据/etc/sysctl.d/10-magic-sysrq.conf文件的内容进行设置。编辑此文件以选择所需的值。</p><p>处理冻结的X服务器</p><p>如果您的X服务器(运行图形桌面的程序)冻结，您可能会发现自己无法使用系统。有几个神奇的SysRq命令可以提供帮助：</p><p>
Alt+SysRq+r-使键盘退出原始模式，使X服务器失去控制权。运行此组合后，您应该能够使用Ctrl+Alt+F1(和其他F键)键盘快捷键切换到另一个控制台并重新启动X。
Alt+SysRq+k-杀死当前虚拟控制台上的所有程序，包括X。您也可以在Ubuntu的键盘首选项中启用Ctrl+Alt+Backspace键盘快捷键来重新启动X服务器-但是，此快捷键是由X服务器实现的，可能并不总是有效的。</p><p>干净地重新启动系统</p><p>按顺序使用，其中一些操作可用于干净地结束进程、将数据刷新到磁盘、卸载所有文件系统以及重新启动计算机。要执行此过程，请按住Alt+SysRq组合键，并在按住Alt和SysRq键的同时，按顺序键入以下键，并在每个键之间暂停几秒钟：</p><p>人们经常用助记法“养大象太无聊了”来记住这个序列。下面是每个键的功能：</p><p>
R-将键盘置于原始模式，使其脱离X服务器的控制。
E-向所有进程发送终止信号，要求它们正常结束。
i-向所有进程发送终止信号，强制它们立即结束。
s-将数据从缓存刷新到磁盘。
u-以只读方式重新装载所有文件系统。
B-重新启动计算机。</p><p>更多命令</p><p>以下是您可以使用神奇的SysRq键执行的其他一些操作。要执行操作，请在按住Alt+SysRq键的同时键入字母：</p><p>
N-重置所有高优先级和实时优先级进程的NICE级别(优先级)。
f-调用oom_kill，它将终止一个占用内存的进程。
O-关闭计算机。</p><p>还有其他操作，但它们可能比普通的Linux极客对开发人员更有用。有关魔术SysRq键的更多信息-以及可以执行的完整操作列表-请参考Linux内核的官方魔术SysRq文档。</p><div class="item_info"><span class="item_key"><a href="/tag/sysrq/">sysrq</a></span><span class="item_key"><a href="/tag/键盘/">键盘</a></span><span class="item_key"><a href="/tag/linux/">linux</a></span></div></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>