<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何在Linux上将ext2或ext3文件系统迁移到ext4</title><link rel="stylesheet" href="/css.css"><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?f75329719d379998b2421a4cc2396366";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何在Linux上将ext2或ext3文件系统迁移到ext4</h2></div><div class="content"><p>你知道你应该升级你的Linux文件系统，但不能面对这种恶化吗？下面介绍如何将ext2和ext3转换为ext4，而无需完全重新安装。</p><p>Linux文件系统</p><p>如果您有礼貌的话，您会说ext3文件系统历史悠久，它早在2001年就推出了。至于可怜的老ext2，这个文件系统源自1993年，除了古老之外，没有其他词可以用来形容它。在计算机术语中，ext3是一件古董。而ext2是一项考古发现。</p><p>Linux世界中的现代文件系统是2008年发布的ext4。它更快，更不容易碎片化，能够处理更大的文件系统-更大的文件-它有更准确的文件日期戳，我们提到过它更快吗？快多了。</p><p>好的，我被卖了-我们开始吧</p><p>让我们把这件事想清楚。实际上，您可能不想升级文件系统。</p><p>相反，升级整个Linux系统更有意义。我们所说的升级是指进行几次数据备份，擦除您的系统，重新安装最新的发行版，并恢复您的数据。去彻底刷新一下吧。通过更新的软件以及干净的、最新的和新安装的文件系统获得现代Linux发行版的好处。</p><p>如果你不能在你的硬件上运行现代的Linux，即使是像Lubuntu、LinuxLite或CrunchBang++这样的轻量级发行版，你也必须坚持使用你已经拥有的Linux，仍然有一些警告。</p><p>要将文件系统升级到ext4，您必须使用内核版本2.6.28或更高版本。因此，如果您没有该版本或更高版本的内核，则必须首先升级内核。</p><p>警告：在没有满足内核版本要求的情况下，不要想尝试这样做。您最终会得到一台无法引导的计算机。在继续之前，请检查您正在使用的内核版本。</p><p>确保您有当前使用的Linux版本的安装盘，并将其保持在待机状态。升级文件系统并非没有危险。</p><p>备份是您的安全网。在做任何事情之前，请将数据备份到不同的备份介质，并确保手头有旧的Linux安装盘。如果出现严重问题，您可以重新安装旧的Linux并恢复数据。</p><p>您还需要现代Linux发行版的最新LiveCD/DVD来执行文件系统升级。所以要确保你也有一个这样的东西要交。</p><p>顺便说一句，本文是使用2009年4月发布的Ubuntu Jaunty Jackalope安装程序进行研究的。它使用ext3作为文件系统。</p><p>还和我们在一起吗？</p><p>约翰·韦恩(John Wayne)说，勇气是被吓坏了，但无论如何还是要备好鞍子。我很佩服你的胆量。</p><p>我们要做的第一件事是用uname检查内核版本。uname命令可以显示不同类型的系统信息。</p><p>在您的旧Linux计算机上，打开一个终端窗口并键入以下命令。键入uname、空格、0-r，然后按Enter键。</p><code>uname -r</code><img class="content_img" src="/image/67/67b47de7d5274c800c0d7fe4087f24ce.png" /><p>这台计算机上的Linux版本使用的是内核版本2.6.28-11，所以我们已经满足了内核版本的要求。</p><p>说真的，如果你还没有达到这个要求，现在就停止吧。仅仅靠得够近是不够的。您必须达到或超过此内核版本号。</p><p>现在，我们将使用blKID检查磁盘标识符，它标识系统上的块设备。</p><code>blkid</code><img class="content_img" src="/image/d9/d9f548217c1c5c5fa91fdca5ce0e1511.png" /><p>该系统有一个硬盘驱动器(SDA)，其上有一个挂载在/dev/sda1处的文件系统(Sda1)。这是一个ext3文件系统。这是我们要转换的文件系统。</p><p>还有一种名为交换的文件系统，但我们对此不感兴趣。</p><p>使用Live CD重新启动</p><p>插入Live CD并重新启动计算机。您可能需要在重新启动过程中按任意键，才能使计算机从CD启动。要按的键将在启动过程的早期阶段显示。动作要快-机会之窗不会持续太久。如果错过，请重新启动并重试。</p><p>当您引导到Live CD环境时，请确保不会意外启动安装。花点时间阅读一下提供给您的选项，如果有类似于“try DistributionName”的选项，请选择该选项。</p><p>成为根</p><p>打开终端窗口并键入以下命令。这实际上使您成为root用户，这意味着您不需要在每个命令前面键入sudo。</p><code>sudo bash</code><img class="content_img" src="/image/70/70070274d62e1bf26e0a071fead53547.png" /><p>请注意，命令提示符已更改。你是根。小心行事。</p><p>识别文件系统</p><p>我们需要再次标识文件系统，看看它们在这个Linux实例中是如何显示的。</p><code>fdisk -l</code><img class="content_img" src="/image/cd/cd7a37a29f77854fafca80f05d4cb001.png" /><p>您将看到一些类似以下内容的输出。</p><img class="content_img" src="/image/6e/6e1f2ecd9e76b648355105d6597a433c.png" /><p>我们之前标识为sda1的文件系统已被Live CD Linux找到并识别。这是第一个小型里程碑。</p><p>第二个是转换文件系统。</p><p>转换文件系统</p><p>这里列出了两个命令，一个用于从ext2转换到ext4，另一个用于从ext3转换到ext4。请确保您使用的是正确的！</p><p>要从ext2转换为ext4，请使用以下命令：</p><code>tune2fs -O extents,uninit_bg,dir_index,has_journal /dev/sda1</code><p>要从ext3转换为ext4，请使用以下命令：</p><code>tune2fs -O extents,uninit_bg,dir_index /dev/sda1</code><img class="content_img" src="/image/f4/f4656697610ed52b743ddc30f5f8c547.png" /><p>这有点平淡无奇，因为似乎没有太多事情发生。您将返回到命令提示符。如果你看到一些输出，很可能是错误消息。所以这里没有消息就是好消息。</p><p>检查文件系统</p><p>即使没有标记错误，我们也要彻底检查整个文件系统是否有问题。我们将使用名为e2fsck的命令。这是一个用于检查文件系统完整性的工具。它还可以尝试修复它发现的任何问题。e2fsck工具适用于ext2、ext3和ext4文件系统。</p><p>p(Preen)选项导致e2fsck尝试修复错误，-f(Force)选项导致e2fsck检查文件系统，即使文件系统看起来很干净。</p><code>e2fsck -pf /dev/sda1</code><img class="content_img" src="/image/db/db48544315b73b46aa3bf5194b7cb1e2.png" /><p>未报告错误。现在我们可以尝试挂载文件系统了。</p><p>装载文件系统</p><p>我们需要调整文件系统表(Fstab)和GRUB引导加载器以使用转换后的文件系统。为此，我们必须挂载文件系统。我们将把它装在/mnt上。我们在前面将文件系统标识为sda1，因此我们的命令是：</p><code>mount -t ext4 /dev/sda1 /mnt</code><img class="content_img" src="/image/02/0203b93bce7cd219baf08eb62ed29f2d.png" /><p>现在它已经挂载，我们应该能够列出文件系统了。我们来检查一下。文件系统的根将位于挂载点/mnt。</p><code>ls /mnt</code><img class="content_img" src="/image/bb/bbe362fe28b6ccfdda0f4cf5f7146fa2.png" /><p>这很鼓舞人心。看起来我们已经预料到了。</p><p>相关：如何从Linux终端挂载和卸载存储设备</p><p>编辑fstab</p><p>我们需要编辑fstab文件，并将ext3(或ext2，如果是您从中转换的文件系统)的任何引用更改为ext4。</p><p>本例中使用的Live CD上有Nano编辑器。这是一个简单的小编辑器，所以我们将使用它。如果您的LiveCD上没有Nano，那么该CD上将会有另一个由Linux发行版捆绑的编辑器。</p><code>nano /mnt/etc/fstab</code><img class="content_img" src="/image/29/292ed401ea663846c57f5d03f0192868.png" /><p>将出现Nano编辑器窗口。您需要查找字符串“ext3”或“ext2”的匹配项，并将它们更改为“ext4”。在本例中，出现了一个ext3，它被突出显示。</p><img class="content_img" src="/image/e8/e86dcf62370d6ac231beeb4cdcdb3036.png" /><p>ext3被ext4取代。</p><img class="content_img" src="/image/3c/3c32d704b8faac5f968970aacea35303.png" /><p>您需要保存文件并退出编辑器。在Nano中，Ctrl+O将保存文件，Ctrl+X将关闭编辑器。</p><p>升级GRUB</p><p>因为我们已经将sda1文件系统挂载到/mnt上，文件系统中目录的路径实际上都比通常移动了一个级别。这就是为什么我们提供给Nano的路径是/mnt/etc/fstab，而不是通常的/etc/fstab。</p><p>因为GRUB希望在某些位置找到内容，所以我们需要使文件系统看起来就像是正常挂载的一样。我们需要文件系统的根位于/，而不是/mnt。chroot命令允许我们运行命令shell并指定我们希望使用的根点。</p><p>我们使用的命令是：</p><code>chroot /mnt</code><img class="content_img" src="/image/1d/1d8bedf1c862606525ef064c49a6731b.png" /><p>请注意，命令提示符已更改。</p><p>现在我们可以发出update-GRUB命令，让GRUB读取fstab文件并重新配置自身。</p><code>update-grub</code><img class="content_img" src="/image/31/313a89bd3f6c58abf6e8d01d70b62051.png" /><p>重新配置GRUB之后，我们需要在硬盘上安装一个新的GRUB实例。注意：这是硬盘sda，不是文件系统sda1。不包括“1”，只需键入“sda”即可。</p><code>grub-install /dev/sda</code><img class="content_img" src="/image/87/872160987313f6208966ada8675076b7.png" /><p>重新启动您的Linux</p><p>重新启动系统并取出Live CD。系统重新启动后，打开一个终端窗口，然后输入以下命令：</p><code>blkid</code><img class="content_img" src="/image/2d/2d5eefefdd5865d30df33991bf2d2a17.png" /><p>正如我们所看到的，文件系统现在是ext4文件系统。</p><p>本文研究的机器花了很长时间重新启动(超过10分钟)，人们认为它出了问题，永远也不会重新启动。</p><p>可能是因为它是虚拟机，也可能是因为某些文件系统转换发生在第一次引导期间。无论哪种方式，耐心都占了上风，最终它确实重新浮出水面。如果您的机器执行类似的操作，请等待它结束。可能不会失去一切。</p><p>随后的重新启动速度与正常一样快。</p><p>改为升级您的Linux</p><p>嗯，我们到了。但是，您仍然可以在现代文件系统上使用旧Linux版本的非标准混合。</p><p>如果迁移到新的文件系统对您很重要，并且您的硬件可以接受，那么迁移到当前的Linux发行版是最好的选择。您将享受到这样做所带来的所有其他安全和软件优势。</p><p>不过，如果没有其他方法-有时我们没有我们希望的选项-这些步骤将允许您升级您的文件系统。</p><div class="item_info"><span class="item_key"><a href="/tag/文件系统/">文件系统</a></span><span class="item_key"><a href="/tag/linux/">linux</a></span><span class="item_key"><a href="/tag/使用/">使用</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14199.html">如何在Linux上使用mkfs命令</a><li><a href="/story/13374.html">如何从Linux终端挂载和卸载存储设备</a><li><a href="/story/13136.html">如何从Linux终端查看可用磁盘空间和磁盘使用情况</a><li><a href="/story/7311.html">什么是文件系统？为什么会有这么多文件系统？</a><li><a href="/story/6446.html">NTFS或FAT32：为内部SSD数据分区选择最佳文件系统</a><li><a href="/story/5079.html">文件系统只是一堆文件夹吗？(说明文件系统)</a><li><a href="/story/4375.html">为什么Linux不需要碎片整理</a><li><a href="/story/3285.html">我应该为我的USB驱动器使用什么文件系统？</a><li><a href="/story/2612.html">什么是Linux fstab文件，它是如何工作的？</a><li><a href="/story/2519.html">您应该使用哪个Linux文件系统？</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>