<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何备份您的Linux系统</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何备份您的Linux系统</h2></div><div class="content"><p>不要冒数据丢失的风险。从Linux命令行备份您的重要数据。为此，我们将使用rsync命令，我们甚至还没有为它找到一些不错的可选图形界面。</p><p>有很多方法可以完成文件的备份。我们希望向您展示一种强大、灵活和可靠的方式来保护您的数据。我们选择rsync是因为其备受推崇的算法可以计算源目录和目标目录中的文件之间的差异。如果可以避免，则只传输文件的两个版本之间的差异，而不是整个文件。</p><p>如果将这种效率与其自20世纪90年代中期以来在执行文件复制和目录同步方面的良好记录结合在一起，则rsync是从Linux命令行创建备份的完美候选者。</p><p>此外，还有一些独立的软件程序充当rsync的前端。它们提供图形用户界面(GUI)来进行rsync，有些人可能会觉得使用起来更容易。</p><p>备份越简单、越快，您就越有可能这样做。</p><p>对外部硬盘使用rsync</p><p>要将数据备份到外部硬盘，必须挂载该硬盘并且您可以访问该硬盘。如果您可以写入它，那么rsync也可以。在本例中，一个名为SILVERXHD(意为“银色外置硬盘”)的外置USB硬盘被插入Linux计算机。它已由操作系统自动挂载。</p><p>您需要知道驱动器的路径。在GNOME中，打开Nautilus文件浏览器，并在侧边栏中找到驱动器的名称。</p><p>将鼠标指针悬停在外部驱动器的名称上，工具提示会向您显示驱动器的路径。</p><img class="content_img" src="/image/c2/c2e62a5e70086eb039d5b5c17f38f02b.png" /><p>在本例中，工具提示告诉我们外部驱动器上文件系统的挂载点是“/media/dave/SILVERXHD”。</p><p>如果您的文件浏览器不执行此操作，请浏览到外部驱动器并在该位置打开一个终端窗口。使用pwd命令打印终端窗口的路径。</p><p>从源目录复制内容</p><p>要使用rsync将目录内容复制到备份目标，请使用以下命令。</p><p>r(递归)选项使rsync复制所有嵌套的子目录及其内容。请注意，在单词“SILVERXHD”的末尾有一个正斜杠“/”，但它已换到屏幕截图中的下一行。</p><code>rsync -r /home/dave/Documents/ /media/dave/SILVERXHD/</code><img class="content_img" src="/image/b3/b3d36216248556c288d9814427dabcd1.png" /><p>将进行文件复制，并返回到命令行提示符。</p><p>如果我们查看外部USB驱动器，我们会看到Documents目录中的目录已被复制到外部驱动器的根目录。</p><code>ls</code><img class="content_img" src="/image/85/85f4b92fab252684df5bafc3baaa2c8e.png" /><p>复制源目录及其内容</p><p>如果您希望将Documents目录及其内容复制到外部驱动器，请删除命令行中“/home/dave/document”末尾的“/”，如下所示：</p><code>rsync -r /home/dave/Documents /media/dave/SILVERXHD/</code><img class="content_img" src="/image/56/56fa1815fec3d3e7fa376884da74da52.png" /><p>为避免混淆，在执行第二个命令之前，我从外部驱动器中删除了之前复制的两个目录。</p><p>如果我们让第二个副本完成，并再次查看外部驱动器，我们会看到Documents目录已被复制。其内容在该目录中。它们不在外部驱动器的根目录中。</p><img class="content_img" src="/image/6f/6f4db8a064c33ca550cd99bbbe3a3b36.png" /><p>复制到特定目标目录</p><p>要复制到目标硬盘上的特定目录，请将该目录的名称添加到目标路径。假设我们想要将“/home/dave/document”目录的内容复制到外部驱动器上名为“backups”的目录中。</p><p>我们将使用以下命令完成此操作。</p><code>rsync -r /home/dave/Documents/ /media/dave/SILVERXHD/backups/</code><img class="content_img" src="/image/45/457137f3664bf400effe2ee5932ec2ad.png" /><p>检查外部驱动器，我们可以看到备份目录已经创建，在该目录中是“/home/dave/document”目录的内容。</p><code>ls</code><code>ls backups</code><img class="content_img" src="/image/ca/ca54060bfdf5898d15c041cba44282f8.png" /><p>保留文件所有权和权限</p><p>使用-a(存档)选项为复制的文件、符号链接和特殊块文件保留文件属性，如修改日期、文件所有权、访问权限等。</p><code>rsync -ra /home/dave/Documents/ /media/dave/SILVERXHD/backups/</code><img class="content_img" src="/image/77/772e4846b6c97d8a444b1ca365a9902c.png" /><p>使用详细模式</p><p>v(详细)选项强制rsync在复制文件时列出它们。</p><code>rsync -rav /home/dave/Documents/ /media/dave/SILVERXHD/backups/</code><img class="content_img" src="/image/32/32fe908ba232ec2a02e6f388e3b09131.png" /><p>复制完成后，将显示备份摘要。</p><img class="content_img" src="/image/bd/bdebde45c73344d7124deddd163afae8.png" /><p>
已发送：传输到目标的字节数。
已接收：主机接收的字节数。
字节/秒：是有效传输速率。
总大小：表示如果不使用rsync将发送的数据的大小。在随后运行rsync时，它将仅传输文件差异。此图将表示无需传输的数据。
加速比：这是必须发送的数据量与现有数据总量之间的比率。如果rsync需要完整复制所有文件(例如，第一次运行时)，则平均加速比将为1.0。当下一次使用rrsync时，它将优化传输。它将只发送文件之间的差异，而不是整个文件。没有更改的文件将被忽略。加速比数字将表示需要传输的少量数据与文件总大小之间的比率。</p><p>使用进度选项</p><p>P(进度)选项使rsync在复制每个文件后生成一个小进度报告。</p><code>rsync -raP /home/dave/Documents/ /media/dave/SILVERXHD/backups/</code><img class="content_img" src="/image/11/11b32c70b922cb9c222e5ad1dd26ebbb.png" /><p>可以在每个复制的文件之间查看提供的信息。</p><img class="content_img" src="/image/e3/e38ef2f5708993e880b34df6442e787b.png" /><p>提供的资料如下：</p><p>
字节大小：为此文件传输的数据。
Percent：传输的文件的百分比。
B/s：数据传输速率。
剩余时间：估计传输此文件的剩余时间。
xfr#：到目前为止传输的文件数。
to-chk：优化算法需要检查和验证的文件数。</p><p>增加更多速度</p><p>要加快传输速度，请使用-z(压缩)选项。这会压缩传输中的文件，但文件会以未压缩的形式存储在目标目录中。</p><p>对于涉及许多小文件的传输，压缩选项不会产生显著优势。对于较大文件的集合，它可以以有意义的方式减少传输时间。</p><p>我们在这里还使用了--PARTIAL选项。rsync将删除由网络故障或其他中断导致的部分传输的文件。PARTIAL选项强制rsync将部分传输的文件保留在目标上。在rsync运行的净时间内，它将不必重新传输部分传输的文件的各部分。</p><p>请注意，如果有人可能会将部分传输的文件误认为完全传输的文件，您可能不想使用此选项。</p><code>rsync -ravz  --partial /home/dave/Documents/ /media/dave/SILVERXHD/backups/</code><img class="content_img" src="/image/d5/d5941a14aa8eee042f5cda61a2b90ac9.png" /><p>在我们的示例中，收益微乎其微。</p><img class="content_img" src="/image/fd/fdeffb383d057eed239fc748ab8a6730.png" /><p>加速比提高了，但是提高了百分之二百分之一！在真实场景中，您的速度提升会更令人印象深刻。</p><p>在网络上使用rsync</p><p>到目前为止，我们一直在瞄准一个外置USB驱动器。要使用网络位置作为备份目标，请在命令行上使用该位置的路径。本文研究的网络上有一个网络附加存储设备(NAS)。</p><p>我们可以使用之前使用的相同技巧来识别通往NAS的路径，方法是将鼠标悬停在Nautilus中该设备的连接上。</p><p>没有用于跨网络备份的特殊选项；这些都是我们已经使用过的选项。</p><code>rsync -ravz  --partial /home/dave/Documents/ /media/dave/NAS/dave/backups/</code><img class="content_img" src="/image/f9/f9506a73f484b5e3cbbfa50786c9efcd.png" /><p>输出的格式没有区别。</p><img class="content_img" src="/image/96/96edab8b01450b059c036e3b3ad290ad.png" /><p>不足为奇的是，字节/秒数字有了显著改善。</p><p>如果我们再次运行rsync，可以看到没有要传输的文件，因为没有任何更改，但仍有一些字节来回传输。这是将目标上的文件列表与源上的文件列表进行比较时需要传输的数据量。</p><img class="content_img" src="/image/4b/4b06495c7c8137c905f3196ebc41f218.png" /><p>在这种情况下，加速比要好一个数量级。在实践中，您的性能比率将介于我们两个伪人工读数之间。</p><p>通过SSH使用rsync</p><p>Rsync支持跨SSH连接进行备份。我们需要在命令行上提供用户帐户名和SSH位置。我们在这里使用的是网络名称，但您也可以使用IP地址。</p><p>请注意远程目标上的SSH连接详细信息和网络路径起点之间的“：”。</p><code>rsync -ravz  --partial /home/dave/Documents/ dave@sulaco.local:/home/dave/Backups/</code><img class="content_img" src="/image/b9/b931347da5d03686f384aac7b8220d02.png" /><p>系统将要求您输入远程计算机上用户帐户的密码。这不是您在源计算机上的密码。</p><img class="content_img" src="/image/6b/6bbc6e9850302f96cbb583f1a7e7b1d7.png" /><p>备份将照常完成。由于在安全外壳连接中进行加密和解密，因此吞吐量没有常规网络连接快。</p><p>自动执行备份</p><p>通过向您的crontab文件添加条目，我们可以轻松创建自动备份。</p><code>crontab -e</code><img class="content_img" src="/image/1f/1fea0d0c72dfd2ff7039adbeeeea08d7.png" /><p>我们将设置一个自动备份，使其在每天下午4点半运行(当然，如果当时计算机处于开机状态)。rsync命令的语法完全不变。</p><img class="content_img" src="/image/04/04bce2a05d2f1c65b51ce6d4397b066a.png" /><p>Ctrl+O将把您的更改写入文件，Ctrl+X将关闭Nano编辑器。</p><p>相关：如何在Linux上调度任务：Crontab文件简介</p><p>在rsync上摆出一张友好的面孔</p><p>不太习惯使用命令行的人可以使用将图形用户界面(GUI)放在rsync上的许多程序中的一个。LuckyBackup和Grsync就是两个很好的例子。这两个程序都允许通过用户界面选择许多rsync选项。</p><p>Grsync程序专注于成为rync的可视化包装器。它提供了对rsync选项的轻松访问，并且只添加了一组有限的新功能。</p><p>luckyBackup程序不仅仅是rsync的简单包装器。它是一个在幕后使用rsync的备份程序。例如，LuckyBackup可以为您的备份创建多个“快照”。然后，您可以“回滚”到任何快照中的文件版本。</p><p>要安装Grsync，请执行以下操作</p><p>要在Ubuntu中安装Grsync，请使用以下命令：</p><code>sudo apt-get install grsync</code><img class="content_img" src="/image/8f/8fc9c3f8051bcce253aba51edfd639f3.png" /><p>要在Fedora中安装Grsync，请使用以下命令：</p><code>sudo dnf install grsync</code><img class="content_img" src="/image/c9/c9dcfff5fb5c86508d9c37f593c4b71a.png" /><p>要在Manaro中安装Grsync，请使用以下命令：</p><code>sudo pacman -Syu grsync</code><img class="content_img" src="/image/37/3744c169373cb8b9a644396f12eaf5b1.png" /><p>要安装luckyBackup，请执行以下操作</p><p>要在Ubuntu中安装luckyBackup，请使用以下命令：</p><code>sudo apt-get install luckybackup</code><img class="content_img" src="/image/c5/c59f6be776156921d4b3d024ec06a37b.png" /><p>要在Fedora中安装luckyBackup，请使用以下命令：</p><code>sudo dnf install luckybackup</code><img class="content_img" src="/image/ac/ac6e4cd440f804031803c7a79221d2b3.png" /><p>在Manjaro中，您必须从Arch用户存储库(AUR)安装luckyBackup。您可以使用PAMAC包管理器完成此操作。</p><img class="content_img" src="/image/1b/1b115eafc6cda14a3b1419dd4ce2d9c0.png" /><p>不要冒险，经常备份您的数据</p><p>备份绝对至关重要。经常备份，备份到多个位置，备份到不同的介质。一旦设置好，rsync就可以为您完成所有这些工作。</p><div class="item_info"><span class="item_key"><a href="/tag/文件/">文件</a></span><span class="item_key"><a href="/tag/rsync/">rsync</a></span><span class="item_key"><a href="/tag/使用/">使用</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14797.html">如何在Linux上使用JOIN命令</a><li><a href="/story/14796.html">如何在Linux上使用JOIN命令</a><li><a href="/story/14627.html">解释的Linux文件时间戳：atime、mtime和ctime</a><li><a href="/story/14624.html">解释的Linux文件时间戳：atime、mtime和ctime</a><li><a href="/story/14550.html">如何在Linux上使用Tail命令</a><li><a href="/story/14514.html">您想知道的关于Linux上的inode的所有信息</a><li><a href="/story/14471.html">如何在Google Drive中更改文件所有者</a><li><a href="/story/14454.html">如何在Linux上使用stat命令</a><li><a href="/story/14347.html">如何使用cURL从Linux命令行下载文件</a><li><a href="/story/14306.html">如何创建USB驱动器的映像</a><li><a href="/story/14240.html">如何在Linux上使用LESS命令</a><li><a href="/story/14188.html">如何最终确定和撤销对共享Google文件的访问</a><li><a href="/story/14167.html">如何共享指向您的Google文件的“复制”链接</a><li><a href="/story/14164.html">如何将Google文档、工作表或幻灯片文件共享为网页</a><li><a href="/story/14127.html">如何在iPhone和iPad上将文件复制和备份到外部存储</a><li><a href="/story/14024.html">如何快速搜索Google Drive</a><li><a href="/story/13983.html">如何在Linux上使用chown命令</a><li><a href="/story/13968.html">如何将音乐复制到Android手机</a><li><a href="/story/13912.html">你能在Windows PC或Android手机上使用AirDrop吗？</a><li><a href="/story/13883.html">如何在PowerPoint演示文稿中使用iTunes音乐</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>