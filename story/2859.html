<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>用于简化SQL Server数据库维护的批处理脚本</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>用于简化SQL Server数据库维护的批处理脚本</h2></div><div class="content"><p>除了创建备份之外，SQL Server还提供了各种任务和功能，这些任务和功能既可以提高数据库的性能，也可以提高数据库的可靠性。我们之前已经向您展示了如何使用简单的命令行脚本备份SQL Server数据库，因此，我们将以同样的方式提供一个脚本，使您能够轻松执行常见的维护任务。</p><p>压缩/收缩数据库[/Compact]</p><p>有几个因素影响SQL Server数据库使用的物理磁盘空间。仅举几个例子：</p><p>
随着时间的推移，随着记录的添加、删除和更新，SQL会不断增加和缩小表，并生成临时数据结构来执行查询操作。为了满足磁盘存储需求，SQL Server将根据需要增加数据库大小(通常增加10%)，以便数据库文件大小不会不断变化。虽然这是性能的理想选择，但它可能会导致与使用的存储空间断开连接，因为例如，如果您添加了非常大量的记录，从而导致数据库增长并随后删除这些记录，SQL Server将不会自动回收此磁盘空间。
如果在数据库上使用完全恢复模式，则事务日志文件(LDF)可能会变得非常大，特别是在更新量很大的数据库上。</p><p>压缩(或收缩)数据库将回收未使用的磁盘空间。对于小型数据库(200MB或更少)，这通常不会很多，但对于大型数据库(1 GB或更大)，回收的空间可能会很大。</p><p>重新索引数据库[/reindex]</p><p>就像不断创建、编辑和删除文件会导致磁盘碎片一样，在数据库中插入、更新和删除记录也会导致表碎片。实际结果是相同的，因为读写操作会影响性能。虽然不是一个完美的类比，但对数据库中的表重新编制索引实质上是对它们进行碎片整理。在某些情况下，这可以显著提高数据检索的速度。</p><p>由于SQL Server的工作方式，表必须单独重建索引。对于具有大量表的数据库，手动执行这项操作可能非常痛苦，但是我们的脚本会命中相应数据库中的每个表，并重新构建所有索引。</p><p>正在验证完整性[/Verify]</p><p>为了使数据库既能正常运行又能产生准确的结果，必须准备好大量的完整性项目。值得庆幸的是，物理和/或逻辑完整性问题并不常见，但偶尔在数据库上运行完整性验证过程并检查结果是一种很好的实践。</p><p>当通过我们的脚本运行验证过程时，只报告错误，所以没有消息就是好消息。</p><p>使用脚本</p><p>SQLMaint批处理脚本与SQL 2005及更高版本兼容，必须在安装了SQLCMD工具(作为SQL Server安装的一部分安装)的计算机上运行。建议您将此脚本放到Windows PATH变量(即C：Windows)中设置的位置，以便可以像从命令行调用任何其他应用程序一样轻松地调用它。</p><p>要查看帮助信息，只需输入：</p><img class="content_img" src="/image/70/703f4d7d13cea7fc74454a47c9ebccb3.png" /><p>实例</p><p>要使用可信连接在数据库“mydb”上运行压缩，然后运行验证，请执行以下操作：</p><p>要使用密码为“123456”的“sa”用户在命名实例“Special”上的“mydb”上运行重新索引，然后对“mydb”进行压缩，请执行以下操作：</p><p>从批处理脚本内部使用</p><p>虽然SQLMaint批处理脚本可以像应用程序一样从命令行使用，但当您在另一个批处理脚本中使用它时，它前面必须带有call关键字。</p><p>例如，此脚本使用可信身份验证对默认SQL Server安装上的每个非系统数据库运行所有维护任务：</p><p>从SysadminGeek.com下载SQLMaint批处理脚本</p><div class="item_info"><span class="item_key"><a href="/tag/数据库/">数据库</a></span><span class="item_key"><a href="/tag/脚本/">脚本</a></span><span class="item_key"><a href="/tag/使用/">使用</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/5365.html">如何显示MySQL Server的系统变量</a><li><a href="/story/2862.html">轻松查看数据库中各个SQL表的磁盘空间使用情况</a><li><a href="/story/2851.html">用BGInfo建立网络计算机系统信息数据库</a><li><a href="/story/2811.html">使用SQL Server Management Studio恢复SQL数据库备份</a><li><a href="/story/2809.html">用于备份所有SQL Server数据库的批处理脚本</a><li><a href="/story/2079.html">在Access 2010中使用通配符条目</a><li><a href="/story/302.html">快速提示：自动压缩Access数据库</a><li><a href="/story/5.html">将MySQL数据库备份到文件</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>