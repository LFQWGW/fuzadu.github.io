<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何使用Google Authenticator的双因素身份验证保护SSH</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何使用Google Authenticator的双因素身份验证保护SSH</h2></div><div class="content"><img class="content_img" src="/image/03/03132a2102904c484c8a452167681aa2.png" /><p>想要使用易于使用的双因素身份验证保护您的SSH服务器吗？Google提供必要的软件将Google Authenticator的基于时间的一次性密码(TOTP)系统与您的SSH服务器集成。当您连接时，您必须从您的手机输入密码。</p><p>Google Authenticator不会给Google“打电话回家”--所有的工作都在您的SSH服务器和您的手机上进行。事实上，Google Authenticator是完全开源的，所以你甚至可以自己检查它的源代码。</p><p>安装Google Authenticator</p><p>要使用Google Authenticator实现多因素身份验证，我们需要开源的Google Authenticator PAM模块。PAM代表“可插拔身份验证模块”--它是一种将不同形式的身份验证轻松插入Linux系统的方法。</p><p>Ubuntu的软件存储库包含一个用于Google Authenticator PAM模块的易于安装的软件包。如果您的Linux发行版不包含此包，则必须从Google Code上的Google Authenticator下载页面下载并自行编译。</p><p>要在Ubuntu上安装软件包，请运行以下命令：</p><p>(这只会在我们的系统上安装PAM模块-我们必须手动激活它才能进行SSH登录。)</p><img class="content_img" src="/image/e7/e72eca4b5f0bd60dae2d76845bef1e9a.png" /><p>创建身份验证密钥</p><p>以您将远程登录的用户身份登录，然后运行google-Authenticator命令为该用户创建密钥。</p><p>通过键入y，允许该命令更新您的Google Authenticator文件。然后，系统将提示您几个问题，允许您限制使用同一临时安全令牌、增加令牌可用于的时间窗口以及限制允许的访问尝试以阻止暴力破解尝试。这些选择都是以一些安全性换取一些易用性。</p><img class="content_img" src="/image/bf/bf38330f4a1e8e5883b0d5a3c225691a.png" /><p>Google Authenticator会给你一个密钥和几个“紧急刮刮码”。在安全的地方写下紧急刮擦码--每次只能使用一次，而且是为了在手机丢失的情况下使用。</p><img class="content_img" src="/image/81/81b49e49fc9efb03b54cd73397ab53b4.png" /><p>在手机上的Google Authenticator应用程序中输入密钥(官方应用程序可用于Android、iOS和Blackberry)。您也可以使用扫描条形码功能-转到位于命令输出顶部附近的URL，您可以用手机的摄像头扫描二维码。</p><img class="content_img" src="/image/8d/8d7bea692c02a037db4e7e6624c3048b.png" /><p>现在，您的手机上将有一个不断变化的验证码。</p><img class="content_img" src="/image/6c/6ce6a580476e729467024a6a1fae7d50.png" /><p>如果要以多个用户身份远程登录，请为每个用户运行此命令。每个用户都将拥有自己的密钥和代码。</p><p>激活Google验证器</p><p>接下来，您必须使用Google Authenticator进行SSH登录。为此，请打开系统上的/etc/pam.d/sshd文件(例如，使用sudo Nano/etc/pam.d/sshd命令)，并将以下行添加到该文件：</p><p>接下来，打开/etc/ssh/sshd_config文件，找到ChallengeResponseAuthentication行，并将其更改为如下所示：</p><p>(如果ChallengeResponseAuthentication行不存在，请将以上行添加到文件中。)</p><p>最后，重新启动SSH服务器以使您的更改生效：</p><img class="content_img" src="/image/a4/a48c7ec613fa9d57dd1c9afdb8cb0ba2.png" /><p>每当您尝试通过SSH登录时，都会提示您输入密码和Google Authenticator代码。</p><img class="content_img" src="/image/fc/fcdb7dfb034c5ebd712353f42127712f.png" /><div class="item_info"><span class="item_key"><a href="/tag/google/">google</a></span><span class="item_key"><a href="/tag/authenticator/">authenticator</a></span><span class="item_key"><a href="/tag/使用/">使用</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14769.html">如何使用Google One备份和恢复Android</a><li><a href="/story/14712.html">如何使用Google Drive Progative Web App</a><li><a href="/story/14475.html">如何在Google Docs或幻灯片中创建核对表</a><li><a href="/story/14474.html">如何在Mac上设置和使用Google Drive</a><li><a href="/story/14471.html">如何在Google Drive中更改文件所有者</a><li><a href="/story/14460.html">如何使用rclone备份到Linux上的Google Drive</a><li><a href="/story/14430.html">如何将Google Sheet中的图表同步到文档或幻灯片</a><li><a href="/story/14327.html">如何将音乐添加到Google幻灯片</a><li><a href="/story/14133.html">如何将Android设置为朗读文本</a><li><a href="/story/14112.html">如何合并多个Google Drive和Google Photos帐户</a><li><a href="/story/14086.html">如何在Google Docs中添加Google Keep Notes</a><li><a href="/story/13944.html">如何将您的Nest帐户迁移到Google帐户</a><li><a href="/story/13850.html">如何使用Google Forms创建网站联系人表单</a><li><a href="/story/13608.html">如何将Google Authenticator移动到一部新电话(或多部电话)</a><li><a href="/story/13596.html">每日新闻综合报道：再见，雀巢，你好，谷歌商店</a><li><a href="/story/13562.html">Google Sheet初学者指南</a><li><a href="/story/13560.html">Google Drive和Photos正在分裂：你需要知道的是</a><li><a href="/story/13315.html">如何使用宏实现Google Sheet的自动化</a><li><a href="/story/13306.html">如何去除Google Sheet中的重复项</a><li><a href="/story/13180.html">如何使用脚本编辑器为Google应用程序增压</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>