<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何用JQ在Linux命令行上解析JSON文件</title><link rel="stylesheet" href="/css.css"></head><body><div id="header"><a class="site_title" href="http://www.fuzadu.com">复杂度</a></div><div><div><h2>如何用JQ在Linux命令行上解析JSON文件</h2></div><div class="content"><p>JSON是在Web上传输基于文本的数据的最流行的格式之一。它无处不在，你一定会遇到它。我们将向您展示如何从Linux命令行使用jq命令处理它。</p><p>JSON和JQ</p><p>JSON代表JavaScript对象表示法。这是一种允许以自描述方式将数据编码成纯文本文件的方案。JSON文件中没有注释-内容应该是不言而喻的。每个数据值都有一个称为“name”或“key”的文本字符串。这会告诉您数据值是什么。它们一起称为名称：值对或键：值对。冒号(：)将键与其值分开。</p><p>“对象”是键：值对的集合。在JSON文件中，对象以左大括号({)开始，以右大括号(})结束。JSON还支持“数组”，即值的有序列表。数组以左方括号([)开始，以右方括号(])结束。</p><p>当然，从这些简单的定义中，可能会出现任意的复杂性。例如，对象可以嵌套在对象中。对象可以包含数组，数组也可以包含对象。所有这些都可以有开放的嵌套级别。</p><p>但是，在实践中，如果JSON数据的布局错综复杂，那么数据布局的设计可能需要重新考虑。当然，如果您没有生成JSON数据，只是试图使用它，那么您在它的布局中就没有发言权。不幸的是，在这些情况下，你只需要处理它。</p><p>大多数编程语言都有允许它们解析JSON数据的库或模块。遗憾的是，Bash shell没有这样的功能。</p><p>需要是发明之母，然而，JQ实用程序诞生了！使用JQ，我们可以更容易地在Bash shell中解析JSON。无论您是必须使用设计良好、优雅的JSON，还是使用构成噩梦的东西，这都无关紧要。</p><p>如何安装JQ</p><p>我们必须在我们用来研究本文的所有Linux发行版上安装JQ。</p><p>要在Ubuntu上安装JQ，请键入以下命令：</p><p>SUDO APT-获取安装JQ</p><img class="content_img" src="/image/f4/f4aa7e6dc75fa4261d18e2a14d84823f.png" /><p>要在Fedora上安装JQ，请键入以下命令：</p><p>SUDO DNF安装JQ</p><img class="content_img" src="/image/16/16a7940de81b27020a1b5d949e7551ee.png" /><p>要在Manjaro上安装JQ，请键入以下命令：</p><p>SUDO PACMAN-SY JQ</p><img class="content_img" src="/image/80/800fd34a98b3f0d737671c76d5bc0946.png" /><p>如何使JSON具有可读性</p><p>JSON不关心空格，布局也不会影响它。只要遵循JSON语法规则，处理JSON的系统就可以阅读和理解它。正因为如此，JSON通常作为简单的长字符串传输，而不考虑布局。这节省了一些空间，因为制表符、空格和换行符不必包含在JSON中。当然，这一切的不利之处是当一个人试图阅读它的时候。</p><p>让我们从美国国家航空航天局(NASA)网站上拉出一个简短的JSON物体，告诉我们国际空间站的位置。我们将使用cURL，它可以下载文件来为我们检索JSON对象。</p><p>我们不关心curl通常生成的任何状态消息，因此我们将使用-s(静默)选项键入以下内容：</p><p>Curl-s和http://api.open-notify.org/iss-now.json</p><img class="content_img" src="/image/0b/0b34864616770941a9acb065ea072ef3.png" /><p>现在，稍加努力，你就可以读到这篇文章了。您必须挑选数据值，但这并不容易或方便。让我们重复这一点，但这一次我们将通过JQ来传递它。</p><p>JQ使用过滤器来解析JSON，其中最简单的过滤器是句点(.)，它的意思是“打印整个对象”。默认情况下，JQ漂亮地打印输出。</p><p>我们将它们放在一起并键入以下内容：</p><p>cURL-s http://api.open-notify.org/iss-now.json|JQ。</p><img class="content_img" src="/image/9a/9aa9a1c9cbdfa540de561e566123a21f.png" /><p>那好多了！现在，我们可以确切地看到发生了什么。</p><p>整个对象都用大括号括起来。它包含两个密钥：名称对：Message和Timestamp。它还包含一个名为ISS_Position的对象，该对象包含两个键：值对：经度和纬度。</p><p>我们再试一次。这次我们将键入以下内容，并将输出重定向到名为“iss.json”的文件中：</p><p>cURL-s http://api.open-notify.org/iss-now.json|JQ。&gt;iss.json</p><p>CAT iss.json</p><img class="content_img" src="/image/ed/ed7070375c7fe70c56c772c138945d1a.png" /><p>这为我们提供了硬盘上JSON对象的布局良好的副本。</p><p>相关：如何使用cURL从Linux命令行下载文件</p><p>访问数据值</p><p>正如我们在上面看到的，JQ可以从JSON提取通过管道传输的数据值。它还可以使用存储在文件中的JSON。我们将使用本地文件，这样命令行就不会出现乱七八糟的curl命令。这应该会让它更容易理解。</p><p>从JSON文件中提取数据的最简单方法是提供键名以获取其数据值。键入句点和键名，两者之间不能有空格。这将从键名创建一个过滤器。“我们还需要告诉JQ使用哪个JSON文件。</p><p>我们键入以下内容以检索消息值：</p><p>jq.message iss.json</p><img class="content_img" src="/image/c1/c19530b06f285ab613c2ab1a4cc8fa5f.png" /><p>JQ在终端窗口中打印消息值的文本。</p><p>如果您的键名包含空格或标点符号，则必须用引号将其筛选器引起来。通常只注意使用字符、数字和下划线，这样JSON键名称就不会有问题。</p><p>首先，我们键入以下内容以检索时间戳值：</p><p>jq.时间戳iss.json</p><img class="content_img" src="/image/43/4377f1202b460f958bbee4236c7d1f7e.png" /><p>在终端窗口中检索并打印时间戳值。</p><p>但是，我们如何才能访问iISS_Position对象中的值呢？我们可以使用JSON点符号。我们将在键值的“路径”中包含ISS_Position对象名称。为此，键所在对象的名称将在键本身的名称之前。</p><p>我们键入以下内容，包括纬度键名称(请注意，“.iss_position”和“.tude tude”之间没有空格)：</p><p>jq.iss_position tion.atitude iss.json</p><img class="content_img" src="/image/95/9503e6fbf034ef5da046d4b0a46ca9ee.png" /><p>要提取多个值，必须执行以下操作：</p><p>
在命令行中列出密钥名称。
用逗号(，)分隔。
用引号(“)或撇号(‘)将它们引起来。</p><p>考虑到这一点，我们键入以下内容：</p><p>jq“.iss_postion.atitude，.timeStamp”iss.json</p><img class="content_img" src="/image/90/90bd6cf269b1b63536af65db5752e413.png" /><p>这两个值将打印到终端窗口。</p><p>使用阵列</p><p>让我们从NASA拿一个不同的JSON天体。</p><p>这一次，我们将使用目前在太空的宇航员名单：</p><p>Curl-s和http://api.open-notify.org/astros.json</p><img class="content_img" src="/image/d6/d654b460eee384612acefc2347c7cb9c.png" /><p>好的，成功了，我们再来一次。</p><p>我们将键入以下内容以通过JQ将其传送，并将其重定向到名为“Aster.json”的文件：</p><p>cURL-s http://api.open-notify.org/astros.json|JQ。&gt;Aster.json</p><img class="content_img" src="/image/49/4937438084b9d571798e7e57ff53858f.png" /><p>现在，让我们键入以下内容来检查我们的文件：</p><p>更少的天文.json</p><img class="content_img" src="/image/16/161ca2e5a2e7574849298cf2a29c40e4.png" /><p>如下所示，我们现在看到的是太空中的宇航员名单，以及他们的宇宙飞船。</p><img class="content_img" src="/image/a9/a98dc2ace987be5abaedee4cf3945520.png" /><p>该JSON对象包含一个名为People的数组。我们知道它是一个数组，因为左方括号([)(在上面的屏幕截图中突出显示)。它是一个对象数组，每个对象都包含两个键：值对：名称和工艺。</p><p>与前面一样，我们可以使用JSON点表示法来访问值。我们还必须在数组名称中包括方括号([])。</p><p>考虑到所有这些，我们键入以下内容：</p><p>jq“.People[].name”ast.json</p><img class="content_img" src="/image/74/74c725c1e23e7afadbb09bbedf248828.png" /><p>这一次，所有的名称值都打印到终端窗口。我们要求JQ做的是打印数组中每个对象的name值。很整洁，是吧？</p><p>如果我们将单个对象在数组中的位置放在命令行的方括号([])中，我们就可以检索该对象的名称。该数组使用零偏移索引，这意味着位于数组第一个位置的对象为零。</p><p>要访问数组中的最后一个对象，可以使用-1；要获取数组中倒数第二个对象，可以使用-2，依此类推。</p><p>有时，JSON对象提供数组中的元素数量，本例就是这样。除了数组之外，它还包含一个名为number的键：名称对，值为6。</p><p>此数组中包含以下数量的对象：</p><p>jq“.People[1].name”ast.json</p><p>jq“.People[3].name”ast.json</p><p>jq“.People[-1].name”ast.json</p><p>jq“.People[-2].name”ast.json</p><img class="content_img" src="/image/52/52e9d4365c6e68bc286b56e3db428012.png" /><p>你也可以在数组中提供一个开始和结束对象。这叫做“切片”，它可能有点令人困惑。记住，数组使用的是零偏移量。</p><p>要从索引位置2检索对象，直到(但不包括)索引位置4处的对象，我们键入以下命令：</p><p>jq“.People[2：4]”Aster.json</p><img class="content_img" src="/image/91/91c2fc21ba055e5050d47c4b2b558fc3.png" /><p>这将打印数组索引2(数组中的第三个对象)和数组中的第三个对象(数组中的第四个对象)处的对象。它在数组索引4处停止处理，这是数组中的第五个对象。</p><p>更好地理解这一点的方法是在命令行上进行试验。您很快就会看到它是如何工作的。</p><p>如何使用带过滤器的管道</p><p>可以通过管道将输出从一个筛选器输送到另一个筛选器，无需学习新符号，与Linux命令行一样，JQ使用竖线(|)来表示管道。</p><p>我们将告诉JQ将People数组通过管道传递到.name过滤器，该过滤器应该在终端窗口中列出宇航员的名字。</p><p>我们键入以下内容：</p><p>jq“.People[]|.name”Aster.json</p><img class="content_img" src="/image/1f/1fd366e85c9cbf2ca5680fd0ec2ff87e.png" /><p>相关：如何在Linux上使用管道</p><p>创建数组和修改结果</p><p>我们可以使用JQ创建新的对象，比如数组。在本例中，我们将提取三个值并创建一个包含这些值的新数组。注意：左方括号([)和右方括号(])也是筛选器字符串中的第一个和最后一个字符。</p><p>我们键入以下内容：</p><p>jq“[.iss-position tion.atitude，ISS_position tion.length，.timeStamp]”iss.json</p><img class="content_img" src="/image/22/22c59d5000907c68923b96c7bb1491c0.png" /><p>输出用括号括起来，并用逗号分隔，使其成为格式正确的数组。</p><p>也可以在检索数值时对其进行操作。让我们从ISS位置文件中提取时间戳，然后再次提取它并更改返回的值。</p><p>为此，我们键入以下内容：</p><p>jq“.timeamp”iss.json</p><p>JQ“.timeStamp-1570000000”iss.json</p><img class="content_img" src="/image/fa/fa5ac82d0983378c62b1d6f9176a41d8.png" /><p>如果需要在值数组中添加或删除标准偏移，这将非常有用。</p><p>让我们键入以下内容来提醒我们iss.json文件包含的内容：</p><p>JQ。iss.json</p><img class="content_img" src="/image/36/36a87cce8e0e854c98ab48751e40689d.png" /><p>假设我们想要去掉消息键：值对。这与国际空间站的位置没有任何关系。这只是一个标志，表明已成功检索到该位置。如果超出要求，我们可以免去它。(你也可以忽略它。)</p><p>我们可以使用JQ的删除函数ddel()来删除键：值对。要删除消息key：value对，我们键入以下命令：</p><p>JQ“del(.message)”iss.json</p><img class="content_img" src="/image/e4/e411cdc0753ff81c00b265a618bdf9c6.png" /><p>注意：这实际上不会从“iss.json”文件中删除它；它只是从命令的输出中删除它。如果需要创建不包含消息key：value对的新文件，请运行命令，然后将输出重定向到新文件。</p><p>更复杂的JSON对象</p><p>让我们再找回一些NASA的数据。这一次，我们将使用一个JSON对象，该对象包含来自世界各地的流星撞击地点的信息。这是一个更大的文件，其JSON结构比我们以前处理过的文件复杂得多。</p><p>首先，我们将键入以下内容将其重定向到名为“strikes.json”的文件：</p><p>cURL-s https://data.nasa.gov/resource/y77d-th95.json|JQ。&gt;strikes.json</p><img class="content_img" src="/image/80/80e70dcf68f6aab7627b461b67c8d904.png" /><p>要查看JSON的外观，我们键入以下内容：</p><p>较少的罢工。json</p><img class="content_img" src="/image/32/328336d15080a3eda0dab34ad38ef2b0.png" /><p>如下所示，文件以左方括号([)开始，因此整个对象是一个数组。数组中的对象是键：值对的集合，并且有一个称为geolocation的嵌套对象。geolocation对象包含更多键：值对和一个称为坐标的数组。</p><img class="content_img" src="/image/f0/f0b022d2e94278ad3bde5ea79acb550b.png" /><p>让我们从索引位置995到数组末尾的对象检索流星撞击的名称。</p><p>我们将键入以下内容以通过三个筛选器通过管道传输JSON：</p><p>jq“.[995：]|.[]|.name”strikes.json</p><img class="content_img" src="/image/df/df683b7352459571f366ce08a0ad363f.png" /><p>过滤器的功能如下：</p><p>
.[995：]：这告诉JQ处理从数组索引995到数组末尾的对象。冒号(：)后没有数字告诉JQ继续到数组末尾。
.[]：此数组迭代器告诉JQ处理数组中的每个对象。
.name：此过滤器提取Name值。</p><p>稍作更改，我们就可以从数组中提取最后10个对象。“-10”指示JQ从数组末尾开始处理对象10。</p><p>我们键入以下内容：</p><p>jq“.[-10：]|.[]|.name”strikes.json</p><img class="content_img" src="/image/80/805960907deadf744e2d330e6f2b2085.png" /><p>正如我们在前面的示例中所做的那样，我们可以键入以下内容来选择单个对象：</p><p>jq“.[650].name”strikes.json</p><img class="content_img" src="/image/2d/2d5d3fec637cfae4308af4eaa5247afd.png" /><p>我们还可以对字符串应用切片。为此，我们将键入以下内容以请求数组索引234处的对象名称的前四个字符：</p><p>jq“.[234].name[0：4]”strikes.json</p><img class="content_img" src="/image/66/6642f3cfd200572cb85b3d2c6b2f78c7.png" /><p>我们还可以看到一个特定物体的整体。为此，我们键入以下内容并包括不带任何键的数组索引：值筛选器：</p><p>jq“.[234]”strikes.json</p><img class="content_img" src="/image/af/af9627f891d77aa6c9f0c4c41ac2afdb.png" /><p>如果您只想查看值，则可以在没有键名的情况下执行相同的操作。</p><p>在我们的示例中，我们键入以下命令：</p><p>jq“.[234][]”strikes.json</p><img class="content_img" src="/image/c0/c07849d8392855f5d1eb9b1f15088d9d.png" /><p>要从每个对象检索多个值，我们在以下命令中用逗号分隔它们：</p><p>jq“.[450：455]|.[]|.name，.mass”strikes.json</p><img class="content_img" src="/image/f8/f83d03af12b47bb851cd75974818709f.png" /><p>如果要检索嵌套值，则必须标识形成它们的“路径”的对象。</p><p>例如，要引用坐标值，我们必须包括全包含数组、地理位置嵌套对象和嵌套坐标数组，如下所示。</p><img class="content_img" src="/image/6b/6bc511fa7d9faaada9f749003d02aa3e.png" /><p>要查看数组索引位置121处的对象的坐标值，我们键入以下命令：</p><p>jq“.[121].geolocation.coides[]”strikes.json</p><img class="content_img" src="/image/ee/ee6e411c39abee99e729b0b31ec13adb.png" /><p>LENGTH函数</p><p>JQ Length函数根据应用的内容提供不同的度量，例如：</p><p>
字符串：字符串的长度(以字节为单位)。
Objects：对象中键：值对的数量。
数组：数组中的数组元素数。</p><p>以下命令返回JSON数组中10个对象中Name值的长度，从索引位置100开始：</p><p>jq“.[100：110]|.[].name|length”strikes.json</p><img class="content_img" src="/image/81/8156d317b66a9cfc96a3ae1851077818.png" /><p>要查看数组中第一个对象中有多少个键：值对，我们键入以下命令：</p><p>jq“.[0]|Length”strikes.json</p><img class="content_img" src="/image/6f/6f3954ebef5c4133c694188a2dace541.png" /><p>按键功能</p><p>您可以使用KEYS函数来了解您必须使用的JSON。它可以告诉您键的名称，以及数组中有多少对象。</p><p>要在“aster.json”文件的People对象中查找密钥，我们键入以下命令：</p><p>jq“.People.[0]|Key”Aster.json</p><img class="content_img" src="/image/cb/cb5344fc2580b2d2ad8a0efea67eac4b.png" /><p>要查看People数组中有多少个元素，我们键入以下命令：</p><p>JQ“.People|Key”Aster.json</p><img class="content_img" src="/image/08/08e7c001c58ec2a5996b13972595bb1d.png" /><p>这表明有六个零偏移数组元素，编号从0到5。</p><p>函数的作用是：</p><p>您可以使用has()函数来查询JSON，并查看对象是否具有特定的键名。注意密钥名称必须用引号括起来。我们将用单引号(‘)将筛选器命令括起来，如下所示：</p><p>jq‘.[]|has(“nametype”)’strikes.json</p><img class="content_img" src="/image/cf/cfbb695caf79a51e3ca179dd96396cde.png" /><p>将检查数组中的每个对象，如下所示。</p><img class="content_img" src="/image/3d/3d7beb3d09109cfd70ad2a62c4f551f2.png" /><p>如果要检查特定对象，请将其索引位置包括在数组滤镜中，如下所示：</p><p>jq‘.[678]|has(“nametype”)’strikes.json</p><img class="content_img" src="/image/6c/6c0b24406074266578c936f3f778e273.png" /><p>没有它，不要走近JSON</p><p>jq实用程序是专业的、强大的、快速的软件的完美示例，它使生活在Linux世界变得如此愉快。</p><p>这只是对该命令的常见功能的简要介绍-还有更多的内容。如果你想更深入地挖掘，一定要查看全面的JQ手册。</p><div class="item_info"><span class="item_key"><a href="/tag/json/">json</a></span><span class="item_key"><a href="/tag/数组/">数组</a></span><span class="item_key"><a href="/tag/对象/">对象</a></span></div></div><div class="relate_story"><div><h3>相关文章</h3></div><ul><li><a href="/story/14696.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14695.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14687.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14684.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14682.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14681.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14680.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14676.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14673.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14665.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14664.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14662.html">如何用JQ在Linux命令行上解析JSON文件</a><li><a href="/story/14661.html">如何用JQ在Linux命令行上解析JSON文件</a></ul></div></div><div id="footer">&copy 2020 fuzadu.com</div></body></html>